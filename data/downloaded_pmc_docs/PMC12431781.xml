<?xml version="1.0"  ?><!DOCTYPE pmc-articleset PUBLIC "-//NLM//DTD ARTICLE SET 2.0//EN" "https://dtd.nlm.nih.gov/ncbi/pmc/articleset/nlm-articleset-2.0.dtd"><pmc-articleset><article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xml:lang="en" article-type="research-article" dtd-version="1.4"><processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats"><restricted-by>pmc</restricted-by></processing-meta><front><journal-meta><journal-id journal-id-type="nlm-ta">PLoS One</journal-id><journal-id journal-id-type="iso-abbrev">PLoS One</journal-id><journal-id journal-id-type="pmc-domain-id">440</journal-id><journal-id journal-id-type="pmc-domain">plosone</journal-id><journal-id journal-id-type="publisher-id">plos</journal-id><journal-title-group><journal-title>PLOS One</journal-title></journal-title-group><issn pub-type="epub">1932-6203</issn><publisher><publisher-name>PLOS</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmcid">PMC12431781</article-id><article-id pub-id-type="pmcid-ver">PMC12431781.1</article-id><article-id pub-id-type="pmcaid">12431781</article-id><article-id pub-id-type="pmcaiid">12431781</article-id><article-id pub-id-type="pmid">40939140</article-id><article-id pub-id-type="doi">10.1371/journal.pone.0330604</article-id><article-id pub-id-type="publisher-id">PONE-D-24-53440</article-id><article-version article-version-type="pmc-version">1</article-version><article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Mathematical and statistical techniques</subject><subj-group><subject>Statistical methods</subject><subj-group><subject>Monte Carlo method</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Statistics</subject><subj-group><subject>Statistical methods</subject><subj-group><subject>Monte Carlo method</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical Sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Applied Mathematics</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and Analysis Methods</subject><subj-group><subject>Simulation and Modeling</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical Sciences</subject><subj-group><subject>Physics</subject><subj-group><subject>Classical Mechanics</subject><subj-group><subject>Continuum Mechanics</subject><subj-group><subject>Fluid Mechanics</subject><subj-group><subject>Fluid Dynamics</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical Sciences</subject><subj-group><subject>Physics</subject><subj-group><subject>Classical Mechanics</subject><subj-group><subject>Continuum Mechanics</subject><subj-group><subject>Fluid Mechanics</subject><subj-group><subject>Fluid Dynamics</subject><subj-group><subject>Advection</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and Analysis Methods</subject><subj-group><subject>Mathematical and Statistical Techniques</subject><subj-group><subject>Mathematical Models</subject><subj-group><subject>Random Walk</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and Life Sciences</subject><subj-group><subject>Physiology</subject><subj-group><subject>Plant Physiology</subject><subj-group><subject>Solute Transport</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and Life Sciences</subject><subj-group><subject>Plant Science</subject><subj-group><subject>Plant Physiology</subject><subj-group><subject>Solute Transport</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Computer and Information Sciences</subject><subj-group><subject>Computing Methods</subject><subj-group><subject>Computer Graphics</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical Sciences</subject><subj-group><subject>Physics</subject><subj-group><subject>Classical Mechanics</subject><subj-group><subject>Continuum Mechanics</subject><subj-group><subject>Fluid Mechanics</subject><subj-group><subject>Fluid Dynamics</subject><subj-group><subject>Brownian Motion</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical Sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Probability Theory</subject><subj-group><subject>Stochastic Processes</subject><subj-group><subject>Brownian Motion</subject></subj-group></subj-group></subj-group></subj-group></subj-group></article-categories><title-group><article-title>Advection, diffusion and linear transport in a single path-sampling Monte-Carlo algorithm: Getting insensitive to geometrical refinement</article-title><alt-title alt-title-type="running-head">Advection, diffusion and linear transport in a single path-sampling Monte-Carlo algorithm</alt-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes"><name name-style="western"><surname>Ibarrart</surname><given-names initials="L">Loris</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-original-draft/">Writing &#8211; original draft</role><xref rid="aff001" ref-type="aff">
<sup>1</sup>
</xref><xref rid="aff002" ref-type="aff">
<sup>2</sup>
</xref><xref rid="aff003" ref-type="aff">
<sup>3</sup>
</xref><xref rid="cor001" ref-type="corresp">*</xref></contrib><contrib contrib-type="author"><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-9245-3792</contrib-id><name name-style="western"><surname>Blanco</surname><given-names initials="S">St&#233;phane</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff002" ref-type="aff">
<sup>2</sup>
</xref></contrib><contrib contrib-type="author"><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-3994-5637</contrib-id><name name-style="western"><surname>Caliot</surname><given-names initials="C">Cyril</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff004" ref-type="aff">
<sup>4</sup>
</xref><xref rid="aff005" ref-type="aff">
<sup>5</sup>
</xref></contrib><contrib contrib-type="author"><name name-style="western"><surname>Dauchet</surname><given-names initials="J">J&#233;r&#233;mi</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff006" ref-type="aff">
<sup>6</sup>
</xref></contrib><contrib contrib-type="author"><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-2976-0575</contrib-id><name name-style="western"><surname>Eibner</surname><given-names initials="S">Simon</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff001" ref-type="aff">
<sup>1</sup>
</xref></contrib><contrib contrib-type="author"><name name-style="western"><surname>El Hafi</surname><given-names initials="M">Mouna</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff001" ref-type="aff">
<sup>1</sup>
</xref></contrib><contrib contrib-type="author"><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-6630-059X</contrib-id><name name-style="western"><surname>Farges</surname><given-names initials="O">Olivier</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff007" ref-type="aff">
<sup>7</sup>
</xref></contrib><contrib contrib-type="author"><name name-style="western"><surname>Forest</surname><given-names initials="V">Vincent</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff008" ref-type="aff">
<sup>8</sup>
</xref></contrib><contrib contrib-type="author"><name name-style="western"><surname>Fournier</surname><given-names initials="R">Richard</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff002" ref-type="aff">
<sup>2</sup>
</xref></contrib><contrib contrib-type="author"><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-7002-9920</contrib-id><name name-style="western"><surname>Gautrais</surname><given-names initials="J">Jacques</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff009" ref-type="aff">
<sup>9</sup>
</xref></contrib><contrib contrib-type="author"><name name-style="western"><surname>Konduru</surname><given-names initials="R">Raj</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff007" ref-type="aff">
<sup>7</sup>
</xref></contrib><contrib contrib-type="author"><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-0377-6192</contrib-id><name name-style="western"><surname>Penazzi</surname><given-names initials="L">L&#233;a</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff007" ref-type="aff">
<sup>7</sup>
</xref></contrib><contrib contrib-type="author"><name name-style="western"><surname>Tr&#233;gan</surname><given-names initials="JM">Jean-Marc</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff002" ref-type="aff">
<sup>2</sup>
</xref></contrib><contrib contrib-type="author"><name name-style="western"><surname>Vourc&#8217;h</surname><given-names initials="T">Thomas</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff006" ref-type="aff">
<sup>6</sup>
</xref></contrib><contrib contrib-type="author"><name name-style="western"><surname>Yaacoub</surname><given-names initials="D">Daniel</given-names></name><role content-type="http://credit.niso.org/contributor-roles/writing-review-editing/">Writing &#8211; review &amp; editing</role><xref rid="aff006" ref-type="aff">
<sup>6</sup>
</xref></contrib></contrib-group><aff id="aff001"><label>1</label>
<addr-line>Universit&#233; de Toulouse, Mines Albi, UMR- Centre RAPSODEE, Campus Jarlard, Albi CT Cedex 09, France</addr-line></aff><aff id="aff002"><label>2</label>
<addr-line>LAPLACE, Universit&#233; de Toulouse, CNRS, INPT, UPS, Toulouse, France</addr-line></aff><aff id="aff003"><label>3</label>
<addr-line>Centre National d&#8217;Etudes Spatiales, Toulouse, France</addr-line></aff><aff id="aff004"><label>4</label>
<addr-line>PROMES - CNRS, UPR, Odeillo, France</addr-line></aff><aff id="aff005"><label>5</label>
<addr-line>CNRS, UPPA, E2S, LMAPAll&#233;e du Parc Montaury, Anglet, France</addr-line></aff><aff id="aff006"><label>6</label>
<addr-line>Universit&#233; Clermont Auvergne, Clermont Auvergne INP, CNRS, Institut Pascal, Clermont-Ferrand, France</addr-line></aff><aff id="aff007"><label>7</label>
<addr-line>Universit&#233; de Lorraine, CNRS, LEMTA, Vand&#339;uvre-l&#232;s-Nancy, France</addr-line></aff><aff id="aff008"><label>8</label>
<addr-line>M&#233;so-Star, Longages, France</addr-line></aff><aff id="aff009"><label>9</label>
<addr-line>CRCA, CBI, Universit&#233; de Toulouse, CNRS, Toulouse, France</addr-line></aff><contrib-group><contrib contrib-type="editor"><name name-style="western"><surname>Ullah</surname><given-names initials="A">Asad</given-names></name><role>Editor</role><xref rid="edit1" ref-type="aff"/></contrib></contrib-group><aff id="edit1">
<addr-line>University of Lakki Marwat, PAKISTAN</addr-line>
</aff><author-notes><corresp id="cor001">* E-mail: <email>loris.ibarrart@mines-albi.fr</email></corresp><fn fn-type="COI-statement" id="coi001"><p><bold>Competing Interests: </bold>The authors have declared that no competing interests exist.</p></fn></author-notes><pub-date pub-type="epub"><day>12</day><month>9</month><year>2025</year></pub-date><pub-date pub-type="collection"><year>2025</year></pub-date><volume>20</volume><issue>9</issue><issue-id pub-id-type="pmc-issue-id">496058</issue-id><elocation-id>e0330604</elocation-id><history><date date-type="received"><day>20</day><month>11</month><year>2024</year></date><date date-type="accepted"><day>5</day><month>8</month><year>2025</year></date></history><pub-history><event event-type="pmc-release"><date><day>12</day><month>09</month><year>2025</year></date></event><event event-type="pmc-live"><date><day>13</day><month>09</month><year>2025</year></date></event><event event-type="pmc-last-change"><date iso-8601-date="2025-09-13 16:25:51.440"><day>13</day><month>09</month><year>2025</year></date></event></pub-history><permissions><copyright-statement>&#169; 2025 Ibarrart et al</copyright-statement><copyright-year>2025</copyright-year><copyright-holder>Ibarrart et al</copyright-holder><license><ali:license_ref specific-use="textmining" content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This is an open access article distributed under the terms of the <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><self-uri xmlns:xlink="http://www.w3.org/1999/xlink" content-type="pmc-pdf" xlink:href="pone.0330604.pdf"/><self-uri xmlns:xlink="http://www.w3.org/1999/xlink" content-type="pdf" xlink:href="pone.0330604.pdf"/><abstract><p>We address the question of numerically simulating the coupling of diffusion, advection and one-speed linear transport, with a specific focus on managing geometrical complexity. We base our work on recent advances from the computer graphics community, which has developed Monte Carlo algorithms simulating linear radiation transport in physically realistic scenes, with numerical costs that remain unaffected by geometrical refinement: adding more details to the scene description does not impact the computation time. The resulting benefits in terms of engineering flexibility are already fully integrated into the cinema industry and are gradually being adopted by the video game industry. Here we demonstrate that the same insensitivity to the geometric complexity can be achieved when considering not only one-speed linear transport, but also its coupling with diffusion and advection. In this case, pure linear-transport paths are replaced with advection-diffusion/linear-transport paths, which are composed of subpaths. Each subpath represents one of the three physical phenomena, and coupling is handled by switching from one subpath (i.e. phenomenon) to another. This approach is illustrated using a porous medium involving up to 10,000 pores, with the computation time being strictly independent of the number of pores, showing its ability to facilitate engineering calculations in complex geometries.</p></abstract><funding-group><award-group id="award001"><funding-source><institution>French National Agency for Research</institution></funding-source><award-id>HIGH-TUNE ANR-16-CE01-0010</award-id></award-group><award-group id="award002"><funding-source><institution>French National Agency for Research</institution></funding-source><award-id>MC2 ANR-21-CE46-0013</award-id></award-group><award-group id="award003"><funding-source><institution>French National Agency for Research</institution></funding-source><award-id>MCG-RAD ANR-18-CE46-0012</award-id></award-group><award-group id="award004"><funding-source><institution>Region Occitanie</institution></funding-source><award-id>CLE EDSTAR</award-id></award-group><award-group id="award005"><funding-source><institution>French government research program &#8220;Investissements d&#8217;Avenir&#8221; through the IDEX-ISITE</institution></funding-source><award-id>16-IDEX-0001 (CAP 20-25)</award-id></award-group><award-group id="award006"><funding-source><institution>IMobS3 Laboratory of Excellence</institution></funding-source><award-id>ANR-10-LABX-16-01</award-id></award-group><award-group id="award007"><funding-source><institution>SOLSTICE laboratory of Excellence</institution></funding-source><award-id>ANR-10-LABX-22-01</award-id></award-group><funding-statement>This work received financial support from the French National Agency for Research (ANR project HIGH-TUNE ANR-16-CE01-0010, ANR project MC2 ANR-21-CE46-0013 and ANR project MCGRAD ANR-18-CE46-0012) and from Region Occitanie (Projet CLE EDSTAR). This work has also been sponsored by the French government research program &#8220;Investissements d&#8217;Avenir&#8221; through the IDEX-ISITE initiative 16-IDEX-0001 (CAP 20-25), the IMobS3 Laboratory of Excellence (ANR-10-LABX-16-01) and the SOLSTICE laboratory of Excellence (ANR-10-LABX-22-01). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><fig-count count="10"/><table-count count="4"/><page-count count="33"/></counts><custom-meta-group><custom-meta><meta-name>pmc-status-qastatus</meta-name><meta-value>0</meta-value></custom-meta><custom-meta><meta-name>pmc-status-live</meta-name><meta-value>yes</meta-value></custom-meta><custom-meta><meta-name>pmc-status-embargo</meta-name><meta-value>no</meta-value></custom-meta><custom-meta><meta-name>pmc-status-released</meta-name><meta-value>yes</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-open-access</meta-name><meta-value>yes</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-olf</meta-name><meta-value>no</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-manuscript</meta-name><meta-value>no</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-legally-suppressed</meta-name><meta-value>no</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-has-pdf</meta-name><meta-value>yes</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-has-supplement</meta-name><meta-value>yes</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-pdf-only</meta-name><meta-value>no</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-suppress-copyright</meta-name><meta-value>no</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-is-real-version</meta-name><meta-value>no</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-is-scanned-article</meta-name><meta-value>no</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-preprint</meta-name><meta-value>no</meta-value></custom-meta><custom-meta><meta-name>pmc-prop-in-epmc</meta-name><meta-value>yes</meta-value></custom-meta><custom-meta id="data-availability"><meta-name>Data Availability</meta-name><meta-value>All relevant data are within the paper and its <xref rid="sec027" ref-type="sec">Supporting information</xref> files.</meta-value></custom-meta></custom-meta-group></article-meta><notes><title>Data Availability</title><p>All relevant data are within the paper and its <xref rid="sec027" ref-type="sec">Supporting information</xref> files.</p></notes></front><body><sec sec-type="intro" id="sec001"><title>Introduction</title><p>Applicative contexts are numerous where diffusion, advection and linear transport physics interact within systems requiring refined geometric descriptions. Engineers attempting to closely understand and optimize the transfer of heat by conduction, convection and radiation in electronic and electric devices of increasing powers and decreasing sizes is among the most highlighted examples, but complexifying the geometric description is also a major requirement in domains such as housing insulation, energy reception in concentrated-solar plants, process optimization in steel industry, etc. Beyond heat transfer, similar needs are associated with many types of transport physics, e.g. neutron transport for nuclear reactors design and operation, charge carriers transport in solar cells <italic toggle="yes">etc</italic>. In all such contexts, numerical simulations impose constraints in terms of geometrical description, which engineers translate into trade-offs between accuracy and computer time or power. There is therefore a strong demand for numerical approaches that know no limit in terms of geometrical refinement.</p><p>When only linear transport is considered, it can be stated that the problem is at least partly solved: after two decades of research on acceleration techniques for path-tracing Monte Carlo algorithms, today&#8217;s film industry renders highly complex scenes with such an ease that they free the artists from all previous constraints. Scenes can be conceived without worrying about how the rendering algorithms will behave: it is acted that the impact of geometry on accuracy and calculation times is very low. Physicists have successfully adapted and even upgraded these tools to deal with other types of linear transport questions, e.g. for solar and infrared radiative heat transfer in planetary atmospheres where the simulation of 3D multiple scattering in cloudy scenes is now strictly insensitive to the degree of detail of cloud volume and ground surface descriptions [<xref rid="pone.0330604.ref001" ref-type="bibr">1</xref>]. In other applicative fields, the same kind of approach has made it possible to deal with the spectral complexity involved in the Earth&#8217;s global radiative cooling [<xref rid="pone.0330604.ref002" ref-type="bibr">2</xref>], or radiative properties of complex-shaped scatterers [<xref rid="pone.0330604.ref003" ref-type="bibr">3</xref>].</p><p>We address the same need to deal with one-speed linear transport coupled with diffusion and advection. This implies that</p><list list-type="order"><list-item><p>new paths are defined to account for the coupling of these three physics;</p></list-item><list-item><p>these paths preserve the features that allow path-tracing acceleration in computer graphics.</p></list-item></list><p>For pure linear transport, path-sampling Monte Carlo algorithms are designed using the available path-integral formulation of the general solution of the linear Boltzmann equation, which is possible whatever the geometry. It is actually quite straightforward to switch from this specific partial differential equation (PDE) to an integral over particle-paths, where a path is a succession of continuous lines (straight lines for linear transport in the absence of external force, or for radiation in the absence of refraction effect) interrupted at collision events (absorption and scattering within the volume, absorption and reflection at the boundary). These paths will here be called <italic toggle="yes">linear-transport paths</italic>.</p><p>Advecto-reacto-diffusive PDEs can be handled similarly using the Feynman-Kac formula [<xref rid="pone.0330604.ref004" ref-type="bibr">4</xref>], which gives the exact solution as the expectation of an It&#244; process driven by a stochastic differential equation (SDE) [<xref rid="pone.0330604.ref005" ref-type="bibr">5</xref>]. The It&#244; process being Markovian, Monte-Carlo techniques can be used to solve these PDEs by simulating random paths of the stochastic process, the same way linear-transport paths are sampled to solve the linear Boltzmann equation. Feynman-Kac formula handles a first level of coupling: the physics of advection, reaction and diffusion within a unique geometrical domain are handled using paths that will here be called <italic toggle="yes">advecto-diffusive paths</italic> (or <italic toggle="yes">shifted-brownian paths</italic>). The name of these paths does not include reaction because reaction occurs either at all location along the path, or at the beginning and the end of each path (depending on the formulation): the paths themselves only translate advection and diffusion. In our case, if the Boltzmann equation solution were known at all location within the volume and at the boundary, then linear transport would enter the description via such a reactive term and the advecto-diffusive paths would transport the corresponding sources throughout the domain as expected from Feynman&#8217;s vision of propagative processes, in strict correspondence with Green formalism.</p><p>In the applicative contexts listed above, the coupling goes further in three directions:</p><list list-type="bullet"><list-item><p>in the advecto-reacto-diffusive equation, sources that obey Boltzmann equation are unknown,</p></list-item><list-item><p>these sources depend on the solution of the advecto-reacto-diffusive equation itself, since Boltzmann equation includes source terms obeying the advecto-reacto-diffusive equation,</p></list-item><list-item><p>the domain is typically divided into subdomains where there is no advection and no contribution of linear transport physics (solids in the following) and subdomains with all three physics interacting (fluids in the following).</p></list-item></list><p>We therefore need a formalism in which advecto-diffusive paths interact with linear-transport paths, and also interact with pure diffusive paths at the interface between subdomains (depending on the retained physics, typically ensuring continuity of the flux density when combining solid-diffusion at one side and fluid-diffusion at the other side, and linear transport particles emission/absorption at the interface itself). This question was already addressed by several authors with the objective of simulating the transfer of heat in 3D porous media. [<xref rid="pone.0330604.ref006" ref-type="bibr">6</xref>,<xref rid="pone.0330604.ref007" ref-type="bibr">7</xref>] and [<xref rid="pone.0330604.ref008" ref-type="bibr">8</xref>] dealt with thermal diffusion inside opaque solids interacting via radiation, with also convective heat transfer along the solid surfaces for a fluid at a known temperature: advection and diffusion within the fluid is not part of the simulation. [<xref rid="pone.0330604.ref009" ref-type="bibr">9</xref>] adds the simulation of convection within fluid cells that are assumed to be perfectly mixed, which means that all three heat transfer modes are coupled but the fluid modeling does not require advection. Among these researches, [<xref rid="pone.0330604.ref010" ref-type="bibr">10</xref>] has begun to formulate the corresponding path integrals, using a double-randomization approach, introducing paths that are recursively defined as successions of sub-path corresponding to each of the three heat transfer modes, still with a convection model requiring no advection, and only at the stationary limit. The theoretical foundations that make this coupling possible are fully exposed in [<xref rid="pone.0330604.ref011" ref-type="bibr">11</xref>]. This approach has been successfully implemented in [<xref rid="pone.0330604.ref012" ref-type="bibr">12</xref>] and [<xref rid="pone.0330604.ref013" ref-type="bibr">13</xref>], showing its ability to solve such coupled problems in a complex environment.</p><p>Here, we will make use of the same formalism for problems involving pure diffusion in some parts of the geometry (solids), advecto-diffusion in the remaining part (fluid) and one-speed linear transport within the fluid and between the solid-fluid interfaces (exchanges between fluid volumes, between a fluid volume and the solid surfaces, and between the solid surfaces through the absorbing and scattering fluid). This will allow us to test the corresponding advection-diffusion/linear-transport path-sampling Monte Carlo algorithms on realistic configurations inspired by porous solid-fluid heat exchangers.</p><p>In terms of preserving the features that make path-tracing acceleration efficient in computer graphics, one-speed linear transport can be treated exactly like radiative transfer in computer graphics and the recursive switching from one sub-path to the next one is independent of the detail of the geometrical description. The question therefore reduces to the acceleration of advecto-diffusive paths within a geometrical domain defined using a very large number of geometric primitives.</p><p>The ability to produce strict reformulations in path space for models initially formulated in differential form is a difficult and still largely unresolved issue, especially when there are heterogeneities in thermophysical properties and domain boundaries with prescribed boundary conditions. In addition, it is necessary to probabilize these formulations to produce unbiased estimators of the solution following the Feynman-Kac approach.</p><p>These formulations rely on defining underlying stochastic processes that must be sampled exactly to produce unbiased estimators of the solution. For instance, in the case of a standard Brownian process in an infinite field, it is straightforward to sample the positions and times of a particle without knowing its entire trajectory. Similarly, since the 1970s, proposals have been made to represent unbiased Brownian motions within confined domains, mainly involving methods based on Green&#8217;s function formulations in terms of position and first-passage time in highly symmetrical domains (spheres, parallelepipedes, etc.) [<xref rid="pone.0330604.ref014" ref-type="bibr">14</xref>&#8211;<xref rid="pone.0330604.ref016" ref-type="bibr">16</xref>]. The task becomes significantly more complex if we consider the trajectories that start from the boundaries, and numerous questions remain about the ability to produce unbiased sets of positions and times compatible with the underlying stochastic processes. These questions have been extensively studied by the applied mathematics community working on Monte Carlo methods [<xref rid="pone.0330604.ref017" ref-type="bibr">17</xref>&#8211;<xref rid="pone.0330604.ref020" ref-type="bibr">20</xref>], and, more recently, by the computer graphics community [<xref rid="pone.0330604.ref021" ref-type="bibr">21</xref>,<xref rid="pone.0330604.ref022" ref-type="bibr">22</xref>]. From all this work, it emerges that each situation resolved, even with a reduced level of applicability, is a victory. The issue is not only to reformulate the solutions in the formalism of surface integrals but also to adopt a probabilistic perspective that maintains all the physical representations of the underlying paths. Recent work by Rohan Sawhney and co-authors has opened up many new perspectives by proposing unbiased formulations for solving Poisson equations in complex three-dimensional environments with Neumann or Robin boundary conditions [<xref rid="pone.0330604.ref023" ref-type="bibr">23</xref>,<xref rid="pone.0330604.ref024" ref-type="bibr">24</xref>]. However, there is currently no equivalent work that comprehensively addresses the resolution of coupled advecto-reacto-diffusive equations as those presented in the present study. Another constraint of these methods is that they require the knowledge of the closest distance to the boundary, which is typically missing information when using the data structuring and access choices underlying current advanced acceleration strategies (hierarchical grids added on top of unstructured sets of geometrical primitives).</p><p>For these reasons, we are compelled to introduce a numerical parameter (discrete walk step and reinjection step), which requires only the knowledge of the line-primitive intersection, the computation of which takes benefits from the path-tracing acceleration tools developed by the computer graphics community. In doing so, it adds computational constraints since the step must be adapted to simulation conditions in order to balance accuracy and computation time, as is the case with all conventional numerical methods.</p><p>Below, we will construct an advecto-diffusive path sampling procedure as successions of straight-line jumps. This procedure may not be the best choice for long-term perspectives but it is perfectly suited to available computer-graphics acceleration techniques. We will illustrate how such path-sampling Monte Carlo strategies have the same features as for pure linear transport: computation time is insensitive to the number of geometrical primitives.</p><p>In preparation for this illustration, <xref rid="sec002" ref-type="sec">Sect 1</xref> introduces the physical model and <xref rid="sec003" ref-type="sec">Sect 2</xref> shows how the coupling of two physics is translated into the recursive sampling of subpaths, each dedicated to a single physics. An approximate brownian walk is then introduced in <xref rid="sec004" ref-type="sec">Sect 3</xref>, which recovers all the features of linear-transport paths as far as tracking acceleration is concerned. Finally <xref rid="sec009" ref-type="sec">Sect 5</xref> provides simulation examples for a configuration emblematic of the heat transfer literature: a porous heat exchanger composed of an increasing number of kelvin cells.</p></sec><sec id="sec002"><title>1 Model</title><p>We consider a motionless solid domain <inline-formula id="pone.0330604.e001"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e001g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e001.jpg"/><mml:math id="M1" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> of boundary <inline-formula id="pone.0330604.e002"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e002g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e002.jpg"/><mml:math id="M2" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (only diffusion, no advection, no linear transport) and an adjacent absorbing and scattering fluid domain <inline-formula id="pone.0330604.e003"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e003g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e003.jpg"/><mml:math id="M3" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> of boundary <inline-formula id="pone.0330604.e004"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e004g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e004.jpg"/><mml:math id="M4" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (all three processes active at all locations). The physical properties are uniform within each part, the velocity <inline-formula id="pone.0330604.e005"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e005g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e005.jpg"/><mml:math id="M5" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>&#8801;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is known at each location <inline-formula id="pone.0330604.e006"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e006g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e006.jpg"/><mml:math id="M6" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> within the fluid, and we act on the geometrical refinement of the geometry by increasing the characteristic scale ratios of <inline-formula id="pone.0330604.e007"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e007g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e007.jpg"/><mml:math id="M7" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e008"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e008g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e008.jpg"/><mml:math id="M8" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (smallest physically significant scale divided by system scale), typically by increasing the number of pores in a porous geometry.</p><p>For the pure diffusion part and the advection-diffusion part of the model, the physical observable is noted <inline-formula id="pone.0330604.e009"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e009g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e009.jpg"/><mml:math id="M9" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>&#8801;</mml:mo><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> for each location <inline-formula id="pone.0330604.e010"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e010g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e010.jpg"/><mml:math id="M10" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> within the solid (<inline-formula id="pone.0330604.e011"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e011g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e011.jpg"/><mml:math id="M11" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>) and <inline-formula id="pone.0330604.e012"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e012g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e012.jpg"/><mml:math id="M12" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo>&#8801;</mml:mo><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> for each location within the fluid (<inline-formula id="pone.0330604.e013"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e013g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e013.jpg"/><mml:math id="M13" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>). For the one-speed linear transport part, the physical observable is noted <inline-formula id="pone.0330604.e014"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e014g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e014.jpg"/><mml:math id="M14" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo>&#8801;</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> at each location <inline-formula id="pone.0330604.e015"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e015g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e015.jpg"/><mml:math id="M15" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and each direction <italic toggle="yes"><bold>u</bold></italic> of the unit sphere (noted "<inline-formula id="pone.0330604.e016"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e016g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e016.jpg"/><mml:math id="M16" display="inline" overflow="scroll"><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>"). In pure theoretical terms, <italic toggle="yes">&#951;</italic> and <italic toggle="yes">f</italic> can be interpreted as the density and the distribution function of two interacting species. The interaction between the two species is compatible with an equilibrium state where <italic toggle="yes">f</italic> is isotropic:</p><list list-type="bullet"><list-item><p>the emission direction is isotropically distributed; the corresponding emission rate is <inline-formula id="pone.0330604.e017"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e017g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e017.jpg"/><mml:math id="M17" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> times the diffusing species absorption (or reaction) rate <inline-formula id="pone.0330604.e018"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e018g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e018.jpg"/><mml:math id="M18" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>,</p></list-item><list-item><p>the absorption (or reaction) frequency <inline-formula id="pone.0330604.e019"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e019g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e019.jpg"/><mml:math id="M19" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is the same for both the diffusing species and the linear transport species.</p></list-item></list><p>An example of how to translate this model for heat-transfer applications is provided in <xref rid="sec022" ref-type="sec">Appendix F</xref>.</p><p>The boundary of the system is noted <inline-formula id="pone.0330604.e020"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e020g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e020.jpg"/><mml:math id="M20" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, i.e. <inline-formula id="pone.0330604.e021"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e021g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e021.jpg"/><mml:math id="M21" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo>&#8746;</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo>&#8745;</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. At each location <inline-formula id="pone.0330604.e022"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e022g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e022.jpg"/><mml:math id="M22" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> on <inline-formula id="pone.0330604.e023"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e023g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e023.jpg"/><mml:math id="M23" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, the incoming distribution function <italic toggle="yes">f</italic><sub><italic toggle="yes">i</italic></sub> is known, i.e. <inline-formula id="pone.0330604.e024"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e024g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e024.jpg"/><mml:math id="M24" display="inline" overflow="scroll"><mml:mrow><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> for all <inline-formula id="pone.0330604.e025"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e025g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e025.jpg"/><mml:math id="M25" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula> where <inline-formula id="pone.0330604.e026"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e026g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e026.jpg"/><mml:math id="M26" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is the inward normal to the boundary at <inline-formula id="pone.0330604.e027"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e027g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e027.jpg"/><mml:math id="M27" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. For the diffusive species at the boundary, we note <inline-formula id="pone.0330604.e028"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e028g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e028.jpg"/><mml:math id="M28" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> the value of <italic toggle="yes">&#951;</italic> at each boundary location and <inline-formula id="pone.0330604.e029"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e029g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e029.jpg"/><mml:math id="M29" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> is split in two parts, <inline-formula id="pone.0330604.e030"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e030g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e030.jpg"/><mml:math id="M30" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>D</mml:mi></mml:msub><mml:mo>&#8746;</mml:mo><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>: on <inline-formula id="pone.0330604.e031"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e031g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e031.jpg"/><mml:math id="M31" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> we use a Dirichlet boundary condition (<inline-formula id="pone.0330604.e032"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e032g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e032.jpg"/><mml:math id="M32" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is known), on <inline-formula id="pone.0330604.e033"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e033g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e033.jpg"/><mml:math id="M33" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> the diffusion flux is null (<inline-formula id="pone.0330604.e034"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e034g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e034.jpg"/><mml:math id="M34" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:mi>&#951;</mml:mi><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>). At the interface <inline-formula id="pone.0330604.e035"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e035g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e035.jpg"/><mml:math id="M35" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo>&#8745;</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> between the solid and the fluid, we write the flux continuity for the two species: the diffusion flux on the solid side, <inline-formula id="pone.0330604.e036"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e036g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e036.jpg"/><mml:math id="M36" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, equals the diffusion flux on the fluid side, <inline-formula id="pone.0330604.e037"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e037g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e037.jpg"/><mml:math id="M37" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, plus the linear-transport flux, <inline-formula id="pone.0330604.e038"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e038g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e038.jpg"/><mml:math id="M38" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> where <inline-formula id="pone.0330604.e039"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e039g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e039.jpg"/><mml:math id="M39" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mi>f</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mtext>&#160;</mml:mtext><mml:mi>d</mml:mi><mml:mi>u</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. There is no advective flux because velocity is assumed to be null at the solid-fluid interface and density is assumed to be continuous through the interface (<xref rid="pone.0330604.g001" ref-type="fig">Fig 1</xref>).</p><fig position="float" id="pone.0330604.g001" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.g001</object-id><label>Fig 1</label><caption><title>Illustration of the advection, diffusion and linear transport configuration studied in the article.</title><p>The solid domain <inline-formula id="pone.0330604.e040"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e040g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e040.jpg"/><mml:math id="M40" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is shown in gray, the fluid domain <inline-formula id="pone.0330604.e041"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e041g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e041.jpg"/><mml:math id="M41" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is shown in blue. The model is: pure diffusion in the solid; advection-diffusion in the fluid; linear transport in the absorbing and scattering fluid. The boundary <inline-formula id="pone.0330604.e042"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e042g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e042.jpg"/><mml:math id="M42" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>D</mml:mi></mml:msub><mml:mo>&#8746;</mml:mo><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> of the system is the union of <inline-formula id="pone.0330604.e043"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e043g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e043.jpg"/><mml:math id="M43" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, shown in grey, where Dirichlet boundary condition are formulated (the density <italic toggle="yes">&#951;</italic> is prescribed), and <inline-formula id="pone.0330604.e044"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e044g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e044.jpg"/><mml:math id="M44" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, shown in red, where the diffusion flux is null. The incident distribution function <italic toggle="yes">f</italic> obeying linear transport is prescribed over the whole boundary <inline-formula id="pone.0330604.e045"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e045g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e045.jpg"/><mml:math id="M45" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. See a practical implementation of this generic configuration in <xref rid="pone.0330604.g005" ref-type="fig">Figs 5</xref> and <xref rid="pone.0330604.g006" ref-type="fig">6</xref>.</p></caption><graphic xmlns:xlink="http://www.w3.org/1999/xlink" position="float" orientation="portrait" xlink:href="pone.0330604.g001.jpg"/></fig><p>Altogether the model providing <inline-formula id="pone.0330604.e046"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e046g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e046.jpg"/><mml:math id="M46" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pone.0330604.e047"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e047g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e047.jpg"/><mml:math id="M47" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <italic toggle="yes">f</italic> in the domains <inline-formula id="pone.0330604.e048"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e048g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e048.jpg"/><mml:math id="M48" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e049"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e049g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e049.jpg"/><mml:math id="M49" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is</p><disp-formula id="pone.0330604.e478"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e478g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e478.jpg"/></disp-formula><p>where <italic toggle="yes">D</italic><sub><italic toggle="yes">S</italic></sub> and <italic toggle="yes">D</italic><sub><italic toggle="yes">F</italic></sub> are the solid and fluid diffusion coefficients, <italic toggle="yes">c</italic> is the particles speed in the linear transport model, <inline-formula id="pone.0330604.e050"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e050g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e050.jpg"/><mml:math id="M50" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is the absorption frequency, <inline-formula id="pone.0330604.e051"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e051g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e051.jpg"/><mml:math id="M51" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is the single-scattering frequency, <italic toggle="yes">p</italic><sub><italic toggle="yes">s</italic></sub> is the single-scattering phase function and <inline-formula id="pone.0330604.e052"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e052g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e052.jpg"/><mml:math id="M52" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mi>f</mml:mi><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo>&#8801;</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>.</p><p>Still within the system, at the solid-fluid interface, we have:</p><disp-formula id="pone.0330604.e479"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e479g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e479.jpg"/></disp-formula><p>where <italic toggle="yes">&#945;</italic> is the surface absorptivity (<italic toggle="yes">i.e.</italic> one minus reflectivity) and <italic toggle="yes">p</italic><sub><italic toggle="yes">r</italic></sub> the probability density of the direction after surface reflection.</p><p>At the boundary of the system, we have:</p><disp-formula id="pone.0330604.e480"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e480g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e480.jpg"/></disp-formula><p>Note that Robin boundary conditions would make no difference as far as the present numerical discussion is concerned.</p></sec><sec id="sec003"><title>2 Interacting random walks</title><p>Monte Carlo algorithms solving <xref rid="pone.0330604.e478" ref-type="disp-formula">Eqs 1</xref>, <xref rid="pone.0330604.e478" ref-type="disp-formula">2</xref> and <xref rid="pone.0330604.e478" ref-type="disp-formula">3</xref>, each separately, are well established. They all start with the definition of a random process, with the solution of the addressed model shown as the expectation of this process. For <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 1</xref> (pure diffusion), the process is brownian motion. Regarding <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 2</xref>, we consider from <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 3</xref> that <inline-formula id="pone.0330604.e053"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e053g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e053.jpg"/><mml:math id="M53" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:mo>.</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo>&#8722;</mml:mo><mml:mo>&#8747;</mml:mo><mml:mi>f</mml:mi><mml:mtext>&#160;</mml:mtext><mml:mi>d</mml:mi><mml:mi>u</mml:mi><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> has the form of a standard reaction term provided that <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 2</xref> is decoupled, i.e. provided that <italic toggle="yes">f</italic> is known. Hence, <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 2</xref> is diffusion-advection-reaction, and, in accordance with Feynmann-Kac theory, the process is an exponentially interrupted brownian motion with drift. For <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 3</xref> (linear Boltzmann equation), the process is a backward multiple-scattering and reflection walk. The remaining question is therefore coupling.</p><p>When coupling is linear, the main idea behind the combined use of two Monte Carlo algorithms is double randomization [<xref rid="pone.0330604.ref025" ref-type="bibr">25</xref>,<xref rid="pone.0330604.ref026" ref-type="bibr">26</xref>]. If</p><list list-type="bullet"><list-item><p>a Monte Carlo algorithm is available for solving problem 1 with <italic toggle="yes">N</italic> samples of process P1,</p></list-item><list-item><p>sampling P1 requires the solution of problem 2,</p></list-item><list-item><p>a Monte Carlo algorithm is available for solving problem 2 with <italic toggle="yes">N</italic> samples of process P2,</p></list-item></list><p>there is no need to sample P2 <italic toggle="yes">N</italic> times each time it is needed for P1, which would require <inline-formula id="pone.0330604.e054"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e054g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e054.jpg"/><mml:math id="M54" display="inline" overflow="scroll"><mml:mrow><mml:mi>N</mml:mi><mml:mspace width="0.167em"/><mml:mrow><mml:mo>&#215;</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>N</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> samples: it suffices to use a single sample of P2. If, for instance, P1 is an interrupted brownian motion that requires the solution of P2 at the interruption location, and if P2 is a backward multiple-scattering walk, then the overall process, representing the coupling of the two underlying physics, is simply a brownian motion that, when interrupted, switches to a multiple-scattering path. This remains meaningful when the coupling is both ways, i.e. sampling P2 requires the solution of problem 1. This is the case when addressing the coupling of <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 2</xref> and <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 3</xref>: when interrupted, the brownian motion switches to a multiple-scattering path (because the reaction term involves <italic toggle="yes">f</italic> and it is unknown), and when this multiple-scattering path is interrupted at an absorption/emission location, it switches back to brownian motion (because the emission term involves <inline-formula id="pone.0330604.e055"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e055g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e055.jpg"/><mml:math id="M55" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and it is unknown).</p><p><xref rid="pone.0330604.g002" ref-type="fig">Fig 2</xref> illustrates the practice of such a combination of brownian paths and multiple-scattering linear-transport paths in the simplified case of an infinite uniform static fluid. The resulting Monte Carlo algorithm evaluates <inline-formula id="pone.0330604.e062"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e062g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e062.jpg"/><mml:math id="M62" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> at a given location <inline-formula id="pone.0330604.e063"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e063g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e063.jpg"/><mml:math id="M63" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> assuming that <inline-formula id="pone.0330604.e064"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e064g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e064.jpg"/><mml:math id="M64" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is known at a given distance from <inline-formula id="pone.0330604.e065"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e065g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e065.jpg"/><mml:math id="M65" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. It starts with the brownian walk by setting the initial location <inline-formula id="pone.0330604.e066"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e066g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e066.jpg"/><mml:math id="M66" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> to <inline-formula id="pone.0330604.e067"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e067g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e067.jpg"/><mml:math id="M67" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and the initial time <italic toggle="yes">t</italic><sub><italic toggle="yes">B</italic></sub> to <italic toggle="yes">t</italic><sub><italic toggle="yes">obs</italic></sub>. The first step is then the sampling of an exponentially distributed duration <inline-formula id="pone.0330604.e068"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e068g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e068.jpg"/><mml:math id="M68" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#948;</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> for the brownian walk before interruption by emission. The expectation of this exponential distribution is <inline-formula id="pone.0330604.e069"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e069g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e069.jpg"/><mml:math id="M69" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>. Then the location of the brownian walker at <inline-formula id="pone.0330604.e070"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e070g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e070.jpg"/><mml:math id="M70" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is sampled according to a three-dimension gaussian distribution centered on <inline-formula id="pone.0330604.e071"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e071g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e071.jpg"/><mml:math id="M71" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> of standard deviation <inline-formula id="pone.0330604.e072"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e072g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e072.jpg"/><mml:math id="M72" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#963;</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mn>6</mml:mn><mml:mi>D</mml:mi><mml:mi>&#948;</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:msqrt></mml:mrow></mml:math></alternatives></inline-formula>, where <italic toggle="yes">D</italic> is the diffusion coefficient of the medium. At this new location <inline-formula id="pone.0330604.e073"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e073g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e073.jpg"/><mml:math id="M73" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, a linear-transport path is initiated, which starts with the isotropic sampling of a direction <italic toggle="yes"><bold>u</bold></italic>. Then the algorithm is a standard multiple-scattering algorithm:</p><list list-type="bullet"><list-item><p>a free-flight duration <inline-formula id="pone.0330604.e074"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e074g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e074.jpg"/><mml:math id="M74" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#948;</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mi>T</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is sampled according to an exponential distribution of expectation <inline-formula id="pone.0330604.e075"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e075g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e075.jpg"/><mml:math id="M75" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula></p></list-item><list-item><p>the multiple-scattering path is started with a straight line from <inline-formula id="pone.0330604.e076"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e076g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e076.jpg"/><mml:math id="M76" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> to <inline-formula id="pone.0330604.e077"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e077g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e077.jpg"/><mml:math id="M77" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>c</mml:mi><mml:mi>&#948;</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula></p></list-item><list-item><p>at this collision location, a test is made to decide between absorption and scattering</p></list-item><list-item><p>if scattering is retained, a new direction <inline-formula id="pone.0330604.e078"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e078g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e078.jpg"/><mml:math id="M78" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is sampled according to <italic toggle="yes">p</italic><sub><italic toggle="yes">s</italic></sub> and the linear-transport path continues in this new direction.</p></list-item></list><fig position="float" id="pone.0330604.g002" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.g002</object-id><label>Fig 2</label><caption><title>A diffusive/linear-transport path in an infinite uniform static fluid for which the density <inline-formula id="pone.0330604.e056"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e056g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e056.jpg"/><mml:math id="M56" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is known outside a rectangular cuboid.</title><p><italic toggle="yes">N</italic> such paths are sampled to estimate <inline-formula id="pone.0330604.e057"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e057g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e057.jpg"/><mml:math id="M57" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. Each path starts from the observation position <inline-formula id="pone.0330604.e058"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e058g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e058.jpg"/><mml:math id="M58" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and returns a Monte Carlo weight equal to the value <inline-formula id="pone.0330604.e059"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e059g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e059.jpg"/><mml:math id="M59" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> at the location <inline-formula id="pone.0330604.e060"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e060g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e060.jpg"/><mml:math id="M60" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> of the first brownian-walk interruption occurring outside the parallelepiped. <inline-formula id="pone.0330604.e061"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e061g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e061.jpg"/><mml:math id="M61" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is estimated as the average of these <italic toggle="yes">N</italic> weights. Blue sub-paths are brownian walks. Red sub-paths are multiple-scattering linear-transport paths. All algorithmic details are provided in the text of <xref rid="sec003" ref-type="sec">Sect 2</xref>. Simulation examples are provided in <xref rid="sec012" ref-type="sec">Appendix A</xref> and <xref rid="pone.0330604.t001" ref-type="table">Table 1</xref>.</p></caption><graphic xmlns:xlink="http://www.w3.org/1999/xlink" position="float" orientation="portrait" xlink:href="pone.0330604.g002.jpg"/></fig><p>The linear-transport path ends when absorption is retained, and at this absorption location a new brownian walk is started. This creates a succession of a brownian walk, a multiple-scattering path, a brownian walk, etc, until one of the multiple-scattering path is interrupted at a location <inline-formula id="pone.0330604.e079"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e079g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e079.jpg"/><mml:math id="M79" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> where <inline-formula id="pone.0330604.e080"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e080g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e080.jpg"/><mml:math id="M80" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is known. The Monte Carlo weight <italic toggle="yes">w</italic> is <inline-formula id="pone.0330604.e081"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e081g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e081.jpg"/><mml:math id="M81" display="inline" overflow="scroll"><mml:mrow><mml:mi>w</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>B</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and the Monte Carlo estimate is the average of <italic toggle="yes">N</italic> such weights. In this simple configuration, both the brownian and linear-transport walks can be sampled exactly and the Monte Carlo estimate is strictly unbiased.</p><p>The fact that the estimate is strictly unbiased in this example will not be preserved in the remainder of this article. This is due to the interface and boundary conditions that will lead to brownian walks in confined domains: we will handle these confined walks via a numerical approximation that will introduce a bias. But appart from this approximation (that reduces to zero when lowering the numerical parameter to zero), it is exactly the same approach that will be used hereafter for the coupling of linear transport with diffusion and advection. In particular, the computation times indicated in <xref rid="pone.0330604.t001" ref-type="table">Table 1</xref> illustrate a well known feature of Monte Carlo simulations that we will also observe in all the forthcoming simulation examples: in the low Knudsen number regime (or high optical thickness regime), i.e. when scattering widely dominates absorption and the mean free path is very small compared to the dimension of the system, then a large number of scattering events are required before either the linear-transport walk is interrupted to initiate a brownian walk, or it reaches the limit of the domain. This feature will not vanish with the following developments: when we will illustrate an insensitivity to the complexification of geometry, this will only mean that the refinement of the geometrical description has no impact on the computation time requirements, but these requirements will remain direct functions of the single-scattering albedo and Knudsen number.</p><table-wrap position="float" id="pone.0330604.t001" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.t001</object-id><label>Table 1</label><caption><title>Simulation results for the diffusion/linear-transport algorithm of <xref rid="sec003" ref-type="sec">Sect 2</xref> with the parameters of <xref rid="sec012" ref-type="sec">A</xref>.</title><p><inline-formula id="pone.0330604.e202"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e202g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e202.jpg"/><mml:math id="M202" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mover><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is the estimation of <inline-formula id="pone.0330604.e203"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e203g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e203.jpg"/><mml:math id="M203" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mo>,</mml:mo><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></alternatives></inline-formula> that is provided by <italic toggle="yes">N</italic>&#8201;=&#8201;10<sup>5</sup> Monte Carlo samples and <italic toggle="yes">&#963;</italic> is its associated statistical uncertainty as provided by the standard error (take <inline-formula id="pone.0330604.e204"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e204g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e204.jpg"/><mml:math id="M204" display="inline" overflow="scroll"><mml:mrow><mml:mn>3</mml:mn><mml:mi>&#963;</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> for a 0.9995 confidence). <italic toggle="yes">T</italic> is the computation time recorded when performing the <italic toggle="yes">N</italic>&#8201;=&#8201;10<sup>5</sup> Monte Carlo samples, <inline-formula id="pone.0330604.e205"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e205g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e205.jpg"/><mml:math id="M205" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mi>%</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is the required number of Monte Carlo samples in order to reach <inline-formula id="pone.0330604.e206"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e206g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e206.jpg"/><mml:math id="M206" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#963;</mml:mi><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mo>,</mml:mo><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e207"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e207g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e207.jpg"/><mml:math id="M207" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mi>%</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is the associated computation time. Computations were made using a x86i_64 Intel(R) Core(TM) i9-9880H CPU 2.30GHz.</p></caption><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.t001g" position="float" orientation="portrait" xlink:href="pone.0330604.t001.jpg"/><table frame="hsides" rules="groups"><colgroup span="1"><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/></colgroup><thead><tr><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e208">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e208g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e208.jpg"/><mml:math id="M208" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">&#957;</mml:mi><mml:mi mathvariant="bold-italic">s</mml:mi></mml:msub><mml:mi mathvariant="bold-italic">L</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e209">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e209g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e209.jpg"/><mml:math id="M209" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">D</mml:mi><mml:mi mathvariant="bold-italic">F</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi><mml:mi mathvariant="bold-italic">L</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e210">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e210g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e210.jpg"/><mml:math id="M210" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mi mathvariant="bold-italic">L</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msup></mml:mrow><mml:mover><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#951;</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e211">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e211g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e211.jpg"/><mml:math id="M211" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msup><mml:mi mathvariant="bold-italic">L</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">&#963;</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1"><italic toggle="yes">T</italic>(<italic toggle="yes">s</italic>)</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e212">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e212g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e212.jpg"/><mml:math id="M212" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">N</mml:mi><mml:mrow><mml:mn mathvariant="bold">1</mml:mn><mml:mi mathvariant="bold-italic">%</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e213">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e213g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e213.jpg"/><mml:math id="M213" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">T</mml:mi><mml:mrow><mml:mn mathvariant="bold">1</mml:mn><mml:mi mathvariant="bold-italic">%</mml:mi></mml:mrow></mml:msub><mml:mo mathvariant="bold" stretchy="false">(</mml:mo><mml:mi mathvariant="bold-italic">s</mml:mi><mml:mo mathvariant="bold" stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives>
</inline-formula>
</th></tr></thead><tbody><tr><td align="left" rowspan="1" colspan="1">100</td><td align="left" rowspan="1" colspan="1">0.01</td><td align="left" rowspan="1" colspan="1">2.001</td><td align="left" rowspan="1" colspan="1">0.004201</td><td align="left" rowspan="1" colspan="1">0.6247</td><td align="left" rowspan="1" colspan="1">4411</td><td align="left" rowspan="1" colspan="1">0.02756</td></tr><tr><td align="left" rowspan="1" colspan="1">100</td><td align="left" rowspan="1" colspan="1">1.</td><td align="left" rowspan="1" colspan="1">1.990</td><td align="left" rowspan="1" colspan="1">0.006390</td><td align="left" rowspan="1" colspan="1">0.6897</td><td align="left" rowspan="1" colspan="1">10207</td><td align="left" rowspan="1" colspan="1">0.07040</td></tr><tr><td align="left" rowspan="1" colspan="1">100</td><td align="left" rowspan="1" colspan="1">100.</td><td align="left" rowspan="1" colspan="1">1.927</td><td align="left" rowspan="1" colspan="1">0.05176</td><td align="left" rowspan="1" colspan="1">0.6919</td><td align="left" rowspan="1" colspan="1">669758</td><td align="left" rowspan="1" colspan="1">4.634</td></tr><tr><td align="left" rowspan="1" colspan="1">1.</td><td align="left" rowspan="1" colspan="1">0.01</td><td align="left" rowspan="1" colspan="1">1.999</td><td align="left" rowspan="1" colspan="1">0.003586</td><td align="left" rowspan="1" colspan="1">0.7919</td><td align="left" rowspan="1" colspan="1">3214</td><td align="left" rowspan="1" colspan="1">0.002546</td></tr><tr><td align="left" rowspan="1" colspan="1">1.</td><td align="left" rowspan="1" colspan="1">1.</td><td align="left" rowspan="1" colspan="1">1.993</td><td align="left" rowspan="1" colspan="1">0.006148</td><td align="left" rowspan="1" colspan="1">0.6196</td><td align="left" rowspan="1" colspan="1">9450</td><td align="left" rowspan="1" colspan="1">0.05855</td></tr><tr><td align="left" rowspan="1" colspan="1">1.</td><td align="left" rowspan="1" colspan="1">100.</td><td align="left" rowspan="1" colspan="1">1.927</td><td align="left" rowspan="1" colspan="1">0.05165</td><td align="left" rowspan="1" colspan="1">0.6028</td><td align="left" rowspan="1" colspan="1">666982</td><td align="left" rowspan="1" colspan="1">4.021</td></tr><tr><td align="left" rowspan="1" colspan="1">0.01</td><td align="left" rowspan="1" colspan="1">0.01</td><td align="left" rowspan="1" colspan="1">2.000</td><td align="left" rowspan="1" colspan="1">0.001850</td><td align="left" rowspan="1" colspan="1">99.04</td><td align="left" rowspan="1" colspan="1">855</td><td align="left" rowspan="1" colspan="1">0.8476</td></tr><tr><td align="left" rowspan="1" colspan="1">0.01</td><td align="left" rowspan="1" colspan="1">1.</td><td align="left" rowspan="1" colspan="1">2.004</td><td align="left" rowspan="1" colspan="1">0.005765</td><td align="left" rowspan="1" colspan="1">16.37</td><td align="left" rowspan="1" colspan="1">8309</td><td align="left" rowspan="1" colspan="1">1.360</td></tr><tr><td align="left" rowspan="1" colspan="1">0.01</td><td align="left" rowspan="1" colspan="1">100.</td><td align="left" rowspan="1" colspan="1">2.020</td><td align="left" rowspan="1" colspan="1">0.05145</td><td align="left" rowspan="1" colspan="1">13.16</td><td align="left" rowspan="1" colspan="1">661672</td><td align="left" rowspan="1" colspan="1">87.10</td></tr></tbody></table></alternatives></table-wrap></sec><sec id="sec004"><title>3 Brownian walks in confined domains</title><p>The work of Feynmann and Kac in the 50&#8217;s [<xref rid="pone.0330604.ref004" ref-type="bibr">4</xref>] played a key role in establishing the links between parabolic partial differential equations and random processes. Feynmann-Kac&#8217;s formula states that the solutions of advection-diffusion-reaction equations (<xref rid="pone.0330604.e478" ref-type="disp-formula">Eqs 1</xref> and <xref rid="pone.0330604.e478" ref-type="disp-formula">2</xref> in our context) can be rewritten as expectation of stochastic processes. Together with the usual translation of linear transport theory in statistical terms (for <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 3</xref>), this is all the theoretical basis required to justify Monte Carlo algorithms such as the one illustrated in the previous section. However, this statement leaves aside the huge amount of theoretical and numerical work that was required to deal with boundary conditions, before such algorithms became practical.</p><p>The family of Random Walk on Sphere (RWS) algorithms dominates the corresponding literature. The starting point is the observation that exact sampling of confined brownian walks is only possible for simple geometries and then the question becomes the following: how is it possible to cover any geometry using simple patterns such as spheres, sample exact brownian paths inside these patterns in a computationally efficient way, make numerical approximations in the vicinity of the boundaries (any boundary cannot be adjusted exactly with a sphere for instance), and ensuring that the parameters of these approximations can be tuned to reach the required accuracy (ensuring convergence with computational costs remaining satisfactory)?</p><p>The historic RWS method proposed by Brown in [<xref rid="pone.0330604.ref027" ref-type="bibr">27</xref>], and rigorously justified by Muler in [<xref rid="pone.0330604.ref028" ref-type="bibr">28</xref>], makes use of the distribution of first passages at the sphere, for a brownian motion starting from the center of the sphere: this distribution is uniform. Using the same logic as in the previous section, this allows to write the solution of the stationary diffusion equation as the expectation of the density at random locations on the sphere (which is also the harmonicity property of the laplacian operator). In the present context, this solves <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 1</xref> at the center of any sphere as soon as <inline-formula id="pone.0330604.e082"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e082g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e082.jpg"/><mml:math id="M82" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is known at all locations on the sphere:</p><disp-formula id="pone.0330604.e083"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e083g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e083.jpg"/><mml:math id="M83" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mi>d</mml:mi><mml:mi>u</mml:mi><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>&#948;</mml:mi><mml:mi>&#10877;</mml:mi><mml:msub><mml:mo>max</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>&#119982;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mover><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8745;</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo><mml:mo>=</mml:mo><mml:mo>&#8709;</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(12)</label></disp-formula><p>where <inline-formula id="pone.0330604.e084"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e084g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e084.jpg"/><mml:math id="M84" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#119982;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mover><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is the sphere of radius <inline-formula id="pone.0330604.e085"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e085g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e085.jpg"/><mml:math id="M85" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula> centered at <inline-formula id="pone.0330604.e086"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e086g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e086.jpg"/><mml:math id="M86" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. If <inline-formula id="pone.0330604.e087"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e087g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e087.jpg"/><mml:math id="M87" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is not known at the location <inline-formula id="pone.0330604.e088"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e088g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e088.jpg"/><mml:math id="M88" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> sampled on the sphere, then double randomization is used with a new sphere centered on this new location, etc. The system boundary is then treated as follows:</p><list list-type="bullet"><list-item><p>the sphere is chosen as the largest sphere entirely within the domain (the radius is the closest distance to the boundary, <italic toggle="yes">i.e.</italic>
<inline-formula id="pone.0330604.e089"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e089g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e089.jpg"/><mml:math id="M89" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#948;</mml:mi><mml:mo>=</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mover><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>&#119982;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mover><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>&#8745;</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo><mml:mo>=</mml:mo><mml:mo>&#8709;</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>) and when the location sampled on the sphere is at a distance lower than a numerical parameter <italic toggle="yes">&#949;</italic>, then the random walk is considered to have reached the boundary;</p></list-item><list-item><p>the corresponding approximation was very deeply investigated and convergence is satisfied, the number of successive spheres required to reach the boundary increasing only as the logarithm of <inline-formula id="pone.0330604.e090"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e090g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e090.jpg"/><mml:math id="M90" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>&#1013;</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> when reducing <italic toggle="yes">&#949;</italic>.</p></list-item></list><p>The corresponding algorithm used to evaluate the density at any probe position <inline-formula id="pone.0330604.e091"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e091g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e091.jpg"/><mml:math id="M91" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is showcased in <xref rid="pone.0330604.g003" ref-type="fig">Fig 3a</xref>.</p><fig position="float" id="pone.0330604.g003" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.g003</object-id><label>Fig 3</label><caption><title>Sampling of confined brownian walks to estimate the density <italic toggle="yes">&#951;</italic> at point <inline-formula id="pone.0330604.e096"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e096g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e096.jpg"/><mml:math id="M96" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>.</title><p>(a) Using the RWS method: the next positions <inline-formula id="pone.0330604.e097"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e097g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e097.jpg"/><mml:math id="M97" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> are sampled on the largest sphere inscribed in the domain until the sampled position is on the boundary, where <italic toggle="yes">&#951;</italic> is known. In order to end the algorithm, the studied domain&#8217;s surface is thickened by a small value <italic toggle="yes">&#949;</italic> in which the position is projected on the border. (b) Using the proposition made in <xref rid="sec005" ref-type="sec">Sect 4</xref>, that is compatible with ray tracing. All the spheres have the same radius <inline-formula id="pone.0330604.e098"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e098g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e098.jpg"/><mml:math id="M98" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. When getting close to a boundary, the displacement is truncated through the knowledge of the distance to the surface in this direction, which make the spheres distorded.</p></caption><graphic xmlns:xlink="http://www.w3.org/1999/xlink" position="float" orientation="portrait" xlink:href="pone.0330604.g003.jpg"/></fig><p>This proposition has been extended in numerous directions, notably with walks on rectangular parallelepipedes [<xref rid="pone.0330604.ref016" ref-type="bibr">16</xref>]. Considering the present context, we can briefly highlight the fact that drifted brownian walks can be handled very similarly. For instance, Sabelfeld [<xref rid="pone.0330604.ref029" ref-type="bibr">29</xref>] used first passage statistics of drifted brownian motion in a sphere to extend the RWS method to couple advection and diffusion for cathodoluminescence and electron beam induced current imaging. At the stationary state, for a homogeneous velocity field, it was proven that the distribution of first passage positions in a sphere corresponds to the von Mises-Fisher distribution. <xref rid="pone.0330604.e093" ref-type="disp-formula">Eq 13</xref> shows how this distribution can be applied to <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 2</xref>. It can be noted that in the case of a zero velocity field, this expression leads to <xref rid="pone.0330604.e083" ref-type="disp-formula">Eq 12</xref>, and to a Dirac distribution centered in <inline-formula id="pone.0330604.e092"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e092g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e092.jpg"/><mml:math id="M92" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> at the limit of an infinite local Peclet number. For <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 2</xref> without coupling with linear transport,</p><disp-formula id="pone.0330604.e093"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e093g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e093.jpg"/><mml:math id="M93" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mi>F</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>&#948;</mml:mi><mml:mi>&#10877;</mml:mi><mml:msub><mml:mo>max</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>&#119982;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mover><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8745;</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo><mml:mo>=</mml:mo><mml:mo>&#8709;</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(13)</label></disp-formula><p>with the probability density of von Mises-Fisher distribution</p><disp-formula id="pone.0330604.e094"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e094g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e094.jpg"/><mml:math id="M94" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mi>F</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mrow><mml:mi>sinh</mml:mi><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mi>exp</mml:mi><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mo>&#8722;</mml:mo><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mfrac><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula><p>where <inline-formula id="pone.0330604.e095"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e095g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e095.jpg"/><mml:math id="M95" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>.</p><p>When refining the geometrical description, the main point in <xref rid="pone.0330604.e083" ref-type="disp-formula">Eqs 12</xref> and <xref rid="pone.0330604.e093" ref-type="disp-formula">13</xref> is the fact that each step requires the computation of the local closest distance to the boundary (to ensure <inline-formula id="pone.0330604.e099"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e099g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e099.jpg"/><mml:math id="M99" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#948;</mml:mi><mml:mo>=</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mover><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo stretchy="false">{</mml:mo><mml:mi>&#119982;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mover><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8745;</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">}</mml:mo><mml:mo>=</mml:mo><mml:mo>&#8709;</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>). Accessing this information is a crucial issue, as it can be computationally very demanding, and it is repeated at each step along the path. Although very significant research efforts are devoted to this question of accessing the shortest <italic toggle="yes">sphere-surface intersection</italic> [<xref rid="pone.0330604.ref030" ref-type="bibr">30</xref>,<xref rid="pone.0330604.ref031" ref-type="bibr">31</xref>], the costs of today&#8217;s algorithms are still much higher than those of the algorithms accessing the shortest intersection with the geometry for a straight line in a given direction (<italic toggle="yes">line-surface intersection</italic>). The latter ones have indeed been deeply investigated by computer graphics community because it is required by ray tracing, a method commonly used to model light transport. This research has produced acceleration techniques based on precomputed recursive grids that are now practically available for common usage by numerical scientists [<xref rid="pone.0330604.ref032" ref-type="bibr">32</xref>,<xref rid="pone.0330604.ref033" ref-type="bibr">33</xref>]. Hence, at the present stage of these researches, the insensitivity to geometrical refinement illustrated in [<xref rid="pone.0330604.ref001" ref-type="bibr">1</xref>] for radiative transfer, is directly connected to the fact that accessing the geometry is reduced to finding line-surface intersections and not sphere-surface intersections. This can be amended in the future. In this case we get ready to adapt to these potential new tools. Still, the main idea of couplings subpath through double-randomization (see <xref rid="sec003" ref-type="sec">Sect 2</xref>) is unaffected.</p></sec><sec id="sec005"><title>4 An example proposition compatible with ray-tracing</title><p>Before sphere-surface intersection algorithms reach a similar maturity, RWS algorithms must be adapted to match this requirement of only accessing information about the geometry via line-surface intersections. We make here a proposition for an algorithm inspired of the RWS literature complying with this condition, so that acceleration techniques described for instance in [<xref rid="pone.0330604.ref001" ref-type="bibr">1</xref>] will be directly available for a numerical implementation handling highly refined geometries.</p><p>This is just one example of a proposition. Alternatives could be formulated, aiming for instance at increasing the convergence order or reducing the computation time associated to the computation of line-surface intersections in the vicinity of the boundary, but they would all lead to the same conclusion as far as the objective of the present article is concerned: insensitivity to geometrical refinement can still be achieved when introducing brownian motion in a confined domain. Each algorithm presented below is detailed in <xref rid="sec015" ref-type="sec">Appendix D</xref>. All are validated against available analytical solutions in <xref rid="sec016" ref-type="sec">Appendix E</xref> and against numerical solutions in <xref rid="sec025" ref-type="sec">Appendices F.3</xref> and <xref rid="sec026" ref-type="sec">F.4</xref>. Differences between our approach and deterministic numerical schemes are also discussed in [<xref rid="pone.0330604.ref034" ref-type="bibr">34</xref>,<xref rid="pone.0330604.ref035" ref-type="bibr">35</xref>] about applications regarding heat transfer.</p><sec id="sec006"><title>4.1 A finite difference scheme for pure diffusion in the solid</title><p>For the handling of geometrical confinement with only line-surface intersections, we made the choice of designing approximate brownian walks as direct statistical translations of standard finite difference or finite volume approaches to advection-diffusion-reaction partial differential equations. Regarding pure diffusion, the formulation of <xref rid="pone.0330604.e083" ref-type="disp-formula">Eq 12</xref> is kept unchanged, but with a fixed step <inline-formula id="pone.0330604.e100"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e100g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e100.jpg"/><mml:math id="M100" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (instead of the closest distance to the boundary). Therefore, at each step, given a sampled direction <italic toggle="yes"><bold>u</bold></italic> on the unit sphere (noted <inline-formula id="pone.0330604.e101"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e101g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e101.jpg"/><mml:math id="M101" display="inline" overflow="scroll"><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>), the walk should shift to the position <inline-formula id="pone.0330604.e102"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e102g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e102.jpg"/><mml:math id="M102" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. However, in order to account for boundaries, the rays defined by <inline-formula id="pone.0330604.e103"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e103g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e103.jpg"/><mml:math id="M103" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e104"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e104g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e104.jpg"/><mml:math id="M104" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> are traced; let <inline-formula id="pone.0330604.e105"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e105g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e105.jpg"/><mml:math id="M105" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e106"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e106g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e106.jpg"/><mml:math id="M106" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> be the distances between <inline-formula id="pone.0330604.e107"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e107g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e107.jpg"/><mml:math id="M107" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and the boundary in the directions <italic toggle="yes"><bold>u</bold></italic> and <inline-formula id="pone.0330604.e108"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e108g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e108.jpg"/><mml:math id="M108" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> respectively. Then, the walk is only shifted by the minimum of <inline-formula id="pone.0330604.e109"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e109g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e109.jpg"/><mml:math id="M109" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pone.0330604.e110"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e110g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e110.jpg"/><mml:math id="M110" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, and <inline-formula id="pone.0330604.e111"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e111g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e111.jpg"/><mml:math id="M111" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, which leads to a position in <inline-formula id="pone.0330604.e112"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e112g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e112.jpg"/><mml:math id="M112" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> or directly on its boundary <inline-formula id="pone.0330604.e113"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e113g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e113.jpg"/><mml:math id="M113" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. This algorithm corresponds to <xref rid="pone.0330604.e114" ref-type="disp-formula">Eq 14</xref> (see <xref rid="pone.0330604.g003" ref-type="fig">Fig 3b</xref> and Algorithm 2 in <xref rid="sec015" ref-type="sec">Appendix D</xref>).</p><disp-formula id="pone.0330604.e114"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e114g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e114.jpg"/><mml:math id="M114" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>&#948;</mml:mi><mml:mo>=</mml:mo><mml:mo>min</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(14)</label></disp-formula><p>Under the assumption that the density field is locally trilinear within <inline-formula id="pone.0330604.e115"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e115g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e115.jpg"/><mml:math id="M115" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#119982;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, this equation exactly solves <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 1</xref> (see a demonstration in <xref rid="sec013" ref-type="sec">Appendix B</xref>).</p></sec><sec id="sec007"><title>4.2 A Patankar&#8217;s scheme for coupling diffusion with advection and linear transport in the fluid</title><p>Regarding coupled advection and diffusion, Patankar&#8217;s work [<xref rid="pone.0330604.ref036" ref-type="bibr">36</xref>] suggests a numerical scheme based on the analytical solution of <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 2</xref> in a 1D homogeneous media. By interpreting the coefficients in Patankar&#8217;s scheme as probabilities, we propose an approximate random walk with drift for advection-diffusion. As in <xref rid="sec003" ref-type="sec">Sect 2</xref>, coupling with linear transport will be handled thanks to an interruption time at which brownian motion switches to a linear-transport walk. In the present context, this interruption time must preserve all the numerical features inspired by Patankar work, ensuring that, for a uniform velocity field, the walk recovers the available exact solution of an exponential density profile in the velocity direction and a linear profile in the orthogonal plane. This is achieved by introducing a probability <italic toggle="yes">p</italic><sub><italic toggle="yes">T</italic></sub> to switch to linear transport at each Patankar step. We give all the details of the formal developments leading to these probabilities in <xref rid="sec014" ref-type="sec">Appendix C</xref>. In a local orthonormal basis <inline-formula id="pone.0330604.e116"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e116g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e116.jpg"/><mml:math id="M116" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">O</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> chosen such that <inline-formula id="pone.0330604.e117"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e117g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e117.jpg"/><mml:math id="M117" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, it leads to <xref rid="pone.0330604.e122" ref-type="disp-formula">Eq 15</xref> where <italic toggle="yes">&#948;</italic> is a fixed step and <inline-formula id="pone.0330604.e118"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e118g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e118.jpg"/><mml:math id="M118" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mi>&#8192;</mml:mi><mml:mi>i</mml:mi></mml:msup><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mrow><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">&#8970;</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi><mml:mspace width="0.167em"/><mml:mrow><mml:mo mathvariant="bold">+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mn mathvariant="bold">1</mml:mn></mml:mrow><mml:mrow><mml:mn mathvariant="bold">2</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo fence="true" form="postfix" stretchy="true">&#8971;</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> (<inline-formula id="pone.0330604.e119"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e119g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e119.jpg"/><mml:math id="M119" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#8970;</mml:mi><mml:mtext>&#160;</mml:mtext><mml:mi>&#8971;</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> being the floor function, so that <inline-formula id="pone.0330604.e120"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e120g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e120.jpg"/><mml:math id="M120" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e121"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e121g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e121.jpg"/><mml:math id="M121" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>).</p><disp-formula id="pone.0330604.e122"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e122g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e122.jpg"/><mml:math id="M122" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mo>&#8721;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>6</mml:mn></mml:msubsup><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives><label>(15)</label></disp-formula><p>with</p><disp-formula id="pone.0330604.e481"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e481g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e481.jpg"/><label>(16)</label></disp-formula><p>where <inline-formula id="pone.0330604.e123"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e123g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e123.jpg"/><mml:math id="M123" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>&#8747;</mml:mo><mml:mi>f</mml:mi><mml:mtext>&#160;</mml:mtext><mml:mi>d</mml:mi><mml:mi>u</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> is the density of the linear-transport species described by <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 3</xref> and <inline-formula id="pone.0330604.e124"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e124g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e124.jpg"/><mml:math id="M124" display="inline" overflow="scroll"><mml:mrow><mml:mi>P</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>&#948;</mml:mi><mml:mspace width="0.167em"/><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>.</p><p>This equation can be directly interpreted as a random walk, which has the probability 1&#8722;<italic toggle="yes">p</italic><sub><italic toggle="yes">T</italic></sub> to move in 6 directions according to their 6 respective probabilities, and the probability <italic toggle="yes">p</italic><sub><italic toggle="yes">T</italic></sub> to switch to a linear-transport walk (see Algorithm 3 in <xref rid="sec015" ref-type="sec">Appendix D</xref>). The above expression is valid for any orientation of the local orthonormal basis around <inline-formula id="pone.0330604.e126"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e126g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e126.jpg"/><mml:math id="M126" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. Therefore, <xref rid="pone.0330604.e122" ref-type="disp-formula">Eq 15</xref> can be averaged over the direction <inline-formula id="pone.0330604.e127"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e127g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e127.jpg"/><mml:math id="M127" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> (and subsequently <inline-formula id="pone.0330604.e128"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e128g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e128.jpg"/><mml:math id="M128" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mrow><mml:mn mathvariant="bold">3</mml:mn><mml:mo mathvariant="bold">,</mml:mo><mml:mn mathvariant="bold">4</mml:mn><mml:mo mathvariant="bold">,</mml:mo><mml:mn mathvariant="bold">5</mml:mn><mml:mo mathvariant="bold">,</mml:mo><mml:mn mathvariant="bold">6</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>), leading to <xref rid="pone.0330604.e142" ref-type="disp-formula">Eq 17</xref>. In the algorithmic translation of this equation, at each step of the walk, a diffusion direction <italic toggle="yes"><bold>u</bold></italic> is uniformly sampled on the unit circle <inline-formula id="pone.0330604.e129"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e129g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e129.jpg"/><mml:math id="M129" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#119966;</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> in the plane perpendicular to <italic toggle="yes"><bold>v</bold></italic>. This way, when dealing with the boundaries, the diffusion directions can be treated exactly as in <xref rid="sec006" ref-type="sec">Sect 4.1</xref>. Following the same guidelines as previously, each step now requires four rays tracing to evaluate the length of the next step: two in the diffusion direction to compute <inline-formula id="pone.0330604.e130"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e130g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e130.jpg"/><mml:math id="M130" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e131"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e131g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e131.jpg"/><mml:math id="M131" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, and two in the velocity direction to compute the distances <inline-formula id="pone.0330604.e132"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e132g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e132.jpg"/><mml:math id="M132" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e133"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e133g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e133.jpg"/><mml:math id="M133" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> between <inline-formula id="pone.0330604.e134"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e134g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e134.jpg"/><mml:math id="M134" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and the first surface in the directions <italic toggle="yes"><bold>v</bold></italic> and <inline-formula id="pone.0330604.e135"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e135g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e135.jpg"/><mml:math id="M135" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> respectively (see <xref rid="pone.0330604.g004" ref-type="fig">Fig 4</xref>). These 4 distances <inline-formula id="pone.0330604.e136"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e136g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e136.jpg"/><mml:math id="M136" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pone.0330604.e137"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e137g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e137.jpg"/><mml:math id="M137" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pone.0330604.e138"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e138g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e138.jpg"/><mml:math id="M138" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pone.0330604.e139"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e139g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e139.jpg"/><mml:math id="M139" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> are then compared to the fixed step <inline-formula id="pone.0330604.e140"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e140g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e140.jpg"/><mml:math id="M140" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (that is equivalent to <inline-formula id="pone.0330604.e141"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e141g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e141.jpg"/><mml:math id="M141" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> in the solid).</p><disp-formula id="pone.0330604.e142"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e142g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e142.jpg"/><mml:math id="M142" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mspace width="0.167em"/><mml:mi>&#951;</mml:mi><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8722;</mml:mo><mml:mi>&#948;</mml:mi><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mfrac><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mspace width="0.167em"/><mml:mi>&#951;</mml:mi><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mfrac><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow><mml:mo fence="true" form="postfix" stretchy="true"/></mml:mrow><mml:mspace linebreak="newline"/><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true"/><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mn>4</mml:mn><mml:mspace width="0.167em"/><mml:msub><mml:mi>p</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mrow><mml:mi>&#119966;</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mi>&#948;</mml:mi><mml:mo>=</mml:mo><mml:mo>min</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></alternatives><label>(17)</label></disp-formula><p>where <italic toggle="yes">p</italic><sub><italic toggle="yes">T</italic></sub>, <italic toggle="yes">p</italic><sub>1</sub>, <italic toggle="yes">p</italic><sub>2</sub>, and <italic toggle="yes">p</italic><sub>3</sub> are defined as mentioned for <xref rid="pone.0330604.e481" ref-type="disp-formula">Eq 16</xref> (but with an updated value of <inline-formula id="pone.0330604.e143"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e143g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e143.jpg"/><mml:math id="M143" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#948;</mml:mi><mml:mo>=</mml:mo><mml:mo>min</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>).</p><fig position="float" id="pone.0330604.g004" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.g004</object-id><label>Fig 4</label><caption><title>Example of ray tracing to evaluate the length of the next step in the approximate random walk based on Patankar scheme: starting from the current location, two rays are drawn in the velocity direction <italic toggle="yes">v</italic> and its opposite, and two others in a random diffusion direction <italic toggle="yes">u</italic> (and its opposite) in the plane orthogonal to <italic toggle="yes">v.</italic></title><p>These four rays enable to compute <inline-formula id="pone.0330604.e125"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e125g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e125.jpg"/><mml:math id="M125" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#948;</mml:mi><mml:mo>=</mml:mo><mml:mo>min</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>).</p></caption><graphic xmlns:xlink="http://www.w3.org/1999/xlink" position="float" orientation="portrait" xlink:href="pone.0330604.g004.jpg"/></fig></sec><sec id="sec008"><title>4.3 Boundary and interface conditions</title><p>Using the same approach as in [<xref rid="pone.0330604.ref037" ref-type="bibr">37</xref>] for the solid-fluid interface, the density gradients in <xref rid="pone.0330604.e479" ref-type="disp-formula">Eq 4</xref> can be approximated by finite differences using the same small steps <inline-formula id="pone.0330604.e144"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e144g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e144.jpg"/><mml:math id="M144" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e145"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e145g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e145.jpg"/><mml:math id="M145" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> as in the previous sections. The source term <inline-formula id="pone.0330604.e146"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e146g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e146.jpg"/><mml:math id="M146" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>&#183;</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> in <xref rid="pone.0330604.e479" ref-type="disp-formula">Eq 4</xref> can be expressed as the difference between the incident and emitted flux densities in the hemisphere around the surface normal <inline-formula id="pone.0330604.e147"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e147g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e147.jpg"/><mml:math id="M147" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>:</p><disp-formula id="pone.0330604.e148"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e148g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e148.jpg"/><mml:math id="M148" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#183;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>&#945;</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac><mml:mi>c</mml:mi><mml:mspace width="0.167em"/><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mfrac><mml:mrow><mml:mi>&#945;</mml:mi></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mfrac><mml:mi>c</mml:mi><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo>&#183;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></alternatives><label>(18)</label></disp-formula><p>which leads to</p><disp-formula id="pone.0330604.e149"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e149g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e149.jpg"/><mml:math id="M149" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>F</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo>&#183;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="1em"/><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo>&#8745;</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives><label>(19)</label></disp-formula><p>where</p><disp-formula id="pone.0330604.e482"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e482g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e482.jpg"/><label>(20)</label></disp-formula><p>Again, in Monte Carlo terms, these probabilities are to be understood with regards to the double-randomization concept leading to successive sub-paths, as in <xref rid="sec003" ref-type="sec">Sect 2</xref>. When a random walk hits a solid-fluid interface, <xref rid="pone.0330604.e149" ref-type="disp-formula">Eq 19</xref> makes the walk switch to a diffusive walk starting in the solid at <inline-formula id="pone.0330604.e150"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e150g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e150.jpg"/><mml:math id="M150" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> with a probability <italic toggle="yes">p</italic><sub><italic toggle="yes">S</italic></sub> (see <xref rid="sec006" ref-type="sec">Sect 4.1</xref>), an advecto-diffusive walk starting in the fluid at <inline-formula id="pone.0330604.e151"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e151g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e151.jpg"/><mml:math id="M151" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> with a probability <italic toggle="yes">p</italic><sub><italic toggle="yes">F</italic></sub> (see <xref rid="sec007" ref-type="sec">Sect 4.2</xref>), or a linear-transport walk starting at the point <inline-formula id="pone.0330604.e152"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e152g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e152.jpg"/><mml:math id="M152" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> in a direction <inline-formula id="pone.0330604.e153"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e153g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e153.jpg"/><mml:math id="M153" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> toward the fluid, distributed according to the Lambertian law of surface emission (or according to an other law if surface emissivity depends on direction).</p><p>The same approach is used when dealing with boundary conditions involving a diffusion flux, i.e. <xref rid="pone.0330604.e480" ref-type="disp-formula">Eqs 10</xref> and <xref rid="pone.0330604.e480" ref-type="disp-formula">11</xref>, which leads to a normal reinjection:</p><disp-formula id="pone.0330604.e483"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e483g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e483.jpg"/></disp-formula><p>In practice, even if the lengths <inline-formula id="pone.0330604.e154"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e154g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e154.jpg"/><mml:math id="M154" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e155"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e155g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e155.jpg"/><mml:math id="M155" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> are supposed small enough, another surface might be present between <inline-formula id="pone.0330604.e156"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e156g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e156.jpg"/><mml:math id="M156" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and its point of re-injection in the solid or fluid (e.g. in sharp corners). To avoid this problem, two rays are traced from the point <inline-formula id="pone.0330604.e157"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e157g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e157.jpg"/><mml:math id="M157" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> in directions <italic toggle="yes"><bold>n</bold></italic> and <inline-formula id="pone.0330604.e158"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e158g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e158.jpg"/><mml:math id="M158" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> to redefine the lengths <inline-formula id="pone.0330604.e159"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e159g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e159.jpg"/><mml:math id="M159" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e160"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e160g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e160.jpg"/><mml:math id="M160" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> for this one step only : if a surface is detected between <inline-formula id="pone.0330604.e161"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e161g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e161.jpg"/><mml:math id="M161" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and its point of re-injection, the length is reduced so that the re-injection point ends up strictly in the midpoint between the initial surface and the detected one, ensuring the reinjection occurs in the expected domain. Those corrected lengths can be formally written as <inline-formula id="pone.0330604.e162"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e162g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e162.jpg"/><mml:math id="M162" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e163"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e163g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e163.jpg"/><mml:math id="M163" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>:</p><disp-formula id="pone.0330604.e484"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e484g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e484.jpg"/></disp-formula><p>where <inline-formula id="pone.0330604.e164"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e164g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e164.jpg"/><mml:math id="M164" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e165"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e165g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e165.jpg"/><mml:math id="M165" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> are the distances between <inline-formula id="pone.0330604.e166"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e166g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e166.jpg"/><mml:math id="M166" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and the next surface in direction <italic toggle="yes"><bold>n</bold></italic> and <inline-formula id="pone.0330604.e167"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e167g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e167.jpg"/><mml:math id="M167" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> respectively. These values of <inline-formula id="pone.0330604.e168"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e168g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e168.jpg"/><mml:math id="M168" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi>S</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e169"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e169g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e169.jpg"/><mml:math id="M169" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> are finally used instead of <inline-formula id="pone.0330604.e170"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e170g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e170.jpg"/><mml:math id="M170" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi>S</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e171"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e171g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e171.jpg"/><mml:math id="M171" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi>F</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> to compute the probabilities <italic toggle="yes">p</italic><sub><italic toggle="yes">S</italic></sub>, <italic toggle="yes">p</italic><sub><italic toggle="yes">F</italic></sub> and <inline-formula id="pone.0330604.e172"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e172g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e172.jpg"/><mml:math id="M172" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> with <xref rid="pone.0330604.e482" ref-type="disp-formula">Eq 20</xref> (see Algorithm 5 in <xref rid="sec015" ref-type="sec">Appendix D</xref>).</p></sec></sec><sec id="sec009"><title>5 Insensitivity to geometrical refinement</title><p>Before discussing the computation times, we need to describe how we make use of computer graphic tools for accelerating the line-surface intersections when geometrical description involves large numbers of geometrical primitives (triangles as far as we are concerned). We will be very brief because the very same approach is implemented, with the same libraries, in [<xref rid="pone.0330604.ref001" ref-type="bibr">1</xref>]. All required references and technical details can therefore be found in this reference. In short, before the simulation is launched, the geometry is processed (all the triangles defining the system boundary and solid-fluid interface) and a recursive grid is constructed that will be used each time a line-surface intersection is computed. This grid has no impact on the final result: it is only meant to improve the computation times. The main ideas are that the grid is locally refined so that the final elements include only a limited number of geometrical primitives (only a limited number of intersections need to be computed when entering these final elements), and the structure of the grid is designed to optimize data access in memory and to allow efficient out-of-core procedures when needed (when facing large geometrical data sets). The open-source libraries implementing these acceleration tools are star-engine [<xref rid="pone.0330604.ref038" ref-type="bibr">38</xref>] and embree [<xref rid="pone.0330604.ref039" ref-type="bibr">39</xref>].</p><p>A brief summary at this stage:</p><list list-type="bullet"><list-item><p>thanks to double randomization, coupling is handled with simple successions of sub-paths dedicated to each physics (<xref rid="sec003" ref-type="sec">Sect 2</xref>),</p></list-item><list-item><p>brownian walk algorithms are available that deal with confined domains with line-surface intersections only (<xref rid="sec004" ref-type="sec">Sect 3</xref>),</p></list-item><list-item><p>and acceleration tools are available so that the computation of line-surface intersection will take approximately the same time for small or large numbers of geometrical primitives [<xref rid="pone.0330604.ref001" ref-type="bibr">1</xref>].</p></list-item></list><p>These are the three ideas that lead to the insensitivity that the present article aims to illustrate. We make this illustration using the porous structure of <xref rid="pone.0330604.g005" ref-type="fig">Figs 5</xref> and <xref rid="pone.0330604.g006" ref-type="fig">6</xref>. An elementary structure is set as a stack of four Kelvin cells in direction <inline-formula id="pone.0330604.e179"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e179g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e179.jpg"/><mml:math id="M179" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and is deployed in the two orthogonal directions <inline-formula id="pone.0330604.e180"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e180g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e180.jpg"/><mml:math id="M180" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e181"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e181g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e181.jpg"/><mml:math id="M181" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> to form a solid foam that will be crossed by a flow. At the inlet face the flow is uniform, parallel to <inline-formula id="pone.0330604.e182"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e182g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e182.jpg"/><mml:math id="M182" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. The three dimensional velocity field inside the foam is obtained numerically using a standard fluid mechanics solver. A symmetry condition is used for the lateral faces of the foam so that the velocity field is computed only once using the elementary structure (see <xref rid="pone.0330604.g005" ref-type="fig">Fig 5</xref>): the symmetry imposes that the flow remains the same in each stack of four Kelvin cells whatever the number of time this structure is deployed. We therefore define a porous geometry that can be enlarged by multiplying the number of pores as required, without the need to recompute the internal flow for each new configuration. As far as solid/fluid densities and the distribution function <italic toggle="yes">f</italic> are concerned, the same symmetry assumption is made at the four lateral faces of the deployed foam: null diffusive and advecto-diffusive fluxes, as well as specular reflection for linear transport. The inlet and outlet faces are shifted away from the foam (once the strand thickness at the inlet, twice the Kelvin-cell thickness at the outlet). At these two faces, the boundary conditions are therefore required only for the density in the fluid and the distribution function:</p><list list-type="bullet"><list-item><p>the density <inline-formula id="pone.0330604.e183"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e183g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e183.jpg"/><mml:math id="M183" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> in the fluid is uniform at a known value <inline-formula id="pone.0330604.e184"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e184g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e184.jpg"/><mml:math id="M184" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>B</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> along the inlet face <inline-formula id="pone.0330604.e185"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e185g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e185.jpg"/><mml:math id="M185" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>&#8745;</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>,</p></list-item><list-item><p>the diffusion flux in the fluid is null at the outlet and lateral faces <inline-formula id="pone.0330604.e186"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e186g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e186.jpg"/><mml:math id="M186" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub><mml:mo>&#8745;</mml:mo><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (<italic toggle="yes">e.g.</italic> at the outlet face, the gradient <inline-formula id="pone.0330604.e187"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e187g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e187.jpg"/><mml:math id="M187" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> for the density <inline-formula id="pone.0330604.e188"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e188g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e188.jpg"/><mml:math id="M188" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is null in the <inline-formula id="pone.0330604.e189"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e189g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e189.jpg"/><mml:math id="M189" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> direction),</p></list-item><list-item><p>the distribution function <italic toggle="yes">f</italic> for incoming directions at the inlet face is isotropic at <inline-formula id="pone.0330604.e190"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e190g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e190.jpg"/><mml:math id="M190" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mo>&#8722;</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mo>&#8722;</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mover><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mi>&#963;</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> where <inline-formula id="pone.0330604.e191"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e191g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e191.jpg"/><mml:math id="M191" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula> is the 2D center position on inlet face and <italic toggle="yes">&#963;</italic> is five times the size of a single pore (see <xref rid="pone.0330604.g006" ref-type="fig">Fig 6</xref>),</p></list-item><list-item><p>incoming distribution function at the outlet is uniform and isotropic at <inline-formula id="pone.0330604.e192"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e192g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e192.jpg"/><mml:math id="M192" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>,</p></list-item><list-item><p>incoming distribution function on the lateral faces is provided by specular reflection boundary conditions,</p></list-item><list-item><p>the diffusion flux in the solid is null at the lateral faces <inline-formula id="pone.0330604.e193"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e193g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e193.jpg"/><mml:math id="M193" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo>&#8745;</mml:mo><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (there is no solid at the inlet and outlet faces, <italic toggle="yes">i.e.</italic>
<inline-formula id="pone.0330604.e194"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e194g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e194.jpg"/><mml:math id="M194" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo>&#8745;</mml:mo><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>D</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>&#8709;</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>).</p></list-item></list><fig position="float" id="pone.0330604.g005" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.g005</object-id><label>Fig 5</label><caption><title>Stack of 4 kelvin cells and surface representation of the fluid flow for an homogeneous inlet fluid flow on the bottom right face and an outlet at the top left face.</title><p>Fluid velocity at inlet face is <inline-formula id="pone.0330604.e173"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e173g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e173.jpg"/><mml:math id="M173" display="inline" overflow="scroll"><mml:mrow><mml:mn>0.35</mml:mn><mml:mspace width="0.167em"/><mml:mi>m</mml:mi><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>; maximum velocity is <inline-formula id="pone.0330604.e174"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e174g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e174.jpg"/><mml:math id="M174" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mspace width="0.167em"/><mml:mi>m</mml:mi><mml:mo>.</mml:mo><mml:msup><mml:mi>s</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>. Pore size is <inline-formula id="pone.0330604.e175"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e175g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e175.jpg"/><mml:math id="M175" display="inline" overflow="scroll"><mml:mrow><mml:mn>4</mml:mn><mml:mspace width="0.167em"/><mml:mi>m</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> and strand thickness is <inline-formula id="pone.0330604.e176"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e176g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e176.jpg"/><mml:math id="M176" display="inline" overflow="scroll"><mml:mrow><mml:mn>0.7</mml:mn><mml:mspace width="0.167em"/><mml:mi>m</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. This configuration is an emblematic example to study heat transfer (see <xref rid="sec022" ref-type="sec">Appendix F</xref> for the correspondences with such problems).</p></caption><graphic xmlns:xlink="http://www.w3.org/1999/xlink" position="float" orientation="portrait" xlink:href="pone.0330604.g005.jpg"/></fig><fig position="float" id="pone.0330604.g006" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.g006</object-id><label>Fig 6</label><caption><title>a) Representation of the deployed porous media submitted to an incident isotropic distribution function <italic toggle="yes">f</italic><sub><italic toggle="yes">i</italic></sub> with gaussian spatial profile at the inlet face.</title><p>The gaussian profile ranges between <inline-formula id="pone.0330604.e177"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e177g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e177.jpg"/><mml:math id="M177" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e178"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e178g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e178.jpg"/><mml:math id="M178" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>. b) Representation of a typical path in the 3D geometry, which is constituted by three type of subpaths: advective subpaths (within the fluid) are in green, conductive subpaths (within the solid) in blue and linear transport subpaths (between interfaces, with possible absorption and scattering in the fluid) in red.</p></caption><graphic xmlns:xlink="http://www.w3.org/1999/xlink" position="float" orientation="portrait" xlink:href="pone.0330604.g006.jpg"/></fig><p><xref rid="sec026" ref-type="sec">Appendix F.4</xref> provides an additional validation for the numerical schemes of <xref rid="sec004" ref-type="sec">Sect 3</xref> using one single stack of four Kelvin cells and comparing the Monte Carlo estimates to a full simulation made with a standard deterministic solver. In <xref rid="pone.0330604.g007" ref-type="fig">Fig 7</xref> we display Monte Carlo estimates of the average outlet density <inline-formula id="pone.0330604.e195"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e195g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e195.jpg"/><mml:math id="M195" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mrow><mml:mi>&#951;</mml:mi></mml:mrow><mml:mo stretchy="true">&#175;</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula> (<italic toggle="yes">i.e</italic> the mean density in the fluid at the exit of the system), that start from this four-cells configuration and increase the deployment up to more than ten thousand cells. The problem is truly three-dimensional because of the gaussian-shape incident distribution function <italic toggle="yes">f</italic><sub><italic toggle="yes">i</italic></sub> at the inlet. Typical solving times for a one percent accuracy are 10<italic toggle="yes">s</italic> using a standard laptop, but as announced in introduction, the main result here is the fact that this computation time remains the same whatever the number of cells. Of course, as announced at the end of <xref rid="sec003" ref-type="sec">Sect 2</xref>, the computation time remains a decreasing function of the Knudsen number (or equivalently, an increasing function of the optical thickness).</p><fig position="float" id="pone.0330604.g007" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.g007</object-id><label>Fig 7</label><caption><title>Evolution of the averaged outlet density <inline-formula id="pone.0330604.e196"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e196g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e196.jpg"/><mml:math id="M196" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mrow><mml:mi>&#951;</mml:mi></mml:mrow><mml:mo stretchy="true">&#175;</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula> and computation time for an increasing number of kelvin cells.</title><p>Loading time corresponds to the time required to generate and copy the geometry in the RAM memory as well as to build the acceleration grid, whilst the solving time is the time required to sample 10<sup>4</sup> coupled random paths in the system. Diffusion coefficients are <inline-formula id="pone.0330604.e197"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e197g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e197.jpg"/><mml:math id="M197" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn><mml:mspace width="0.278em"/><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, particles speed is <inline-formula id="pone.0330604.e198"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e198g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e198.jpg"/><mml:math id="M198" display="inline" overflow="scroll"><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn><mml:mspace width="0.167em"/><mml:mi>m</mml:mi><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, surface absorptivity is <inline-formula id="pone.0330604.e199"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e199g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e199.jpg"/><mml:math id="M199" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#945;</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>, single-scattering and absorption frequencies are <inline-formula id="pone.0330604.e200"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e200g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e200.jpg"/><mml:math id="M200" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>12.5</mml:mn><mml:mspace width="0.167em"/><mml:msup><mml:mi>s</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, the single-scattering phase function is isotropic, <italic toggle="yes">viz.</italic>
<inline-formula id="pone.0330604.e201"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e201g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e201.jpg"/><mml:math id="M201" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>. Loading and computation times are obtained with an Intel(R) Core(TM) i9-9880H CPU @ 2.30GHz CPU.</p></caption><graphic xmlns:xlink="http://www.w3.org/1999/xlink" position="float" orientation="portrait" xlink:href="pone.0330604.g007.jpg"/></fig></sec><sec sec-type="conclusions" id="sec010"><title>6 Conclusion</title><p>In the present paper, we tackle the issue of the numerical handling of couplings between diffusion, advection and linear transport in complex geometries. The coupled problem is addressed in the same Monte Carlo terms as for a single physics: the solution of the problem is the expectancy of a random variable attached to a single random path. We combine the different physics (linearly) by dividing this main path into subpaths, each one describing a specific mode of transport. Doing so, we preserve the main idea of starting from the observation location (a camera in computer graphics, the outlet in the example above) and following a random path that visits the system until it reaches the sources. We still construct therefore, in a backward manner (with an adjoint approach), how the sources propagate throughout the system to contribute to the observation, but, with coupling, the path is more elaborate than for linear transport, with subpaths initiated one after the other.</p><p>We show that this approach preserves one on the most remarkable feature of Monte Carlo resolution of linear transport: insensitivity to geometrical refinement of the scene. To be achievable, this insensitivity requires each of the three items listed in the previous section: i) double randomization that enables the switch from one subpath to another, ii) advecto-diffusive walks algorithms compatible with confined domains requiring line-surface intersection only, and iii) acceleration tools developed in the field of computer graphics that make the computation of line-surface intersections insensitive to the number of geometrical primitives.</p><p>This insensitivity means that if we leave aside the modification of the physics itself (i.e. the paths have similar structures in each simulation) then the computation time is the same whatever the number of triangles. We insisted on the second item: this is because we managed to design path-sampling algorithms for brownian walkers in confined spaces using only the geometrical computation of line-triangle intersections. This could very well be revisited if the ongoing computer graphics research on sphere-triangle intersections reaches the same maturity as for line-triangle intersections. At present, we needed this step of slightly revisiting Brownian walks before we could benefit of the third essential point: the use of acceleration structures that are such that once the geometry has been loaded in memory, the computation times associated to the sampling of the path is strictly identical with four or several thousand cells. Altogether, we reach the very same conclusions as those of [<xref rid="pone.0330604.ref001" ref-type="bibr">1</xref>] concerning the handling of heavily detailed volume-descriptions, only now the physics is not restricted to radiative transfer. This enables to run simulation of engineering problems in complex geometries, that can be modified at will as the algorithms are independent of the geometry, which is just handled <italic toggle="yes">via</italic> line-surface intersection procedures. This feature paves the way to optimization procedures when it comes to defining the shape of the system itself.</p><p>In what we have presented here, there is however a strong restriction associated to the linearity of each of the considered phenomenologies and the linearity of their coupling: this is the condition under which double randomization allows the definition of single paths dealing with the coupled problem. Recent propositions [<xref rid="pone.0330604.ref040" ref-type="bibr">40</xref>] pave the way to address nonlinear physics with the same insensitivity property, but for now this results in branching paths statistics [<xref rid="pone.0330604.ref041" ref-type="bibr">41</xref>,<xref rid="pone.0330604.ref042" ref-type="bibr">42</xref>], whose management require a dedicated work.</p><p>We also insisted on the computational costs of multiple scattering in the low Knudsen number regime associated to such Monte Carlo algorithms. We could have also illustrated an increase of the computational cost when increasing the number of Kelvin cells along the foam thickness in <xref rid="sec009" ref-type="sec">Sect 5</xref>: dealing with 5 cells instead of 4 in this direction would have increased the computation times. There is something like a "coupling-Knudsen number" that plays a role similar to the Knudsen number and that is intrinsic to today&#8217;s Monte Carlo simulations. Handling this high-scattering regime remains out of scope of the present paper. However, whatever the geometry, we would still observe an insensitivity to the transversal deployment of the foam.</p></sec><sec id="sec011"><title>Appendix</title></sec><sec id="sec012"><title>A Simulation examples involving diffusion/linear-transport paths</title><p>An infinite uniform static fluid is considered (no drift) for which the fluid density <inline-formula id="pone.0330604.e214"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e214g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e214.jpg"/><mml:math id="M214" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is known outside a rectangular cuboid. The addressed quantity is <inline-formula id="pone.0330604.e215"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e215g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e215.jpg"/><mml:math id="M215" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> at a given location <inline-formula id="pone.0330604.e216"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e216g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e216.jpg"/><mml:math id="M216" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> inside the cuboid. The algorithm is the one from <xref rid="sec003" ref-type="sec">Sect 2</xref> (illustrated in <xref rid="pone.0330604.g002" ref-type="fig">Fig 2</xref>): a brownian walk starts at <inline-formula id="pone.0330604.e217"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e217g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e217.jpg"/><mml:math id="M217" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and is interrupted exponentially in time; at this interruption location a linear-transport path starts until absorption; at the absorption location a new brownian walk is started, etc, until one of the brownian walks is interrupted outside the rectangular cuboid where <inline-formula id="pone.0330604.e218"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e218g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e218.jpg"/><mml:math id="M218" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> is known; the Monte Carlo weight is the value of <inline-formula id="pone.0330604.e219"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e219g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e219.jpg"/><mml:math id="M219" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> at this final location and <inline-formula id="pone.0330604.e220"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e220g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e220.jpg"/><mml:math id="M220" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is estimated as the average of <italic toggle="yes">N</italic> such weights. <xref rid="pone.0330604.t001" ref-type="table">Table 1</xref> provides simulation examples for the following conditions:</p><list list-type="bullet"><list-item><p>The faces of the cuboid are perpendicular to each of the unit vectors of an orthonormal basis <inline-formula id="pone.0330604.e221"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e221g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e221.jpg"/><mml:math id="M221" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">e</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">e</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">e</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, the two extreme summits are (0,0,0) and (<italic toggle="yes">L</italic>,2<italic toggle="yes">L</italic>,3<italic toggle="yes">L</italic>), and the observation location is <inline-formula id="pone.0330604.e222"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e222g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e222.jpg"/><mml:math id="M222" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>.</p></list-item><list-item><p>For <inline-formula id="pone.0330604.e223"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e223g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e223.jpg"/><mml:math id="M223" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> outside the cuboid <inline-formula id="pone.0330604.e224"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e224g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e224.jpg"/><mml:math id="M224" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">a</mml:mi></mml:mrow><mml:mo>&#183;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>b</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> with <inline-formula id="pone.0330604.e225"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e225g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e225.jpg"/><mml:math id="M225" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">a</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn><mml:msup><mml:mi>L</mml:mi><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn><mml:msup><mml:mi>L</mml:mi><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>3</mml:mn><mml:msup><mml:mi>L</mml:mi><mml:mn>4</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e226"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e226g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e226.jpg"/><mml:math id="M226" display="inline" overflow="scroll"><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>.</p></list-item><list-item><p>The absorption Knudsen number <inline-formula id="pone.0330604.e227"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e227g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e227.jpg"/><mml:math id="M227" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mi>L</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> is 1.</p></list-item><list-item><p>The single scattering phase function is Heiney-Greenstein phase function with asymmetry parameter <italic toggle="yes">g</italic>&#8201;=&#8201;0.5.</p></list-item><list-item><p>The scattering Knudsen number <inline-formula id="pone.0330604.e228"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e228g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e228.jpg"/><mml:math id="M228" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mi>L</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> is varied from 0.01 to 100.</p></list-item><list-item><p>The dimensionless diffusion coefficient <inline-formula id="pone.0330604.e229"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e229g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e229.jpg"/><mml:math id="M229" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> is varied from 0.01 to 100.</p></list-item><list-item><p>The number of Monte Carlo samples is <italic toggle="yes">N</italic>&#8201;=&#8201;10<sup>5</sup>.</p></list-item></list><p>In this configuration, the exact solution is <inline-formula id="pone.0330604.e230"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e230g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e230.jpg"/><mml:math id="M230" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mo>,</mml:mo><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>, independently of Knudsen number <inline-formula id="pone.0330604.e231"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e231g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e231.jpg"/><mml:math id="M231" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mi>L</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> and dimensionless diffusion coefficient <inline-formula id="pone.0330604.e232"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e232g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e232.jpg"/><mml:math id="M232" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>. On the other hand, both the number of required samples for a 1% accuracy and the computation time depend on these parameters. The computation time is notably sensitive to the scattering Knudsen number (each multiple-scattering path involve more scattering events when decreasing <inline-formula id="pone.0330604.e233"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e233g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e233.jpg"/><mml:math id="M233" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mi>L</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>) and to the dimensionless diffusion coefficient (when lowering <inline-formula id="pone.0330604.e234"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e234g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e234.jpg"/><mml:math id="M234" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> each diffusive/linear-transport path involves more diffusion/linear-transport switches before exiting the cuboid).</p></sec><sec id="sec013"><title>B Trilinear profile</title><p>Let the trilinear profile <inline-formula id="pone.0330604.e235"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e235g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e235.jpg"/><mml:math id="M235" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">a</mml:mi></mml:mrow><mml:mo>&#183;</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>b</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> be the local expression of the density inside a sphere <inline-formula id="pone.0330604.e236"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e236g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e236.jpg"/><mml:math id="M236" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#119982;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> of radius <inline-formula id="pone.0330604.e237"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e237g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e237.jpg"/><mml:math id="M237" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> around <inline-formula id="pone.0330604.e238"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e238g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e238.jpg"/><mml:math id="M238" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and let us check that <xref rid="pone.0330604.e114" ref-type="disp-formula">Eq 14</xref> gives exactly the density at <inline-formula id="pone.0330604.e239"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e239g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e239.jpg"/><mml:math id="M239" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> when using the adaptative step <inline-formula id="pone.0330604.e240"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e240g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e240.jpg"/><mml:math id="M240" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> defined in <xref rid="sec006" ref-type="sec">Sect 4.1</xref> (thanks to symmetry):</p><disp-formula id="pone.0330604.e241"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e241g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e241.jpg"/><mml:math id="M241" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">[</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8722;</mml:mo><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo fence="true" form="postfix" stretchy="true">]</mml:mo></mml:mrow><mml:mspace linebreak="newline"/><mml:mo>=</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">a</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>b</mml:mi><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mi mathvariant="bold-italic">a</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8722;</mml:mo><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>b</mml:mi><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow><mml:mspace linebreak="newline"/><mml:mo>=</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mrow><mml:mi mathvariant="bold-italic">a</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mn>2</mml:mn><mml:mi>b</mml:mi><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mi mathvariant="bold-italic">a</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:munder><mml:munder><mml:mrow><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>&#9183;</mml:mo></mml:munder><mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:munder><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mspace linebreak="newline"/><mml:mo>=</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:mi>d</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace linebreak="newline"/><mml:mo>=</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula><p>where the unit sphere is noted <inline-formula id="pone.0330604.e242"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e242g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e242.jpg"/><mml:math id="M242" display="inline" overflow="scroll"><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e243"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e243g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e243.jpg"/><mml:math id="M243" display="inline" overflow="scroll"><mml:mrow><mml:mn>2</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> is any hemisphere of that sphere.</p></sec><sec id="sec014"><title>C A Patankar scheme including sources due to linear transport</title><p>In <xref rid="sec007" ref-type="sec">Sect 4.2</xref> we proposed an approximate random walk with drift inspired of Patankar work for advection diffusion in confined domains, with a probability to switch to linear transport at each Patankar step. This appendix provides the developments leading to this set of probability. The resulting path-sampling algorithm is presented in the <xref rid="sec015" ref-type="sec">appendix D</xref> (see algorithm 3).</p><p>We address the following advection-diffusion equation with a source due to the coupling with linear transport (see <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 2</xref> where <inline-formula id="pone.0330604.e244"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e244g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e244.jpg"/><mml:math id="M244" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:mo>.</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mi>&#951;</mml:mi><mml:mo>&#8722;</mml:mo><mml:mo>&#8747;</mml:mo><mml:mi>f</mml:mi><mml:mtext>&#160;</mml:mtext><mml:mi>d</mml:mi><mml:mi>u</mml:mi><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> according to <xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 3</xref>; we note <inline-formula id="pone.0330604.e245"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e245g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e245.jpg"/><mml:math id="M245" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>&#8747;</mml:mo><mml:mi>f</mml:mi><mml:mtext>&#160;</mml:mtext><mml:mi>d</mml:mi><mml:mi>u</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> as in <xref rid="sec007" ref-type="sec">Sect 4.2</xref>):</p><disp-formula id="pone.0330604.e246"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e246g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e246.jpg"/><mml:math id="M246" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:mo>&#183;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>&#951;</mml:mi><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></alternatives><label>(23)</label></disp-formula><p>where the flux density vector is</p><disp-formula id="pone.0330604.e247"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e247g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e247.jpg"/><mml:math id="M247" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:mi>&#951;</mml:mi><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mi>&#951;</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives><label>(24)</label></disp-formula><p>Using a finite volume approach, the balance on a cubic volume element of edge <italic toggle="yes">&#948;</italic> centered at <inline-formula id="pone.0330604.e248"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e248g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e248.jpg"/><mml:math id="M248" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> writes</p><disp-formula id="pone.0330604.e249"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e249g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e249.jpg"/><mml:math id="M249" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mo>&#8721;</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>6</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msup><mml:mi>&#948;</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></alternatives><label>(25)</label></disp-formula><p>where the densities <italic toggle="yes">&#951;</italic> and <inline-formula id="pone.0330604.e250"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e250g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e250.jpg"/><mml:math id="M250" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>T</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> in the source term of <xref rid="pone.0330604.e246" ref-type="disp-formula">Eq 23</xref> have been taken uniform and equal to the densities <inline-formula id="pone.0330604.e251"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e251g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e251.jpg"/><mml:math id="M251" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e252"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e252g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e252.jpg"/><mml:math id="M252" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> at the center of the volume element.</p><p>The fluxes <italic toggle="yes">J</italic><sub><italic toggle="yes">k</italic>&#8201;=&#8201;1,2,3,4,5,6</sub> through the 6 faces of the cube are approximated according to Patankar approach, that uses the analytic solution of one dimensional advection-diffusion equations <inline-formula id="pone.0330604.e253"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e253g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e253.jpg"/><mml:math id="M253" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>. 6 independent one-dimensional equations are constructed by projecting the flux density vector on the outward-pointing normals <inline-formula id="pone.0330604.e254"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e254g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e254.jpg"/><mml:math id="M254" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi><mml:mo mathvariant="bold">=</mml:mo><mml:mn mathvariant="bold">1</mml:mn><mml:mo mathvariant="bold">,</mml:mo><mml:mn mathvariant="bold">2</mml:mn><mml:mo mathvariant="bold">,</mml:mo><mml:mn mathvariant="bold">3</mml:mn><mml:mo mathvariant="bold">,</mml:mo><mml:mn mathvariant="bold">4</mml:mn><mml:mo mathvariant="bold">,</mml:mo><mml:mn mathvariant="bold">5</mml:mn><mml:mo mathvariant="bold">,</mml:mo><mml:mn mathvariant="bold">6</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> on each face of the cube:</p><disp-formula id="pone.0330604.e255"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e255g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e255.jpg"/><mml:math id="M255" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:mo>&#183;</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mo>&#183;</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#183;</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></alternatives><label>(26)</label></disp-formula><p>with Dirichlet boundary conditions at <inline-formula id="pone.0330604.e256"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e256g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e256.jpg"/><mml:math id="M256" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e257"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e257g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e257.jpg"/><mml:math id="M257" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> (<italic toggle="yes">&#951;</italic> is known). The solution of this equation is</p><disp-formula id="pone.0330604.e258"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e258g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e258.jpg"/><mml:math id="M258" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#963;</mml:mi><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mi>exp</mml:mi><mml:mrow><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:msub><mml:mtext>Pe</mml:mtext><mml:mi>k</mml:mi></mml:msub><mml:mfrac><mml:mrow><mml:mi>&#963;</mml:mi></mml:mrow><mml:mrow><mml:mi>&#948;</mml:mi></mml:mrow></mml:mfrac><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow></mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mtext>Pe</mml:mtext><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mo stretchy="false">(</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mi>&#963;</mml:mi><mml:mo>&#8712;</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>&#948;</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(27)</label></disp-formula><p>with the Peclet numbers <inline-formula id="pone.0330604.e259"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e259g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e259.jpg"/><mml:math id="M259" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mtext>Pe</mml:mtext><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>. The projections <inline-formula id="pone.0330604.e260"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e260g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e260.jpg"/><mml:math id="M260" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mo>&#183;</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> of the flux density vector (see <xref rid="pone.0330604.e247" ref-type="disp-formula">Eq 24</xref>) are obtained by differentiating <xref rid="pone.0330604.e258" ref-type="disp-formula">Eq 27</xref> with respect to <italic toggle="yes">&#963;</italic> to write the diffusion term <inline-formula id="pone.0330604.e261"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e261g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e261.jpg"/><mml:math id="M261" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:mi>&#951;</mml:mi><mml:mo>&#183;</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mfrac><mml:mrow><mml:mo>&#8706;</mml:mo><mml:mi>&#951;</mml:mi></mml:mrow><mml:mrow><mml:mo>&#8706;</mml:mo><mml:mi>&#963;</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> and by substituting <xref rid="pone.0330604.e258" ref-type="disp-formula">Eq 27</xref> into the advection term <inline-formula id="pone.0330604.e262"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e262g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e262.jpg"/><mml:math id="M262" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>&#183;</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mi>&#951;</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>:</p><disp-formula id="pone.0330604.e263"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e263g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e263.jpg"/><mml:math id="M263" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mo>&#183;</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>&#183;</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mtext>Pe</mml:mtext><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mstyle><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></alternatives><label>(28)</label></disp-formula><p>This expression is used in the balance <xref rid="pone.0330604.e249" ref-type="disp-formula">Eq 25</xref>, assuming uniform flux densities on each face of the cubic volume element equal to the flux density at the center of the face (<inline-formula id="pone.0330604.e264"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e264g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e264.jpg"/><mml:math id="M264" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mi>&#948;</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mo>&#183;</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>):</p><disp-formula id="pone.0330604.e265"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e265g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e265.jpg"/><mml:math id="M265" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mo>&#8721;</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>6</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">[</mml:mo><mml:msub><mml:mtext>Pe</mml:mtext><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mfrac><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>exp</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mtext>Pe</mml:mtext><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow><mml:mo fence="true" form="postfix" stretchy="true">]</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:msup><mml:mi>&#948;</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo stretchy="false">(</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></alternatives><label>(29)</label></disp-formula><p>Finally, we choose to orient the cubic volume element such that <inline-formula id="pone.0330604.e266"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e266g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e266.jpg"/><mml:math id="M266" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>v</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e267"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e267g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e267.jpg"/><mml:math id="M267" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>v</mml:mi><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, leading to :</p><disp-formula id="pone.0330604.e268"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e268g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e268.jpg"/><mml:math id="M268" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mtext>Pe</mml:mtext><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:mtext>Pe</mml:mtext></mml:mrow></mml:mrow></mml:math></alternatives><label>(30)</label></disp-formula><disp-formula id="pone.0330604.e269"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e269g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e269.jpg"/><mml:math id="M269" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mtext>Pe</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mtext>Pe</mml:mtext></mml:mrow></mml:mrow></mml:math></alternatives><label>(31)</label></disp-formula><disp-formula id="pone.0330604.e270"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e270g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e270.jpg"/><mml:math id="M270" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mtext>Pe</mml:mtext><mml:mn>3</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mtext>Pe</mml:mtext><mml:mn>4</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mtext>Pe</mml:mtext><mml:mn>5</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mtext>Pe</mml:mtext><mml:mn>6</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:math></alternatives><label>(32)</label></disp-formula><p>where <inline-formula id="pone.0330604.e271"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e271g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e271.jpg"/><mml:math id="M271" display="inline" overflow="scroll"><mml:mrow><mml:mtext>Pe</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>. Doing so (and using <inline-formula id="pone.0330604.e272"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e272g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e272.jpg"/><mml:math id="M272" display="inline" overflow="scroll"><mml:mrow><mml:munder><mml:mo>lim</mml:mo><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>&#8594;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:munder><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mi>exp</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>) we obtain the following expression for <inline-formula id="pone.0330604.e273"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e273g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e273.jpg"/><mml:math id="M273" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>:</p><disp-formula id="pone.0330604.e274"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e274g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e274.jpg"/><mml:math id="M274" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:msub><mml:mi>&#951;</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mo>&#8721;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>6</mml:mn></mml:msubsup><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mi>&#948;</mml:mi><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">u</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(33)</label></disp-formula><p>with</p><disp-formula id="pone.0330604.e275"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e275g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e275.jpg"/><mml:math id="M275" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>T</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfrac><mml:mrow><mml:msup><mml:mi>&#948;</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>&#8722;</mml:mo><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>&#8722;</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:msup><mml:mi>&#948;</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></alternatives><label>(34)</label></disp-formula><disp-formula id="pone.0330604.e276"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e276g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e276.jpg"/><mml:math id="M276" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>&#8722;</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>&#8722;</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mi>exp</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>&#8722;</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>&#8722;</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></alternatives><label>(35)</label></disp-formula><disp-formula id="pone.0330604.e277"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e277g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e277.jpg"/><mml:math id="M277" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mi>exp</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mi>exp</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>&#8722;</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>&#8722;</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></alternatives><label>(36)</label></disp-formula><disp-formula id="pone.0330604.e278"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e278g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e278.jpg"/><mml:math id="M278" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>5</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>6</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mi>exp</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mfrac><mml:mrow><mml:mtext>Pe</mml:mtext></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>&#8722;</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>&#8722;</mml:mo><mml:mtext>Pe</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></alternatives><label>(37)</label></disp-formula><p>Working on the ratios of exponential functions, those probabilities can be reformulated as in <xref rid="pone.0330604.e481" ref-type="disp-formula">Eq 16</xref>.</p></sec><sec id="sec015"><title>D Algorithms</title><p>This appendix gathers all the propositions of <xref rid="sec005" ref-type="sec">Sect 4</xref> under an algorithmic form. These algorithms are those used in <xref rid="sec009" ref-type="sec">Sect 5</xref>.</p><p>
<bold>Algorithm 1. Monte Carlo algorithm used to evaluate <inline-formula id="pone.0330604.e279"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e279g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e279.jpg"/><mml:math id="M279" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>.</bold>
</p><disp-formula id="pone.0330604.e489"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e489g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e489.jpg"/></disp-formula><p>
<bold>Algorithm 2. Random walk for diffusion starting from point <inline-formula id="pone.0330604.e286"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e286g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e286.jpg"/><mml:math id="M286" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> in <inline-formula id="pone.0330604.e287"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e287g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e287.jpg"/><mml:math id="M287" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mi>\</mml:mi><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (see <xref rid="sec006" ref-type="sec">Sect 4.1</xref>)</bold>
</p><disp-formula id="pone.0330604.e490"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e490g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e490.jpg"/></disp-formula><p>
<bold>Algorithm 3. Random walk for advection-diffusion coupled with linear transport, starting from point <inline-formula id="pone.0330604.e297"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e297g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e297.jpg"/><mml:math id="M297" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> in <inline-formula id="pone.0330604.e298"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e298g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e298.jpg"/><mml:math id="M298" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub><mml:mi>\</mml:mi><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (see <xref rid="sec007" ref-type="sec">Sect 4.2</xref>).</bold>
</p><disp-formula id="pone.0330604.e491"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e491g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e491.jpg"/></disp-formula><p>
<bold>Algorithm 4. Random walk for linear transport starting from point <inline-formula id="pone.0330604.e317"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e317g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e317.jpg"/><mml:math id="M317" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> in <inline-formula id="pone.0330604.e318"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e318g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e318.jpg"/><mml:math id="M318" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub><mml:mo>&#8746;</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, in direction <italic toggle="yes"><bold>u</bold></italic>.</bold>
</p><disp-formula id="pone.0330604.e492"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e492g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e492.jpg"/></disp-formula><p>
<bold>Algorithm 5. Random walk for boundary conditions starting from point <inline-formula id="pone.0330604.e341"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e341g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e341.jpg"/><mml:math id="M341" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> on <inline-formula id="pone.0330604.e342"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e342g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e342.jpg"/><mml:math id="M342" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>S</mml:mi></mml:msub><mml:mo>&#8746;</mml:mo><mml:mo>&#8706;</mml:mo><mml:msub><mml:mo>&#937;</mml:mo><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> with normal <italic toggle="yes"><bold>n</bold></italic> (see Sect <xref rid="sec008" ref-type="sec">4.3</xref>).</bold>
</p><disp-formula id="pone.0330604.e493"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e493g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e493.jpg"/></disp-formula></sec><sec id="sec016"><title>E Validation</title><sec id="sec017"><title>E.1 Validation of the proposed random path compatible with ray tracing against an analytic solution for pure diffusion</title><p>Let us consider the following boundary value problem :</p><disp-formula id="pone.0330604.e371"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e371g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e371.jpg"/><mml:math id="M371" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>&#916;</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:mo>&#937;</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(38)</label></disp-formula><disp-formula id="pone.0330604.e372"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e372g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e372.jpg"/><mml:math id="M372" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>&#8722;</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msub></mml:mrow><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msub></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:mo>&#8706;</mml:mo><mml:mo>&#937;</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(39)</label></disp-formula><p>for which <xref rid="pone.0330604.e372" ref-type="disp-formula">Eq 39</xref> is solution everywhere in the field.</p><p>Results in <xref rid="pone.0330604.t002" ref-type="table">Table 2</xref> are obtained with Algorithm 1, along with Algorithms 2 and 5 (where we always have <inline-formula id="pone.0330604.e373"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e373g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e373.jpg"/><mml:math id="M373" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> here), in the case where &#937; is the unit cube defined by <inline-formula id="pone.0330604.e374"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e374g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e374.jpg"/><mml:math id="M374" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8704;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:mo>&#937;</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pone.0330604.e375"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e375g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e375.jpg"/><mml:math id="M375" display="inline" overflow="scroll"><mml:mrow><mml:mn>0</mml:mn><mml:mo>&#8804;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow><mml:mo>&#8804;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula> where <inline-formula id="pone.0330604.e376"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e376g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e376.jpg"/><mml:math id="M376" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">O</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is an orthonormal basis.</p><table-wrap position="float" id="pone.0330604.t002" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.t002</object-id><label>Table 2</label><caption><title>Results of Algorithms 1, 2, and 5 for <inline-formula id="pone.0330604.e380"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e380g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e380.jpg"/><mml:math id="M380" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">N</mml:mi><mml:mo mathvariant="bold">=</mml:mo><mml:mn mathvariant="bold">10000</mml:mn></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> random samples on an analytic boundary value problem <inline-formula id="pone.0330604.e381"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e381g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e381.jpg"/><mml:math id="M381" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">&#951;</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> in a unit cube for various values of position <inline-formula id="pone.0330604.e382"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e382g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e382.jpg"/><mml:math id="M382" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo mathvariant="bold">=</mml:mo><mml:mfrac><mml:mrow><mml:mo mathvariant="bold" stretchy="false">|</mml:mo><mml:mo mathvariant="bold" stretchy="false">|</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow><mml:mo mathvariant="bold" stretchy="false">|</mml:mo><mml:mo mathvariant="bold" stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:mn mathvariant="bold">3</mml:mn></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and step length <inline-formula id="pone.0330604.e383"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e383g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e383.jpg"/><mml:math id="M383" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#948;</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">S</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>.</title><p>Monte Carlo results are shown in column <inline-formula id="pone.0330604.e384"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e384g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e384.jpg"/><mml:math id="M384" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mrow><mml:mi>&#951;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula> along with their corresponding standard error <italic toggle="yes">&#963;</italic>.</p></caption><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.t002g" position="float" orientation="portrait" xlink:href="pone.0330604.t002.jpg"/><table frame="hsides" rules="groups"><colgroup span="1"><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/></colgroup><thead><tr><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e385">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e385g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e385.jpg"/><mml:math id="M385" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#948;</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">S</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1">
<italic toggle="yes">x</italic>
</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e386">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e386g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e386.jpg"/><mml:math id="M386" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">&#951;</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e387">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e387g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e387.jpg"/><mml:math id="M387" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mover><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">&#951;</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e388">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e388g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e388.jpg"/><mml:math id="M388" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">&#963;</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives>
</inline-formula>
</th></tr></thead><tbody><tr><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">1.3</td><td align="left" rowspan="1" colspan="1">1.297</td><td align="left" rowspan="1" colspan="1">0.0026</td></tr><tr><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">0.3</td><td align="left" rowspan="1" colspan="1">1.9</td><td align="left" rowspan="1" colspan="1">1.889</td><td align="left" rowspan="1" colspan="1">0.0077</td></tr><tr><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">2.5</td><td align="left" rowspan="1" colspan="1">2.479</td><td align="left" rowspan="1" colspan="1">0.0109</td></tr><tr><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">0.7</td><td align="left" rowspan="1" colspan="1">3.1</td><td align="left" rowspan="1" colspan="1">3.099</td><td align="left" rowspan="1" colspan="1">0.0104</td></tr><tr><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">0.9</td><td align="left" rowspan="1" colspan="1">3.7</td><td align="left" rowspan="1" colspan="1">3.706</td><td align="left" rowspan="1" colspan="1">0.0053</td></tr><tr><td align="left" colspan="5" rowspan="1"/></tr><tr><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">1.3</td><td align="left" rowspan="1" colspan="1">1.302</td><td align="left" rowspan="1" colspan="1">0.0025</td></tr><tr><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">0.3</td><td align="left" rowspan="1" colspan="1">1.9</td><td align="left" rowspan="1" colspan="1">1.895</td><td align="left" rowspan="1" colspan="1">0.0075</td></tr><tr><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">2.5</td><td align="left" rowspan="1" colspan="1">2.499</td><td align="left" rowspan="1" colspan="1">0.0105</td></tr><tr><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">0.7</td><td align="left" rowspan="1" colspan="1">3.1</td><td align="left" rowspan="1" colspan="1">3.097</td><td align="left" rowspan="1" colspan="1">0.0101</td></tr><tr><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">0.9</td><td align="left" rowspan="1" colspan="1">3.7</td><td align="left" rowspan="1" colspan="1">3.705</td><td align="left" rowspan="1" colspan="1">0.0051</td></tr><tr><td align="left" rowspan="1" colspan="1">0.05</td><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">1.3</td><td align="left" rowspan="1" colspan="1">1.301</td><td align="left" rowspan="1" colspan="1">0.0025</td></tr><tr><td align="left" rowspan="1" colspan="1">0.05</td><td align="left" rowspan="1" colspan="1">0.3</td><td align="left" rowspan="1" colspan="1">1.9</td><td align="left" rowspan="1" colspan="1">1.907</td><td align="left" rowspan="1" colspan="1">0.0075</td></tr><tr><td align="left" rowspan="1" colspan="1">0.05</td><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">2.5</td><td align="left" rowspan="1" colspan="1">2.503</td><td align="left" rowspan="1" colspan="1">0.0106</td></tr><tr><td align="left" rowspan="1" colspan="1">0.05</td><td align="left" rowspan="1" colspan="1">0.7</td><td align="left" rowspan="1" colspan="1">3.1</td><td align="left" rowspan="1" colspan="1">3.097</td><td align="left" rowspan="1" colspan="1">0.0101</td></tr><tr><td align="left" rowspan="1" colspan="1">0.05</td><td align="left" rowspan="1" colspan="1">0.9</td><td align="left" rowspan="1" colspan="1">3.7</td><td align="left" rowspan="1" colspan="1">3.702</td><td align="left" rowspan="1" colspan="1">0.0051</td></tr></tbody></table></alternatives></table-wrap><p>These results indicate good convergence even for step lengths as big as half of the domain&#8217;s size (<italic toggle="yes">i.e.</italic>
<inline-formula id="pone.0330604.e377"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e377g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e377.jpg"/><mml:math id="M377" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>). Such a good convergence is granted by the simplicity of the geometry of the domain &#937; along with relatively smooth Dirichlet conditions on <inline-formula id="pone.0330604.e378"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e378g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e378.jpg"/><mml:math id="M378" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8706;</mml:mo><mml:mo>&#937;</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. In general, a step length of about 1/20th of the domain&#8217;s size should be retained in order to ensure a minimum convergence (<italic toggle="yes">i.e.</italic>
<inline-formula id="pone.0330604.e379"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e379g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e379.jpg"/><mml:math id="M379" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>).</p></sec><sec id="sec018"><title>E.2 Validation of the random path compatible with ray tracing against an analytic solution for advection-diffusion</title><p>Let us consider the following boundary value problem :</p><disp-formula id="pone.0330604.e398"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e398g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e398.jpg"/><mml:math id="M398" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mo>&#916;</mml:mo><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:mo>&#937;</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(40)</label></disp-formula><disp-formula id="pone.0330604.e399"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e399g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e399.jpg"/><mml:math id="M399" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:mn>4</mml:mn><mml:mspace width="0.167em"/><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:mo>&#937;</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(41)</label></disp-formula><disp-formula id="pone.0330604.e400"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e400g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e400.jpg"/><mml:math id="M400" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mi>&#951;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msub></mml:mrow><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msub></mml:mrow><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mspace width="2em"/><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:mo>&#8706;</mml:mo><mml:mo>&#937;</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(42)</label></disp-formula><p>for which <xref rid="pone.0330604.e400" ref-type="disp-formula">Eq 42</xref> is solution everywhere in the field.</p><p>Results in <xref rid="pone.0330604.t003" ref-type="table">Table 3</xref> are obtained with Algorithm 1, along with Algorithms 3 and 5 (where we always have <inline-formula id="pone.0330604.e401"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e401g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e401.jpg"/><mml:math id="M401" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:msub><mml:mrow><mml:mi>&#8492;</mml:mi></mml:mrow><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> here), in the case where &#937; is the unit cube defined by <inline-formula id="pone.0330604.e402"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e402g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e402.jpg"/><mml:math id="M402" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8704;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>&#8712;</mml:mo><mml:mo>&#937;</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pone.0330604.e403"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e403g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e403.jpg"/><mml:math id="M403" display="inline" overflow="scroll"><mml:mrow><mml:mn>0</mml:mn><mml:mo>&#8804;</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:mrow><mml:mo>&#8804;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula> where <inline-formula id="pone.0330604.e404"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e404g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e404.jpg"/><mml:math id="M404" display="inline" overflow="scroll"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">O</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is an orthonormal basis.</p><table-wrap position="float" id="pone.0330604.t003" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.t003</object-id><label>Table 3</label><caption><title>Results of Algorithms 1, 3, and 5 for <inline-formula id="pone.0330604.e389"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e389g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e389.jpg"/><mml:math id="M389" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">N</mml:mi><mml:mo mathvariant="bold">=</mml:mo><mml:mn mathvariant="bold">10000</mml:mn></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> random samples on an analytic boundary value problem <inline-formula id="pone.0330604.e390"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e390g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e390.jpg"/><mml:math id="M390" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">&#951;</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> in a unit cube for various values of position <inline-formula id="pone.0330604.e391"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e391g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e391.jpg"/><mml:math id="M391" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">1</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">2</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo>.</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">e</mml:mi><mml:mn mathvariant="bold">3</mml:mn></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi><mml:mo mathvariant="bold">=</mml:mo><mml:mfrac><mml:mrow><mml:mo mathvariant="bold" stretchy="false">|</mml:mo><mml:mo mathvariant="bold" stretchy="false">|</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow></mml:mrow><mml:mo mathvariant="bold" stretchy="false">|</mml:mo><mml:mo mathvariant="bold" stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:mn mathvariant="bold">3</mml:mn></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and step length <inline-formula id="pone.0330604.e392"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e392g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e392.jpg"/><mml:math id="M392" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#948;</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>.</title><p>Monte Carlo results are shown in column <inline-formula id="pone.0330604.e393"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e393g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e393.jpg"/><mml:math id="M393" display="inline" overflow="scroll"><mml:mrow><mml:mover><mml:mrow><mml:mi>&#951;</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula> along with their corresponding standard error <italic toggle="yes">&#963;</italic>.</p></caption><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.t003g" position="float" orientation="portrait" xlink:href="pone.0330604.t003.jpg"/><table frame="hsides" rules="groups"><colgroup span="1"><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/></colgroup><thead><tr><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e394">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e394g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e394.jpg"/><mml:math id="M394" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#948;</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">F</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1">
<italic toggle="yes">x</italic>
</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e395">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e395g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e395.jpg"/><mml:math id="M395" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">&#951;</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e396">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e396g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e396.jpg"/><mml:math id="M396" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mover><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">&#951;</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives>
</inline-formula>
</th><th align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e397">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e397g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e397.jpg"/><mml:math id="M397" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">&#963;</mml:mi></mml:mrow></mml:mrow></mml:math></alternatives>
</inline-formula>
</th></tr></thead><tbody><tr><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">1.12</td><td align="left" rowspan="1" colspan="1">1.123</td><td align="left" rowspan="1" colspan="1">0.0029</td></tr><tr><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">0.3</td><td align="left" rowspan="1" colspan="1">1.48</td><td align="left" rowspan="1" colspan="1">1.474</td><td align="left" rowspan="1" colspan="1">0.0077</td></tr><tr><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">2</td><td align="left" rowspan="1" colspan="1">2.005</td><td align="left" rowspan="1" colspan="1">0.0094</td></tr><tr><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">0.7</td><td align="left" rowspan="1" colspan="1">2.68</td><td align="left" rowspan="1" colspan="1">2.682</td><td align="left" rowspan="1" colspan="1">0.0082</td></tr><tr><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">0.9</td><td align="left" rowspan="1" colspan="1">3.52</td><td align="left" rowspan="1" colspan="1">
<bold>3.533</bold>
</td><td align="left" rowspan="1" colspan="1">
<bold>0.0040</bold>
</td></tr><tr><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">1.12</td><td align="left" rowspan="1" colspan="1">1.117</td><td align="left" rowspan="1" colspan="1">0.0028</td></tr><tr><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">0.3</td><td align="left" rowspan="1" colspan="1">1.48</td><td align="left" rowspan="1" colspan="1">1.476</td><td align="left" rowspan="1" colspan="1">0.0078</td></tr><tr><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">2</td><td align="left" rowspan="1" colspan="1">2.000</td><td align="left" rowspan="1" colspan="1">0.0098</td></tr><tr><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">0.7</td><td align="left" rowspan="1" colspan="1">2.68</td><td align="left" rowspan="1" colspan="1">2.675</td><td align="left" rowspan="1" colspan="1">0.0085</td></tr><tr><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">0.9</td><td align="left" rowspan="1" colspan="1">3.52</td><td align="left" rowspan="1" colspan="1">3.525</td><td align="left" rowspan="1" colspan="1">0.0040</td></tr><tr><td align="left" rowspan="1" colspan="1">0.05</td><td align="left" rowspan="1" colspan="1">0.1</td><td align="left" rowspan="1" colspan="1">1.12</td><td align="left" rowspan="1" colspan="1">1.116</td><td align="left" rowspan="1" colspan="1">0.0027</td></tr><tr><td align="left" rowspan="1" colspan="1">0.05</td><td align="left" rowspan="1" colspan="1">0.3</td><td align="left" rowspan="1" colspan="1">1.48</td><td align="left" rowspan="1" colspan="1">1.490</td><td align="left" rowspan="1" colspan="1">0.0078</td></tr><tr><td align="left" rowspan="1" colspan="1">0.05</td><td align="left" rowspan="1" colspan="1">0.5</td><td align="left" rowspan="1" colspan="1">2</td><td align="left" rowspan="1" colspan="1">2.005</td><td align="left" rowspan="1" colspan="1">0.0098</td></tr><tr><td align="left" rowspan="1" colspan="1">0.05</td><td align="left" rowspan="1" colspan="1">0.7</td><td align="left" rowspan="1" colspan="1">2.68</td><td align="left" rowspan="1" colspan="1">2.671</td><td align="left" rowspan="1" colspan="1">0.0085</td></tr><tr><td align="left" rowspan="1" colspan="1">0.05</td><td align="left" rowspan="1" colspan="1">0.9</td><td align="left" rowspan="1" colspan="1">3.52</td><td align="left" rowspan="1" colspan="1">3.522</td><td align="left" rowspan="1" colspan="1">0.0041</td></tr></tbody></table></alternatives></table-wrap><p>By comparison with the pure diffusion example of <xref rid="sec017" ref-type="sec">Sect E.1</xref>, present results indicate good convergence but not for step lengths as big as half of the domain&#8217;s size anymore (see result in red). <inline-formula id="pone.0330604.e405"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e405g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e405.jpg"/><mml:math id="M405" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> plays therefore the role of standard numerical parameter for which convergence must be specifically tested (the value of 1/20th of the domain&#8217;s size suggested above for pure diffusion can not be retained as such).</p></sec><sec id="sec019"><title>E.3 Trade-offs between accuracy and computational efficiency</title><sec id="sec020"><title>E.3.1 Discussion on the Bias introduced by the step size and wall re-injection in random walks.</title><p>To begin this discussion, it is helpful to distinguish between two types of random walks used in this work: those modeling pure linear transport and those representing advective-diffusive phenomena. As already stated, random walks for linear transport are strictly unbiased, and the associated Monte Carlo methods are well-established and robust.</p><p>More fundamentally, it is important to clarify that there are two distinct sources of bias, which are not always clearly separated in the literature:</p><list list-type="order"><list-item><p>A discretization bias, which arises when the original physical equations are numerically approximated using finite-difference schemes or equivalent operators. This bias is independent of the Monte Carlo method itself and reflects a modeling approximation.</p></list-item><list-item><p>A statistical bias, which may occur if the Monte Carlo method fails to produce an exact estimator of the target (discretized or continuous) equations. This occurs when the sampling method does not yield a statistically consistent estimator of the equation being solved.</p></list-item></list><p>When we refer to an unbiased random walk, we mean that neither of these two biases is present: the method both exactly represents the physical equations and provides a statistically exact Monte Carlo estimator.</p><p>Returning to the advective-diffusive case: bias-related issues must be treated differently depending on whether the walk occurs in the interior of the domain or originates from the boundary. In certain idealized conditions (such as uniform velocity and thermophysical fields) it is possible to construct unbiased interior walks (e.g., using WOS combined with Von Mises-Fisher directional sampling). However, generating unbiased walks from boundaries is substantially more challenging.</p><p>Given the generality of the method we propose in this article, we choose to accept the presence of discretization-related bias in both the interior walks and the wall re-injection mechanism. In practical terms, the bias introduced by the step size (whether in the bulk or at the boundary) can be interpreted through the lens of finite-difference approximations. We refer the reader to [<xref rid="pone.0330604.ref011" ref-type="bibr">11</xref>] which shows a rigorous equivalence between the bias of random walks with fixed step size <italic toggle="yes">&#948;</italic> and the discretization error <inline-formula id="pone.0330604.e406"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e406g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e406.jpg"/><mml:math id="M406" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mi>D</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> from finite-difference schemes with <inline-formula id="pone.0330604.e407"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e407g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e407.jpg"/><mml:math id="M407" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mi>D</mml:mi></mml:mrow></mml:msub><mml:mo>&#8771;</mml:mo><mml:mi>&#948;</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>.</p><p>In this sense, the bias we refer to is essentially that of a finite-difference representation of the advective-diffusive operator. Importantly, the Monte Carlo estimator we construct remains statistically unbiased with respect to this discretized formulation. This interpretation places our method within the established framework of deterministic numerical schemes, and thus allows for the use of standard numerical analysis techniques, including truncation error estimation and convergence studies, as commonly applied to finite-difference schemes.</p></sec><sec id="sec021"><title>E.3.2 Computational performance as a function of step size.</title><p>The question of computational performance cannot, of course, be separated from the issue of bias discussed above. Indeed, achieving an acceptable level of bias, compatible with the desired accuracy constraints, requires choosing a random walk step that is sufficiently small relative to the physical and geometric features of the scene. In practice, this means that the step must be small enough to resolve the relevant characteristic lengths, whether they originate from geometry (such as curvature, obstacles, or interfaces) or from physical considerations (such as gradients in state variables or spatial variations in boundary conditions and source terms within the volume). Ensuring that the random walk step is adequate to capture these spatial variations with sufficient precision is essential for both accuracy and reliability of the simulation.</p><p>This naturally leads to the question of computation time, given the choice of a specific random walk step. To properly address this issue, it is essential to distinguish between two separate aspects. The first concerns the computational cost associated with each individual step, particularly the geometric intersection tests with the scene. The second relates to the estimation of the average number of steps required per path within the domain.</p><p>The first aspect is discussed elsewhere in the text, where we show that techniques originally developed in the context of image synthesis and computer graphics provide highly efficient tools for performing intersection queries in a manner that is largely insensitive to geometric complexity.</p><p>The second aspect, which concerns estimating the average number of steps per walk, is a significantly more subtle problem rooted in physics and mathematics. It is generally studied under the notion of first-passage times to the boundary, which may refer either to the first exit from an interior point or to the first return to the boundary after a re-injection.</p><p>There exist, in this context, both well-established classical results and more subtle findings that have emerged from recent work, particularly in the field of statistical physics. For example, in the case of purely diffusive transport or for Boltzmann walkers as described earlier in this paper, the scaling behavior of the mean number of steps is well known. The reader interested in deeper or more complex behaviors may refer to discussions such as those in [<xref rid="pone.0330604.ref044" ref-type="bibr">44</xref>&#8211;<xref rid="pone.0330604.ref046" ref-type="bibr">46</xref>]. In typical diffusive regimes, whether the underlying walk is Brownian-like or of Boltzmann type with a small mean free path, it is straightforward to show that the mean number of steps required to reach the boundary scales as <inline-formula id="pone.0330604.e408"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e408g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e408.jpg"/><mml:math id="M408" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msup><mml:mi>&#948;</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, where <italic toggle="yes">&#948;</italic> is the random walk step. Consequently, reducing the step size by one order of magnitude results in an approximate hundredfold increase in the total number of steps, and thus in computation time.</p><p>However, it is crucial to recognize that this specific scaling, while serving as a useful guide in many standard situations, does not directly apply in full generality to the problems we address here. A more problem-specific analysis is necessary, due in particular to the following features:</p><list list-type="bullet"><list-item><p>When the walk reaches a boundary, it may continue on either side, depending on a re-injection rule governed by the physical properties of the adjacent media.</p></list-item><list-item><p>Each complete path consists of segments alternating between advective-diffusive motion and pure linear transport, with the transition probabilities between regimes also determined by the physical properties of the materials involved.</p></list-item><list-item><p>The interplay between advection and diffusion can produce highly nontrivial first-passage characteristics. For instance, in the case of a strongly oriented, essentially one-dimensional flow with dominant advection, the number of steps required to reach a boundary may remain relatively small. In contrast, in flow configurations dominated by recirculation, such as vortices or closed streamlines, advection can trap the walker and the escape becomes possible only through diffusion.</p></list-item></list><p>In summary, it is essential to perform a dedicated analysis for each specific problem to estimate the mean number of steps per path. Fortunately, the physicist familiar with the structure of the system under consideration often possesses enough insight to derive reasonable estimates of these quantities, and thus to anticipate how a change in the random walk step may affect computation time.</p></sec></sec></sec><sec id="sec022"><title>F Application to heat transfer</title><p>The model studied in the body of the article is quite general and can be applied to different applicative fields, <italic toggle="yes">e.g.</italic> neutron transport, charge carrier transport in semiconductors <italic toggle="yes">etc.</italic>, as discussed in introduction. Among these potential applications, here we detail how the present work can be directly used to address heat transfer problems.</p><p>The example in <xref rid="sec009" ref-type="sec">Sect 5</xref> is directly inspired of an academic porous exchanger from the heat transfer literature [<xref rid="pone.0330604.ref043" ref-type="bibr">43</xref>]. The main assumption in such standard heat transfer applications is that radiative transfer can be linearized as function of temperature, which imposes that the relative temperature differences remain limited. This assumption is detailled in <xref rid="sec023" ref-type="sec">F.1</xref>. <xref rid="sec024" ref-type="sec">F.2</xref> provides the resulting correspondences between the model addressed in the body of the article and heat transfer. <xref rid="sec025" ref-type="sec">F.3</xref> and <xref rid="sec026" ref-type="sec">F.4</xref> provide numerical solutions, obtained from standard heat transfer solvers, that are used for validation.</p><sec id="sec023"><title>F.1 Radiance temperatures</title><p>We start from the stationary radiative transfer equation formulated in terms of monochromatic specific intensity <inline-formula id="pone.0330604.e409"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e409g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e409.jpg"/><mml:math id="M409" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi></mml:msub><mml:mo>&#8801;</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> at position <inline-formula id="pone.0330604.e410"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e410g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e410.jpg"/><mml:math id="M410" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, in direction <inline-formula id="pone.0330604.e411"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e411g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e411.jpg"/><mml:math id="M411" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> at time <italic toggle="yes">t</italic> and frequency <inline-formula id="pone.0330604.e412"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e412g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e412.jpg"/><mml:math id="M412" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> :</p><disp-formula id="pone.0330604.e413"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e413g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e413.jpg"/><mml:math id="M413" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>.</mml:mo><mml:mover><mml:mrow><mml:mo>&#8711;</mml:mo></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:msub><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo>&#8722;</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>&#957;</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mi>&#8242;</mml:mi></mml:msubsup><mml:mi>d</mml:mi><mml:msup><mml:mi>u</mml:mi><mml:mi>&#8242;</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:math></alternatives><label>(43)</label></disp-formula><p>where <inline-formula id="pone.0330604.e414"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e414g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e414.jpg"/><mml:math id="M414" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> is the absorption coefficient, <inline-formula id="pone.0330604.e415"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e415g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e415.jpg"/><mml:math id="M415" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> the scattering coefficient, <inline-formula id="pone.0330604.e416"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e416g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e416.jpg"/><mml:math id="M416" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>&#957;</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> the scattering phase function, <inline-formula id="pone.0330604.e417"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e417g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e417.jpg"/><mml:math id="M417" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mi>&#8242;</mml:mi></mml:msubsup><mml:mo>&#8801;</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e418"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e418g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e418.jpg"/><mml:math id="M418" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo>&#8801;</mml:mo><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>&#952;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> the specific equilibrium intensity at temperature <inline-formula id="pone.0330604.e419"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e419g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e419.jpg"/><mml:math id="M419" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#952;</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> within the medium. Although the radiative transfer is stationary, <inline-formula id="pone.0330604.e420"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e420g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e420.jpg"/><mml:math id="M420" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> depends on <italic toggle="yes">t</italic> due to the evolution of the solid and fluid temperature.</p><p>Assuming that for all times and positions, the solid and fluid temperature remains close to a reference temperature <inline-formula id="pone.0330604.e421"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e421g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e421.jpg"/><mml:math id="M421" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, the temperature dependence of the specific equilibrium intensity can be linearized:</p><disp-formula id="pone.0330604.e422"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e422g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e422.jpg"/><mml:math id="M422" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>&#952;</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8776;</mml:mo><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mo>&#8706;</mml:mo><mml:mi>&#952;</mml:mi></mml:msub><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>&#952;</mml:mi><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(44)</label></disp-formula><p>Moreover, equilibrium properties allow to write :</p><disp-formula id="pone.0330604.e423"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e423g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e423.jpg"/><mml:math id="M423" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mn>0</mml:mn><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo>&#8722;</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>&#957;</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mi>d</mml:mi><mml:msup><mml:mi>u</mml:mi><mml:mi>&#8242;</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:math></alternatives><label>(45)</label></disp-formula><p>Introducing the notation <inline-formula id="pone.0330604.e424"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e424g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e424.jpg"/><mml:math id="M424" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mover><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mi>&#957;</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>&#8722;</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> for the perturbations and subtracting <xref rid="pone.0330604.e413" ref-type="disp-formula">Eqs (43)</xref> and <xref rid="pone.0330604.e423" ref-type="disp-formula">(45)</xref>, the radiative transfer equation under the assumption <xref rid="pone.0330604.e422" ref-type="disp-formula">(44)</xref> can be written as follows:</p><disp-formula id="pone.0330604.e425"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e425g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e425.jpg"/><mml:math id="M425" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>.</mml:mo><mml:mover><mml:mrow><mml:mo>&#8711;</mml:mo></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:msub><mml:mover><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mi>&#957;</mml:mi></mml:msub><mml:mo>&#8776;</mml:mo><mml:mo>&#8722;</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mover><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mi>&#957;</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mo>&#8706;</mml:mo><mml:mi>&#952;</mml:mi></mml:msub><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>&#952;</mml:mi><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>&#8722;</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mover><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mi>&#957;</mml:mi></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>&#957;</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mover><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mi>&#957;</mml:mi><mml:mi>&#8242;</mml:mi></mml:msubsup><mml:mi>d</mml:mi><mml:msup><mml:mi>u</mml:mi><mml:mi>&#8242;</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:math></alternatives><label>(46)</label></disp-formula><p>We choose to rewrite this equation using the radiance temperature <inline-formula id="pone.0330604.e426"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e426g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e426.jpg"/><mml:math id="M426" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>&#957;</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> in the direction <inline-formula id="pone.0330604.e427"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e427g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e427.jpg"/><mml:math id="M427" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. This radiance temperature is a spectral and directional quantity defined as the temperature for which the equilibrium specific intensity is equal to the specific intensity:</p><disp-formula id="pone.0330604.e428"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e428g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e428.jpg"/><mml:math id="M428" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>&#957;</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(47)</label></disp-formula><p>Using <xref rid="pone.0330604.e422" ref-type="disp-formula">Eq 44</xref> to express <inline-formula id="pone.0330604.e429"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e429g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e429.jpg"/><mml:math id="M429" display="inline" overflow="scroll"><mml:mrow><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>&#957;</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">x</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>,</p><disp-formula id="pone.0330604.e430"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e430g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e430.jpg"/><mml:math id="M430" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi></mml:msub><mml:mo>&#8776;</mml:mo><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mo>&#8706;</mml:mo><mml:mi>&#952;</mml:mi></mml:msub><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>&#957;</mml:mi></mml:msubsup><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(48)</label></disp-formula><p>and therefore,</p><disp-formula id="pone.0330604.e431"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e431g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e431.jpg"/><mml:math id="M431" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mover><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mo stretchy="false">~</mml:mo></mml:mover><mml:mi>&#957;</mml:mi></mml:msub><mml:mo>&#8776;</mml:mo><mml:msub><mml:mo>&#8706;</mml:mo><mml:mi>&#952;</mml:mi></mml:msub><mml:msubsup><mml:mi>I</mml:mi><mml:mi>&#957;</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>&#957;</mml:mi></mml:msubsup><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives><label>(49)</label></disp-formula><p><xref rid="pone.0330604.e425" ref-type="disp-formula">Eq 46</xref> becomes :</p><disp-formula id="pone.0330604.e432"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e432g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e432.jpg"/><mml:math id="M432" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>.</mml:mo><mml:mover><mml:mrow><mml:mo>&#8711;</mml:mo></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>&#957;</mml:mi></mml:msubsup><mml:mo>&#8776;</mml:mo><mml:mo>&#8722;</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>&#957;</mml:mi></mml:msubsup><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:mi>&#952;</mml:mi><mml:mo>&#8722;</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>&#957;</mml:mi></mml:msubsup><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>&#957;</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:mi mathvariant="bold-italic">&#8242;</mml:mi></mml:msup></mml:mrow></mml:mrow><mml:mi>&#957;</mml:mi></mml:msubsup><mml:mi>d</mml:mi><mml:msup><mml:mi>u</mml:mi><mml:mi>&#8242;</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:math></alternatives><label>(50)</label></disp-formula><p>For didactic reasons we here make the assumption of grey absorbing and scattering fluid (there would be no difficulty associated to the full preserving of spectral dependancies), which writes :</p><disp-formula id="pone.0330604.e433"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e433g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e433.jpg"/><mml:math id="M433" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo>.</mml:mo><mml:mover><mml:mrow><mml:mo>&#8711;</mml:mo></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:msub><mml:mo>&#8776;</mml:mo><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mi>&#952;</mml:mi><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:msub><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:mi mathvariant="bold-italic">&#8242;</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:msub><mml:mi>d</mml:mi><mml:msup><mml:mi>u</mml:mi><mml:mi>&#8242;</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:math></alternatives><label>(51)</label></disp-formula><p>with <inline-formula id="pone.0330604.e434"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e434g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e434.jpg"/><mml:math id="M434" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:msub><mml:mo>&#8801;</mml:mo><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>&#957;</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> at all frequencies <inline-formula id="pone.0330604.e435"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e435g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e435.jpg"/><mml:math id="M435" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#957;</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>.</p><p>Similarly at the boundary :</p><disp-formula id="pone.0330604.e436"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e436g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e436.jpg"/><mml:math id="M436" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>&#945;</mml:mi><mml:mi>&#952;</mml:mi><mml:mspace width="0.167em"/><mml:mrow><mml:mo>+</mml:mo></mml:mrow><mml:mspace width="0.167em"/><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>&#8722;</mml:mo><mml:mi>&#945;</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mtext>&#160;</mml:mtext><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:msup><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:mi mathvariant="bold-italic">&#8242;</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:msub><mml:mtext>&#160;</mml:mtext><mml:mi>d</mml:mi><mml:msup><mml:mover><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:mi>&#8242;</mml:mi></mml:msup></mml:mrow></mml:mrow></mml:math></alternatives><label>(52)</label></disp-formula><p>where <italic toggle="yes">&#945;</italic> is the surface absorptivity (or emissivity), <italic toggle="yes">&#952;</italic> the surface temperature and <inline-formula id="pone.0330604.e437"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e437g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e437.jpg"/><mml:math id="M437" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> the distribution for reflection directions.</p><p><xref rid="pone.0330604.e433" ref-type="disp-formula">Eqs 51</xref> and <xref rid="pone.0330604.e436" ref-type="disp-formula">52</xref> define a closed system for <inline-formula id="pone.0330604.e438"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e438g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e438.jpg"/><mml:math id="M438" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> from wich the volumic radiative power <inline-formula id="pone.0330604.e439"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e439g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e439.jpg"/><mml:math id="M439" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#968;</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and the surfacic radiative power <inline-formula id="pone.0330604.e440"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e440g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e440.jpg"/><mml:math id="M440" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#966;</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> write</p><disp-formula id="pone.0330604.e441"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e441g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e441.jpg"/><mml:math id="M441" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>&#968;</mml:mi><mml:mi>R</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:mi>&#950;</mml:mi><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mi>&#952;</mml:mi><mml:mo>&#8722;</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:msub><mml:mi>d</mml:mi><mml:mi>u</mml:mi><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></alternatives><label>(53)</label></disp-formula><p>and</p><disp-formula id="pone.0330604.e442"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e442g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e442.jpg"/><mml:math id="M442" display="block" overflow="scroll"><mml:mrow><mml:mrow><mml:msub><mml:mi>&#966;</mml:mi><mml:mi>R</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>&#8722;</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>R</mml:mi></mml:msub><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mi>&#952;</mml:mi><mml:mo>&#8722;</mml:mo><mml:msub><mml:mo>&#8747;</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mi>&#8242;</mml:mi></mml:msup><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mover><mml:mrow><mml:mi>u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:mo>.</mml:mo><mml:mover><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi>&#960;</mml:mi></mml:mrow></mml:mfrac><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:msub><mml:mi>d</mml:mi><mml:mi>u</mml:mi><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></alternatives><label>(53)</label></disp-formula><p>with <inline-formula id="pone.0330604.e443"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e443g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e443.jpg"/><mml:math id="M443" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#950;</mml:mi><mml:mo>=</mml:mo><mml:mn>16</mml:mn><mml:msub><mml:mi>k</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mi>&#963;</mml:mi><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pone.0330604.e444"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e444g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e444.jpg"/><mml:math id="M444" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>R</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>4</mml:mn><mml:mi>&#945;</mml:mi><mml:mi>&#963;</mml:mi><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, <italic toggle="yes">&#945;</italic> is the surface emissivity and <italic toggle="yes">&#963;</italic> the Stefan-Boltzmann constant.</p></sec><sec id="sec024"><title>F.2 Correspondences of physical quantities</title><p><xref rid="pone.0330604.t004" ref-type="table">Table 4</xref> provides the correspondences between the model addressed in the body of the article and heat transfer problems. Substituting these correspondences in the model Eqs <xref rid="pone.0330604.e478" ref-type="disp-formula">1</xref>&#8211;<xref rid="pone.0330604.e480" ref-type="disp-formula">10</xref> the resulting heat transfer model is:</p><disp-formula id="pone.0330604.e485"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e485g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e485.jpg"/></disp-formula><p>where we used <inline-formula id="pone.0330604.e454"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e454g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e454.jpg"/><mml:math id="M454" display="inline" overflow="scroll"><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mrow><mml:mo mathvariant="bold">&#8711;</mml:mo></mml:mrow><mml:mo>.</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>&#968;</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (see <xref rid="pone.0330604.e441" ref-type="disp-formula">Eq 53</xref>); <inline-formula id="pone.0330604.e455"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e455g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e455.jpg"/><mml:math id="M455" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e456"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e456g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e456.jpg"/><mml:math id="M456" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> are the temperatures within the solid and the fluid respectively. At the solid-fluid interface,</p><disp-formula id="pone.0330604.e486"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e486g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e486.jpg"/></disp-formula><p>where we used <inline-formula id="pone.0330604.e457"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e457g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e457.jpg"/><mml:math id="M457" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow><mml:mi>T</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>&#966;</mml:mi><mml:mi>R</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (see <xref rid="pone.0330604.e441" ref-type="disp-formula">Eq 53</xref>). At the boundary of the system,</p><disp-formula id="pone.0330604.e487"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e487g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e487.jpg"/></disp-formula><table-wrap position="float" id="pone.0330604.t004" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.t004</object-id><label>Table 4</label><caption><title>Correspondences between the model addressed in the body of the article and heat transfer problems.</title></caption><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.t004g" position="float" orientation="portrait" xlink:href="pone.0330604.t004.jpg"/><table frame="hsides" rules="groups"><colgroup span="1"><col align="left" valign="middle" span="1"/><col align="left" valign="middle" span="1"/></colgroup><thead><tr><th align="left" rowspan="1" colspan="1">Model in <xref rid="sec002" ref-type="sec">Sect 1</xref></th><th align="left" rowspan="1" colspan="1">Heat transfer problems</th></tr></thead><tbody><tr><td align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e445">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e445g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e445.jpg"/><mml:math id="M445" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>&#951;</mml:mi></mml:mrow><mml:mrow><mml:mi>&#961;</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives>
</inline-formula>
</td><td align="left" rowspan="1" colspan="1"><italic toggle="yes">&#952;</italic> (temperature); We choose <inline-formula id="pone.0330604.e446"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e446g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e446.jpg"/><mml:math id="M446" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#961;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:msub><mml:mi>C</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>&#961;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:msub><mml:mi>C</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>&#961;</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> for the sake of simplicity (this is not a restriction of the approach)</td></tr><tr><td align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e447">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e447g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e447.jpg"/><mml:math id="M447" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>4</mml:mn><mml:mi>&#960;</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>&#961;</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives>
</inline-formula>
</td><td align="left" rowspan="1" colspan="1"><inline-formula id="pone.0330604.e448"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e448g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e448.jpg"/><mml:math id="M448" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold-italic">u</mml:mi></mml:mrow><mml:mo stretchy="true">&#8594;</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (radiance temperature)</td></tr><tr><td align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e449">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e449g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e449.jpg"/><mml:math id="M449" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives>
</inline-formula>
</td><td align="left" rowspan="1" colspan="1"><italic toggle="yes">k</italic><sub><italic toggle="yes">a</italic></sub> (absorption coefficient)</td></tr><tr><td align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e450">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e450g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e450.jpg"/><mml:math id="M450" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives>
</inline-formula>
</td><td align="left" rowspan="1" colspan="1"><italic toggle="yes">k</italic><sub><italic toggle="yes">s</italic></sub> (scattering coefficient)</td></tr><tr><td align="left" rowspan="1" colspan="1">
<inline-formula id="pone.0330604.e451">
<alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e451g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e451.jpg"/><mml:math id="M451" display="inline" overflow="scroll"><mml:mrow><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mfrac><mml:mrow><mml:mi>&#961;</mml:mi><mml:mi>C</mml:mi><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>16</mml:mn><mml:mi>&#963;</mml:mi></mml:mrow></mml:mfrac><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow><mml:msup><mml:mi>&#8192;</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives>
</inline-formula>
</td><td align="left" rowspan="1" colspan="1"><inline-formula id="pone.0330604.e452"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e452g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e452.jpg"/><mml:math id="M452" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> (reference temperature for radiation linearisation); this correspondence is of application for the definition of the particles speed <italic toggle="yes">c</italic>.</td></tr><tr><td align="left" rowspan="1" colspan="1">
<italic toggle="yes">D</italic>
</td><td align="left" rowspan="1" colspan="1"><inline-formula id="pone.0330604.e453"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e453g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e453.jpg"/><mml:math id="M453" display="inline" overflow="scroll"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>&#955;</mml:mi></mml:mrow><mml:mrow><mml:mi>&#961;</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> (thermal diffusivity), where <italic toggle="yes">&#955;</italic> is the thermal conductivity.</td></tr><tr><td align="left" rowspan="1" colspan="1">
<xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 1</xref>
</td><td align="left" rowspan="1" colspan="1">Steady state heat equation for opaque solids.</td></tr><tr><td align="left" rowspan="1" colspan="1">
<xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 2</xref>
</td><td align="left" rowspan="1" colspan="1">Steady state advection-diffusion heat equation for semi-transparent fluids.</td></tr><tr><td align="left" rowspan="1" colspan="1">
<xref rid="pone.0330604.e478" ref-type="disp-formula">Eq 3</xref>
</td><td align="left" rowspan="1" colspan="1">Radiative transfer <xref rid="pone.0330604.e433" ref-type="disp-formula">Eq 51</xref></td></tr></tbody></table></alternatives></table-wrap><p>Note that using the definition of the particles speed <italic toggle="yes">c</italic> as a function of <inline-formula id="pone.0330604.e458"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e458g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e458.jpg"/><mml:math id="M458" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> provided in <xref rid="pone.0330604.t004" ref-type="table">Table 4</xref>, the probability set for path-switching at the boundaries in <xref rid="pone.0330604.e482" ref-type="disp-formula">Eq 20</xref> becomes</p><disp-formula id="pone.0330604.e488"><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e488g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e488.jpg"/></disp-formula><p>where <inline-formula id="pone.0330604.e459"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e459g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e459.jpg"/><mml:math id="M459" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>R</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>4</mml:mn><mml:mi>&#945;</mml:mi><mml:mi>&#963;</mml:mi><mml:msubsup><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mn>3</mml:mn></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>; <inline-formula id="pone.0330604.e460"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e460g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e460.jpg"/><mml:math id="M460" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#955;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e461"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e461g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e461.jpg"/><mml:math id="M461" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#955;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> are the thermal conductivity for the solid and fluid respectively.</p></sec><sec id="sec025"><title>F.3 Poiseuille duct</title><p>Algorithm 5 along with Algorithms 2 and 3 are used to solve the 2D configuration presented in <xref rid="pone.0330604.g008" ref-type="fig">Fig 8</xref>: a cold Poiseuille flow enters a 2D solid duct which is heated by its external faces. In this configuration, no radiation is taken into account. Results are compared with a <italic toggle="yes">Comsol Multiphysics</italic> simulation in <xref rid="pone.0330604.g009" ref-type="fig">Fig 9</xref> for various positions in the domain. The number of Monte Carlo samples are kept at 1000 so that error-bars remain visible.</p><fig position="float" id="pone.0330604.g008" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.g008</object-id><label>Fig 8</label><caption><title>2D-slice of an isolated duct structure used as a heat exchanger between a thermal source at <inline-formula id="pone.0330604.e466"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e466g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e466.jpg"/><mml:math id="M466" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#952;</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">h</mml:mi><mml:mi mathvariant="bold-italic">o</mml:mi><mml:mi mathvariant="bold-italic">t</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and an incoming cold Poiseuille circulation at <inline-formula id="pone.0330604.e467"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e467g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e467.jpg"/><mml:math id="M467" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#952;</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">c</mml:mi><mml:mi mathvariant="bold-italic">o</mml:mi><mml:mi mathvariant="bold-italic">l</mml:mi><mml:mi mathvariant="bold-italic">d</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>.</title><p>Retained values for the simulation are: <inline-formula id="pone.0330604.e468"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e468g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e468.jpg"/><mml:math id="M468" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pone.0330604.e469"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e469g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e469.jpg"/><mml:math id="M469" display="inline" overflow="scroll"><mml:mrow><mml:mi>&#981;</mml:mi><mml:mo>=</mml:mo><mml:mn>0.8</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>, where <italic toggle="yes">&#981;</italic> is the ratio of inner duct radius over outer radius, <inline-formula id="pone.0330604.e470"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e470g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e470.jpg"/><mml:math id="M470" display="inline" overflow="scroll"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#955;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>&#955;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>, where <inline-formula id="pone.0330604.e471"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e471g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e471.jpg"/><mml:math id="M471" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#955;</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e472"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e472g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e472.jpg"/><mml:math id="M472" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#955;</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> are the thermal conductivity for the solid and fluid respectively, and <inline-formula id="pone.0330604.e473"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e473g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e473.jpg"/><mml:math id="M473" display="inline" overflow="scroll"><mml:mrow><mml:mo>max</mml:mo><mml:mrow><mml:mo fence="true" form="prefix" stretchy="true">(</mml:mo><mml:mfrac><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">v</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>F</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo fence="true" form="postfix" stretchy="true">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>, where <italic toggle="yes">a</italic><sub><italic toggle="yes">F</italic></sub> is the thermal diffusivity for the fluid.</p></caption><graphic xmlns:xlink="http://www.w3.org/1999/xlink" position="float" orientation="portrait" xlink:href="pone.0330604.g008.jpg"/></fig><fig position="float" id="pone.0330604.g009" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.g009</object-id><label>Fig 9</label><caption><title>Poiseillle duct results. Comparison of the temperature obtained with Comsol Multiphysics and the Monte Algorithm for the configuration defined in <xref rid="pone.0330604.g008" ref-type="fig">Fig 8</xref>.</title><p>In these simulations, <inline-formula id="pone.0330604.e474"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e474g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e474.jpg"/><mml:math id="M474" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>&#948;</mml:mi><mml:mi>F</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>100</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>.</p></caption><graphic xmlns:xlink="http://www.w3.org/1999/xlink" position="float" orientation="portrait" xlink:href="pone.0330604.g009.jpg"/></fig></sec><sec id="sec026"><title>F.4 Kelvin-cell porous heat exchanger</title><p>Algorithm 5 along with Algorithms 2, 3 and 4 are used to solve the 3D configuration presented in <xref rid="pone.0330604.g005" ref-type="fig">Fig 5</xref>: a solid stack of 4 kelvin cells is heated by a radiative temperature <inline-formula id="pone.0330604.e462"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e462g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e462.jpg"/><mml:math id="M462" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> set on the inlet face and cooled by the fluid at <inline-formula id="pone.0330604.e463"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e463g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e463.jpg"/><mml:math id="M463" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> which enters by the same face. On the outlet face, the radiative temperature is set at <inline-formula id="pone.0330604.e464"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e464g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e464.jpg"/><mml:math id="M464" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#952;</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> to represent the environment. As in <xref rid="sec009" ref-type="sec">Sect 5</xref>, symmetry boundary conditions are used on the lateral faces. Radiative transfer is here reduced to only direct exchange between surfaces (the fluid is perfectly transparent, <italic toggle="yes">i.e.</italic>
<inline-formula id="pone.0330604.e465"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e465g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e465.jpg"/><mml:math id="M465" display="inline" overflow="scroll"><mml:mrow><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>&#957;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>). Results are compared with an <italic toggle="yes">ANSYS Fluent</italic> simulation in <xref rid="pone.0330604.g010" ref-type="fig">Fig 10</xref>.</p><fig position="float" id="pone.0330604.g010" orientation="portrait"><object-id pub-id-type="doi">10.1371/journal.pone.0330604.g010</object-id><label>Fig 10</label><caption><title>Comparison of the temperature obtained with ANSYS Fluent and the Monte Algorithm for the stack of 4 Kelvin cells presented in <xref rid="pone.0330604.g005" ref-type="fig">Fig 5</xref>.</title><p>Results for locations on the center line going down the flow; the inlet face is at adimensionned position 0 and the outlet at adimensionned position 1. In order to obtain a curve showing high variations of temperature in the fluid, the solid&#8217;s and fluid&#8217;s thermal diffusivities are respectively set at <inline-formula id="pone.0330604.e475"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e475g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e475.jpg"/><mml:math id="M475" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mn>80.10</mml:mn><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:msup><mml:mspace width="0.167em"/><mml:msup><mml:mi>m</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>.</mml:mo><mml:msup><mml:mi>s</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pone.0330604.e476"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e476g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e476.jpg"/><mml:math id="M476" display="inline" overflow="scroll"><mml:mrow><mml:msup><mml:mn>130.10</mml:mn><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:msup><mml:mspace width="0.167em"/><mml:msup><mml:mi>m</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>.</mml:mo><mml:msup><mml:mi>s</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>. The inlet velocity field is uniform at <inline-formula id="pone.0330604.e477"><alternatives><graphic xmlns:xlink="http://www.w3.org/1999/xlink" id="pone.0330604.e477g" position="anchor" orientation="portrait" xlink:href="pone.0330604.e477.jpg"/><mml:math id="M477" display="inline" overflow="scroll"><mml:mrow><mml:mn>1</mml:mn><mml:mspace width="0.167em"/><mml:mi>m</mml:mi><mml:mo>.</mml:mo><mml:msup><mml:mi>s</mml:mi><mml:mrow><mml:mo>&#8722;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>.</p></caption><graphic xmlns:xlink="http://www.w3.org/1999/xlink" position="float" orientation="portrait" xlink:href="pone.0330604.g010.jpg"/></fig></sec></sec><sec id="sec027" sec-type="supplementary-material"><title>Supporting information</title><supplementary-material id="pone.0330604.s001" position="float" content-type="local-data" orientation="portrait"><label>S1 File</label><caption><title>This contains the data used to draw <xref rid="pone.0330604.g007" ref-type="fig">Fig 7</xref>.</title><p>(TXT)</p></caption><media xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="pone.0330604.s001.txt" position="float" orientation="portrait"/></supplementary-material><supplementary-material id="pone.0330604.s002" position="float" content-type="local-data" orientation="portrait"><label>S2 File</label><caption><title>This contains the data computed with Comsol Multiphysics that are represented in <xref rid="pone.0330604.g009" ref-type="fig">Fig 9</xref>.</title><p>(TXT)</p></caption><media xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="pone.0330604.s002.txt" position="float" orientation="portrait"/></supplementary-material><supplementary-material id="pone.0330604.s003" position="float" content-type="local-data" orientation="portrait"><label>S3 File</label><caption><title>This contains the data computed with our Monte Carlo approach that are represented in <xref rid="pone.0330604.g009" ref-type="fig">Fig 9</xref>.</title><p>(TXT)</p></caption><media xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="pone.0330604.s003.txt" position="float" orientation="portrait"/></supplementary-material><supplementary-material id="pone.0330604.s004" position="float" content-type="local-data" orientation="portrait"><label>S4 File</label><caption><title>This contains the data computed with ANSYS Fluent that are represented in <xref rid="pone.0330604.g010" ref-type="fig">Fig 10</xref>.</title><p>(TXT)</p></caption><media xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="pone.0330604.s004.txt" position="float" orientation="portrait"/></supplementary-material><supplementary-material id="pone.0330604.s005" position="float" content-type="local-data" orientation="portrait"><label>S5 File</label><caption><title>This contains the data computed with our Monte Carlo approach that are represented in <xref rid="pone.0330604.g010" ref-type="fig">Fig 10</xref>.</title><p>(TXT)</p></caption><media xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="pone.0330604.s005.txt" position="float" orientation="portrait"/></supplementary-material></sec></body><back><ref-list><title>References</title><ref id="pone.0330604.ref001"><label>1</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Villefranque</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Fournier</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Couvreux</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Cornet</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Eymet</surname><given-names>V</given-names></name>, <etal>et al</etal>. <article-title>A path-tracing Monte Carlo Library for 3-D radiative transfer in highly resolved cloudy atmospheres</article-title>. <source>J Adv Model Earth Syst.</source><year>2019</year>;<volume>11</volume>(<issue>8</issue>):<fpage>2449</fpage>&#8211;<lpage>73</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1029/2018ms001602</pub-id></mixed-citation></ref><ref id="pone.0330604.ref002"><label>2</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Nyffenegger-P&#233;r&#233;</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Armante</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Bati</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Dufresne</surname><given-names>J-L</given-names></name>, <name name-style="western"><surname>Hafi</surname><given-names>ME</given-names></name>, <etal>et al</etal>. <article-title>Spectrally refined unbiased Monte Carlo estimate of the Earth&#8217;s global radiative cooling</article-title>. <source>Proc Natl Acad Sci U S A.</source><year>2024</year>;<volume>121</volume>(<issue>5</issue>):e2315492121. <comment>doi: </comment><pub-id pub-id-type="doi">10.1073/pnas.2315492121</pub-id><pub-id pub-id-type="pmid">38252841</pub-id><pub-id pub-id-type="pmcid">PMC10835068</pub-id></mixed-citation></ref><ref id="pone.0330604.ref003"><label>3</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Dauchet</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Charon</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Brunel</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Cornet</surname><given-names>J-F</given-names></name>, <name name-style="western"><surname>Coustet</surname><given-names>C</given-names></name>, <etal>et al</etal>. <article-title>Wave-scattering processes: path-integrals designed for the numerical handling of complex geometries</article-title>. <source>Opt Lett.</source><year>2023</year>;<volume>48</volume>(<issue>18</issue>):<fpage>4909</fpage>&#8211;<lpage>12</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1364/OL.500487</pub-id><pub-id pub-id-type="pmid">37707934</pub-id></mixed-citation></ref><ref id="pone.0330604.ref004"><label>4</label><mixed-citation publication-type="other">Kac M, et al. On some connections between probability theory and differential and integral equations. In: Proceedings of the second Berkeley symposium on mathematical statistics and probability. The Regents of the University of California; 1951.</mixed-citation></ref><ref id="pone.0330604.ref005"><label>5</label><mixed-citation publication-type="other">Graham C, Talay D. Stochastic simulation and Monte Carlo methods: mathematical foundations of stochastic simulation, vol. 68. Springer Science &amp; Business Media; 2013.</mixed-citation></ref><ref id="pone.0330604.ref006"><label>6</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Vignoles</surname><given-names>GL</given-names></name>. <article-title>A hybrid random walk method for the simulation of coupled conduction and linearized radiation transfer at local scale in porous media with opaque solid phases</article-title>. <source>Int J Heat Mass Transfer.</source><year>2016</year>;<volume>93</volume>:<fpage>707</fpage>&#8211;<lpage>19</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.ijheatmasstransfer.2015.10.056</pub-id></mixed-citation></ref><ref id="pone.0330604.ref007"><label>7</label><mixed-citation publication-type="other">Caliot C, Blanco S, Coustet C, El Hafi M, Eymet V, Forest V, et al. Combined conductive-radiative heat transfer analysis in complex geometry using the Monte Carlo method. 2019.</mixed-citation></ref><ref id="pone.0330604.ref008"><label>8</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Sans</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Farges</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Schick</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Parent</surname><given-names>G</given-names></name>. <article-title>Solving transient coupled conductive and radiative transfers in porous media with a Monte Carlo Method: Characterization of thermal conductivity of foams using a numerical Flash Method</article-title>. <source>Int J Thermal Sci.</source><year>2022</year>;<volume>179</volume>:<fpage>107656</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.ijthermalsci.2022.107656</pub-id></mixed-citation></ref><ref id="pone.0330604.ref009"><label>9</label><mixed-citation publication-type="other">Penazzi L, Blanco S, Caliot C, Coustet C, El-Hafi M, Fournier RA, et al. Stardis: Propagator evaluation for coupled heat transfer in large geometric models. 2022. Available from: <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://hal.archives-ouvertes.fr/hal-03518455" ext-link-type="uri">https://hal.archives-ouvertes.fr/hal-03518455</ext-link></mixed-citation></ref><ref id="pone.0330604.ref010"><label>10</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Fournier</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Eymet</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Hafi</surname><given-names>ME</given-names></name>, <name name-style="western"><surname>Spiesser</surname><given-names>C</given-names></name>. <article-title>Radiative, conductive and convective heat-transfers in a single Monte Carlo algorithm</article-title>. <source>J Phys Conf Ser.</source><year>2016</year>;<volume>676</volume>:<fpage>012007</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1088/1742-6596/676/1/012007</pub-id></mixed-citation></ref><ref id="pone.0330604.ref011"><label>11</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Tregan</surname><given-names>JM</given-names></name>, <name name-style="western"><surname>Amestoy</surname><given-names>JL</given-names></name>, <name name-style="western"><surname>Bati</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Bezian</surname><given-names>J-J</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Brunel</surname><given-names>L</given-names></name>, <etal>et al</etal>. <article-title>Coupling radiative, conductive and convective heat-transfers in a single Monte Carlo algorithm: A general theoretical framework for linear situations</article-title>. <source>PLoS One.</source><year>2023</year>;<volume>18</volume>(<issue>4</issue>):e0283681. <comment>doi: </comment><pub-id pub-id-type="doi">10.1371/journal.pone.0283681</pub-id><pub-id pub-id-type="pmid">37023098</pub-id><pub-id pub-id-type="pmcid">PMC10079137</pub-id></mixed-citation></ref><ref id="pone.0330604.ref012"><label>12</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Villefranque</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Hourdin</surname><given-names>F</given-names></name>, <name name-style="western"><surname>d&#8217;Alen&#231;on</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Boucher</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Caliot</surname><given-names>C</given-names></name>, <etal>et al</etal>. <article-title>The &#8220;teapot in a city&#8221;: A paradigm shift in urban climate modeling</article-title>. <source>Sci Adv.</source><year>2022</year>;<volume>8</volume>(<issue>27</issue>):eabp8934. <comment>doi: </comment><pub-id pub-id-type="doi">10.1126/sciadv.abp8934</pub-id><pub-id pub-id-type="pmid">35857481</pub-id><pub-id pub-id-type="pmcid">PMC9258812</pub-id></mixed-citation></ref><ref id="pone.0330604.ref013"><label>13</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Caliot</surname><given-names>C</given-names></name>, <name name-style="western"><surname>d&#8217;Alen&#231;on</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Forest</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Fournier</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Hourdin</surname><given-names>F</given-names></name>, <etal>et al</etal>. <article-title>Coupled heat transfers resolution by Monte Carlo in urban geometry including direct and diffuse solar irradiations</article-title>. <source>Int J Heat Mass Trans.</source><year>2024</year>;<volume>222</volume>:<fpage>125139</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.ijheatmasstransfer.2023.125139</pub-id></mixed-citation></ref><ref id="pone.0330604.ref014"><label>14</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Booth</surname><given-names>TE</given-names></name>. <article-title>Exact Monte Carlo solution of elliptic partial differential equations</article-title>. <source>J Comput Phys.</source><year>1981</year>;<volume>39</volume>(<issue>2</issue>):<fpage>396</fpage>&#8211;<lpage>404</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/0021-9991(81)90159-5</pub-id></mixed-citation></ref><ref id="pone.0330604.ref015"><label>15</label><mixed-citation publication-type="other">Sabelfeld KK. Monte Carlo Methods in Boundary Value Problems. Lecture Notes in Mathematics. Springer-Verlag; 1991. Available from: <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://books.google.fr/books?id=czHvAAAAMAAJ" ext-link-type="uri">https://books.google.fr/books?id=czHvAAAAMAAJ</ext-link></mixed-citation></ref><ref id="pone.0330604.ref016"><label>16</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Deaconu</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Lejay</surname><given-names>A</given-names></name>. <article-title>A random walk on rectangles algorithm</article-title>. <source>Methodol Comput Appl Probab.</source><year>2006</year>;<volume>8</volume>(<issue>1</issue>):<fpage>135</fpage>&#8211;<lpage>51</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1007/s11009-006-7292-3</pub-id></mixed-citation></ref><ref id="pone.0330604.ref017"><label>17</label><mixed-citation publication-type="other">Ermakov SM, Nekrutkin VV, Sipin AS. Random processes for classical equations of mathematical physics, vol. 34. Springer Science &amp; Business Media; 2013.</mixed-citation></ref><ref id="pone.0330604.ref018"><label>18</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Dimov</surname><given-names>IT</given-names></name>, <name name-style="western"><surname>Maire</surname><given-names>S</given-names></name>. <article-title>A new unbiased stochastic algorithm for solving linear Fredholm equations of the second kind</article-title>. <source>Adv Comput Math.</source><year>2019</year>;<volume>45</volume>(<issue>3</issue>):<fpage>1499</fpage>&#8211;<lpage>519</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1007/s10444-019-09676-y</pub-id></mixed-citation></ref><ref id="pone.0330604.ref019"><label>19</label><mixed-citation publication-type="other">Sabelfeld KK, Simonov NA. Random walks on boundary for solving PDEs. Walter de Gruyter; 2013.</mixed-citation></ref><ref id="pone.0330604.ref020"><label>20</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Simonov</surname><given-names>NA</given-names></name>. <article-title>Walk-on-spheres algorithm for solving third boundary value problem</article-title>. <source>Appl Math Lett.</source><year>2017</year>;<volume>64</volume>:<fpage>156</fpage>&#8211;<lpage>61</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.aml.2016.09.008</pub-id></mixed-citation></ref><ref id="pone.0330604.ref021"><label>21</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Sawhney</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Seyb</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Jarosz</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Crane</surname><given-names>K</given-names></name>. <article-title>Grid-free Monte Carlo for PDEs with spatially varying coefficients</article-title>. <source>ACM Trans Graph.</source><year>2022</year>;<volume>41</volume>(<issue>4</issue>):<fpage>1</fpage>&#8211;<lpage>17</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1145/3528223.3530134</pub-id></mixed-citation></ref><ref id="pone.0330604.ref022"><label>22</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Sawhney</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Crane</surname><given-names>K</given-names></name>. <article-title>Monte Carlo geometry processing: A grid-free approach to PDE-based methods on volumetric domains</article-title>. <source>ACM Trans Graph.</source><year>2020</year>;<volume>39</volume>(<issue>4</issue>). <comment>doi: </comment><pub-id pub-id-type="doi">10.1145/3386569.3392374</pub-id></mixed-citation></ref><ref id="pone.0330604.ref023"><label>23</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Sawhney</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Miller</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Gkioulekas</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Crane</surname><given-names>K</given-names></name>. <article-title>Walk on stars: a grid-free Monte Carlo method for PDEs with Neumann boundary conditions</article-title>. <source>ACM Trans Graph.</source><year>2023</year>;<volume>42</volume>(<issue>4</issue>):<fpage>1</fpage>&#8211;<lpage>20</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1145/3592398</pub-id></mixed-citation></ref><ref id="pone.0330604.ref024"><label>24</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Miller</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Sawhney</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Crane</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Gkioulekas</surname><given-names>I</given-names></name>. <article-title>Walkin&#8217; Robin: Walk on stars with Robin boundary conditions</article-title>. <source>ACM Trans Graph.</source><year>2024</year>;<volume>43</volume>(<issue>4</issue>):<fpage>1</fpage>&#8211;<lpage>18</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1145/3658153</pub-id></mixed-citation></ref><ref id="pone.0330604.ref025"><label>25</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Maire</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Nguyen</surname><given-names>G</given-names></name>. <article-title>Stochastic finite differences for elliptic diffusion equations in stratified domains</article-title>. <source>Math Comput Simulat.</source><year>2016</year>;<volume>121</volume>:<fpage>146</fpage>&#8211;<lpage>65</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.matcom.2015.09.008</pub-id></mixed-citation></ref><ref id="pone.0330604.ref026"><label>26</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Bossy</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Champagnat</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Leman</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Maire</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Violeau</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Yvinec</surname><given-names>M</given-names></name>. <article-title>Monte Carlo methods for linear and non-linear Poisson-Boltzmann equation</article-title>. <source>ESAIM Proc Sur.</source><year>2015</year>;<volume>48</volume>:<fpage>420</fpage>&#8211;<lpage>46</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1051/proc/201448020</pub-id></mixed-citation></ref><ref id="pone.0330604.ref027"><label>27</label><mixed-citation publication-type="other">Brown G. Modern mathematics for engineers; 1956.</mixed-citation></ref><ref id="pone.0330604.ref028"><label>28</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Muller</surname><given-names>ME</given-names></name>, <etal>et al</etal>. <article-title>Some continuous Monte Carlo methods for the Dirichlet problem</article-title>. <source>Ann Math Stat.</source><year>1956</year>;<volume>27</volume>(<issue>3</issue>):<fpage>569</fpage>&#8211;<lpage>89</lpage>.</mixed-citation></ref><ref id="pone.0330604.ref029"><label>29</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Sabelfeld</surname><given-names>KK</given-names></name>. <article-title>Random walk on spheres method for solving drift-diffusion problems</article-title>. <source>Monte Carlo Method Appl.</source><year>2016</year>;<volume>22</volume>(<issue>4</issue>):<fpage>265</fpage>&#8211;<lpage>75</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1515/mcma-2016-0118</pub-id></mixed-citation></ref><ref id="pone.0330604.ref030"><label>30</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Wald</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Woop</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Benthin</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Johnson</surname><given-names>GS</given-names></name>, <name name-style="western"><surname>Ernst</surname><given-names>M</given-names></name>. <article-title>Embree: a kernel framework for efficient CPU ray tracing</article-title>. <source>ACM Trans Graph.</source><year>2014</year>;<volume>33</volume>(<issue>4</issue>):<fpage>1</fpage>&#8211;<lpage>8</lpage>.</mixed-citation></ref><ref id="pone.0330604.ref031"><label>31</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Shellshear</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Ytterlid</surname><given-names>R</given-names></name>. <article-title>Fast distance queries for triangles, lines, and points using SSE instructions</article-title>. <source>J Comput Graph Tech.</source><year>2014</year>;<volume>3</volume>(<issue>4</issue>).</mixed-citation></ref><ref id="pone.0330604.ref032"><label>32</label><mixed-citation publication-type="other">Pharr M, Jakob W, Humphreys G. Physically based rendering: From theory to implementation. Morgan Kaufmann; 2016.</mixed-citation></ref><ref id="pone.0330604.ref033"><label>33</label><mixed-citation publication-type="other">Kajiya JT. The rendering equation. In: Proceedings of the 13th annual conference on Computer graphics and interactive techniques. 1986. p. 143&#8211;50.</mixed-citation></ref><ref id="pone.0330604.ref034"><label>34</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Peniguel</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Rupp</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Fournier</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Eymet</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Forest</surname><given-names>V</given-names></name>, <etal>et al</etal>. <article-title>Complementary finite element and Monte-Carlo methods to solve industrial thermal problems</article-title>. <source>EPJ Web Conf.</source><year>2024</year>;<volume>302</volume>:<fpage>06003</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1051/epjconf/202430206003</pub-id></mixed-citation></ref><ref id="pone.0330604.ref035"><label>35</label><mixed-citation publication-type="other">Penazzi L, Badri MA, Blanco S, Caliot C, Dao&#219;t C, Dauchet J, et al. Comparative analysis of methods for solving conduction-radiation coupling in heterogeneous materials. In: 11th International Symposium on Radiative Transfer (RAD-25). International Centre for Heat and Mass Transfer. 2025.</mixed-citation></ref><ref id="pone.0330604.ref036"><label>36</label><mixed-citation publication-type="other">Patankar SV. Numerical heat transfer and fluid flow. McGraw Hill; 1980.</mixed-citation></ref><ref id="pone.0330604.ref037"><label>37</label><mixed-citation publication-type="other">Lejay A, Maire S, Pichot G. Monte Carlo simulations in media with interfaces. 2013.</mixed-citation></ref><ref id="pone.0330604.ref038"><label>38</label><mixed-citation publication-type="other">Star-Engine. Available from: <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.meso-star.com/projects/star-engine/star-engine.html" ext-link-type="uri">https://www.meso-star.com/projects/star-engine/star-engine.html</ext-link></mixed-citation></ref><ref id="pone.0330604.ref039"><label>39</label><mixed-citation publication-type="other">Embree. Available from: <ext-link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://www.embree.org" ext-link-type="uri">https://www.embree.org</ext-link></mixed-citation></ref><ref id="pone.0330604.ref040"><label>40</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Dauchet</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Bezian</surname><given-names>J-J</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Caliot</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Charon</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Coustet</surname><given-names>C</given-names></name>, <etal>et al</etal>. <article-title>Addressing nonlinearities in Monte Carlo</article-title>. <source>Sci Rep.</source><year>2018</year>;<volume>8</volume>(<issue>1</issue>):<fpage>13302</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1038/s41598-018-31574-4</pub-id><pub-id pub-id-type="pmid">30185986</pub-id><pub-id pub-id-type="pmcid">PMC6125312</pub-id></mixed-citation></ref><ref id="pone.0330604.ref041"><label>41</label><mixed-citation publication-type="journal"><name name-style="western"><surname>McKean</surname><given-names>HP Jr</given-names></name>. <article-title>An exponential formula for solving Boltzmann&#8217;s equation for a Maxwellian gas</article-title>. <source>J Comb Theory.</source><year>1967</year>;<volume>2</volume>(<issue>3</issue>):<fpage>358</fpage>&#8211;<lpage>82</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/s0021-9800(67)80035-8</pub-id></mixed-citation></ref><ref id="pone.0330604.ref042"><label>42</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Terr&#233;e</surname><given-names>G</given-names></name>, <name name-style="western"><surname>El Hafi</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Fournier</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Dauchet</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Gautrais</surname><given-names>J</given-names></name>. <article-title>Addressing the gas kinetics Boltzmann equation with branching-path statistics</article-title>. <source>Phys Rev E.</source><year>2022</year>;<volume>105</volume>(2&#8211;2):<fpage>025305</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1103/PhysRevE.105.025305</pub-id><pub-id pub-id-type="pmid">35291173</pub-id></mixed-citation></ref><ref id="pone.0330604.ref043"><label>43</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Kumar</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Topin</surname><given-names>F</given-names></name>. <article-title>Simultaneous determination of intrinsic solid phase conductivity and effective thermal conductivity of Kelvin like foams</article-title>. <source>Appl Therm Eng.</source><year>2014</year>;<volume>71</volume>(<issue>1</issue>):<fpage>536</fpage>&#8211;<lpage>47</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1016/j.applthermaleng.2014.06.058</pub-id></mixed-citation></ref><ref id="pone.0330604.ref044"><label>44</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Fournier</surname><given-names>R</given-names></name>. <article-title>An invariance property of diffusive random walks</article-title>. <source>Europhys Lett.</source><year>2003</year>;<volume>61</volume>(<issue>2</issue>):<fpage>168</fpage>&#8211;<lpage>73</lpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1209/epl/i2003-00208-x</pub-id></mixed-citation></ref><ref id="pone.0330604.ref045"><label>45</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Fournier</surname><given-names>R</given-names></name>. <article-title>Short-path statistics and the diffusion approximation</article-title>. <source>Phys Rev Lett.</source><year>2006</year>;<volume>97</volume>(<issue>23</issue>):<fpage>230604</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1103/PhysRevLett.97.230604</pub-id><pub-id pub-id-type="pmid">17280189</pub-id></mixed-citation></ref><ref id="pone.0330604.ref046"><label>46</label><mixed-citation publication-type="journal"><name name-style="western"><surname>Terr&#233;e</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Blanco</surname><given-names>S</given-names></name>, <name name-style="western"><surname>El Hafi</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Fournier</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Rolland</surname><given-names>JY</given-names></name>. <article-title>Diffusion approximation and short-path statistics at low to intermediate Knudsen numbers</article-title>. <source>Europhys Lett.</source><year>2015</year>;<volume>110</volume>(<issue>2</issue>):<fpage>20007</fpage>. <comment>doi: </comment><pub-id pub-id-type="doi">10.1209/0295-5075/110/20007</pub-id></mixed-citation></ref></ref-list></back></article></pmc-articleset>