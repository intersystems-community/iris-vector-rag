version: '3.8' # Specify a compose file version

# ENTERPRISE EDITION CONFIGURATION
# This docker-compose file uses licensed IRIS Enterprise Edition.
# For public/community use, please use docker-compose.yml instead,
# which includes IRIS Community Edition.

services:
  iris_licensed_db: # New service name
    image: containers.intersystems.com/intersystems/iris-arm64:2025.1 # Corrected image based on running container
    container_name: iris_db_rag_licensed # Match existing container name
    ports:
      - "1972:1972"
      - "52773:52773"
    environment:
      - IRISNAMESPACE=USER
      - ISC_DEFAULT_PASSWORD=SYS
      # Add any other necessary environment variables for the licensed version
    volumes:
      - iris_licensed_db_data:/usr/irissys/mgr # New named volume for this service
      - ./iris.key:/usr/irissys/mgr/iris.key # Map the license key
    stdin_open: true
    tty: true
    healthcheck:
      test: ["CMD", "/usr/irissys/bin/iris", "session", "iris", "-U%SYS", "##class(%SYSTEM.Process).CurrentDirectory()"]
      interval: 15s
      timeout: 10s
      retries: 5
      start_period: 60s
    command: --check-caps false -a "iris session iris -U%SYS '##class(Security.Users).UnExpireUserPasswords(\"*\")'"

volumes:
  iris_licensed_db_data: {} # Defines the new named volume