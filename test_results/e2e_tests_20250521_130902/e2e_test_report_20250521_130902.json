{"created": 1747847363.3062131, "duration": 20.430835247039795, "exitcode": 1, "root": "/Users/tdyar/ws/rag-templates", "environment": {}, "summary": {"passed": 2, "failed": 5, "total": 7, "collected": 7}, "collectors": [{"nodeid": "", "outcome": "passed", "result": [{"nodeid": "tests/test_e2e_rag_persistent.py", "type": "Module"}]}, {"nodeid": "tests/test_e2e_rag_persistent.py", "outcome": "passed", "result": [{"nodeid": "tests/test_e2e_rag_persistent.py::test_basic_rag_with_real_data", "type": "Function", "lineno": 234}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_hyde_with_real_data", "type": "Function", "lineno": 261}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_crag_with_real_data", "type": "Function", "lineno": 288}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_colbert_with_real_data", "type": "Function", "lineno": 316}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_noderag_with_real_data", "type": "Function", "lineno": 345}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_graphrag_with_real_data", "type": "Function", "lineno": 374}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_all_pipelines_with_same_query", "type": "Function", "lineno": 401}]}], "tests": [{"nodeid": "tests/test_e2e_rag_persistent.py::test_basic_rag_with_real_data", "lineno": 234, "outcome": "passed", "keywords": ["test_basic_rag_with_real_data", "test_e2e_rag_persistent.py", "tests", "rag-templates", ""], "setup": {"duration": 19.764361792011186, "outcome": "passed", "stdout": "Using pure HuggingFace embedder for model: intfloat/e5-base-v2\nInitializing HF embedder for model: intfloat/e5-base-v2\nInitializing LLM: openai - gpt-3.5-turbo\nInitializing LLM: stub - gpt-3.5-turbo\n", "stderr": "INFO:common.iris_connector:IRIS_CONNECTION_URL not set, using individual parameters/defaults.\nINFO:common.iris_connector:Connecting to IRIS at localhost:1972/USER\nINFO:common.iris_connector:Successfully connected to IRIS (DBAPI connection test successful).\nINFO:tests.test_e2e_rag_persistent:Using real IRIS connection with 1100 documents\nINFO:tests.test_e2e_rag_persistent:Using real embedding function\nWARNING:tests.test_e2e_rag_persistent:Real LLM not available, falling back to stub LLM\n", "log": [{"name": "common.iris_connector", "msg": "IRIS_CONNECTION_URL not set, using individual parameters/defaults.", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/common/iris_connector.py", "filename": "iris_connector.py", "module": "iris_connector", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 46, "funcName": "get_real_iris_connection", "created": 1747847342.895044, "msecs": 895.0, "relativeCreated": 218.66416931152344, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:02"}, {"name": "common.iris_connector", "msg": "Connecting to IRIS at localhost:1972/USER", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/common/iris_connector.py", "filename": "iris_connector.py", "module": "iris_connector", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 64, "funcName": "get_real_iris_connection", "created": 1747847342.895221, "msecs": 895.0, "relativeCreated": 218.8410758972168, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:02"}, {"name": "common.iris_connector", "msg": "Successfully connected to IRIS (DBAPI connection test successful).", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/common/iris_connector.py", "filename": "iris_connector.py", "module": "iris_connector", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 74, "funcName": "get_real_iris_connection", "created": 1747847342.91225, "msecs": 912.0, "relativeCreated": 235.8701229095459, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:02"}, {"name": "tests.test_e2e_rag_persistent", "msg": "Using real IRIS connection with 1100 documents", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 97, "funcName": "real_iris_connection", "created": 1747847342.9133928, "msecs": 913.0, "relativeCreated": 237.0128631591797, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:02"}, {"name": "tests.test_e2e_rag_persistent", "msg": "Using real embedding function", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 107, "funcName": "real_embedding_func", "created": 1747847362.658416, "msecs": 658.0, "relativeCreated": 19982.036113739014, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:22"}, {"name": "tests.test_e2e_rag_persistent", "msg": "Real LLM not available, falling back to stub LLM", "args": null, "levelname": "WARNING", "levelno": 30, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 123, "funcName": "real_llm_func", "created": 1747847362.658864, "msecs": 658.0, "relativeCreated": 19982.484102249146, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:22"}]}, "call": {"duration": 0.5579187500406988, "outcome": "passed", "stdout": "BasicRAGPipeline Initialized\nBasicRAG: Running pipeline for query: 'What are the symptoms of diabetes?...'\nBasicRAG: Retrieving documents for query: 'What are the symptoms of diabetes?...'\nFunction retrieve_documents executed in 0.5575 seconds\nBasicRAG: Generating answer for query: 'What are the symptoms of diabetes?...'\nBasicRAG: Generated answer: 'Stub LLM response for prompt: 'You are a helpful AI assistant. Answer the questio...'...'\nFunction generate_answer executed in 0.0000 seconds\nFunction run executed in 0.5575 seconds\n", "stderr": "INFO:tests.test_e2e_rag_persistent:Running test_basic_rag_with_real_data\nWARNING:basic_rag.pipeline:BasicRAG: retrieve_documents - Bypassing database vector search due to persistent driver/SQL issues with TO_VECTOR. Returning mock documents.\nINFO:basic_rag.pipeline:BasicRAG: Returned 3 mock documents.\nINFO:tests.test_e2e_rag_persistent:RAG result verification passed for query: What are the symptoms of diabetes?...\nINFO:tests.test_e2e_rag_persistent:test_basic_rag_with_real_data passed\n", "log": [{"name": "tests.test_e2e_rag_persistent", "msg": "Running test_basic_rag_with_real_data", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 239, "funcName": "test_basic_rag_with_real_data", "created": 1747847362.659221, "msecs": 659.0, "relativeCreated": 19982.84101486206, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:22"}, {"name": "basic_rag.pipeline", "msg": "BasicRAG: retrieve_documents - Bypassing database vector search due to persistent driver/SQL issues with TO_VECTOR. Returning mock documents.", "args": null, "levelname": "WARNING", "levelno": 30, "pathname": "/Users/tdyar/ws/rag-templates/basic_rag/pipeline.py", "filename": "pipeline.py", "module": "pipeline", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 54, "funcName": "retrieve_documents", "created": 1747847363.216562, "msecs": 216.0, "relativeCreated": 20540.18211364746, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "basic_rag.pipeline", "msg": "BasicRAG: Returned 3 mock documents.", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/basic_rag/pipeline.py", "filename": "pipeline.py", "module": "pipeline", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 67, "funcName": "retrieve_documents", "created": 1747847363.21673, "msecs": 216.0, "relativeCreated": 20540.350198745728, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "tests.test_e2e_rag_persistent", "msg": "RAG result verification passed for query: What are the symptoms of diabetes?...", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 231, "funcName": "verify_rag_result", "created": 1747847363.21688, "msecs": 216.0, "relativeCreated": 20540.500164031982, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "tests.test_e2e_rag_persistent", "msg": "test_basic_rag_with_real_data passed", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 260, "funcName": "test_basic_rag_with_real_data", "created": 1747847363.216934, "msecs": 216.0, "relativeCreated": 20540.55404663086, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}]}, "teardown": {"duration": 7.912499131634831e-05, "outcome": "passed"}}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_hyde_with_real_data", "lineno": 261, "outcome": "passed", "keywords": ["test_hyde_with_real_data", "test_e2e_rag_persistent.py", "tests", "rag-templates", ""], "setup": {"duration": 8.062500273808837e-05, "outcome": "passed"}, "call": {"duration": 0.0004634169745258987, "outcome": "passed", "stdout": "HyDEPipeline Initialized\nHyDE: Running pipeline for query: 'How does COVID-19 affect the respiratory system?...'\nHyDE: Generated hypothetical document: 'Stub LLM response for prompt: 'Write a short, concise passage that directly answe...'...'\nFunction _generate_hypothetical_document executed in 0.0000 seconds\nFunction retrieve_documents executed in 0.0001 seconds\nHyDE: Generating final answer for query: 'How does COVID-19 affect the respiratory system?...'\nHyDE: Generated final answer: 'Stub LLM response for prompt: 'You are a helpful AI assistant. Answer the questio...'...'\nFunction generate_answer executed in 0.0000 seconds\nFunction run executed in 0.0002 seconds\n", "stderr": "INFO:tests.test_e2e_rag_persistent:Running test_hyde_with_real_data\nWARNING:hyde.pipeline:HyDE: retrieve_documents - Bypassing database vector search due to persistent driver/SQL issues with TO_VECTOR. Returning mock documents.\nINFO:hyde.pipeline:HyDE: Generated hypothetical document (though not used for DB retrieval in mock): 'Stub LLM response for prompt: 'Write a short, concise passage that directly answe...'...'\nINFO:hyde.pipeline:HyDE: Returned 3 mock documents.\nINFO:tests.test_e2e_rag_persistent:RAG result verification passed for query: How does COVID-19 affect the respiratory system?...\nINFO:tests.test_e2e_rag_persistent:test_hyde_with_real_data passed\n", "log": [{"name": "tests.test_e2e_rag_persistent", "msg": "Running test_hyde_with_real_data", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 266, "funcName": "test_hyde_with_real_data", "created": 1747847363.217866, "msecs": 217.0, "relativeCreated": 20541.486024856567, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "hyde.pipeline", "msg": "HyDE: retrieve_documents - Bypassing database vector search due to persistent driver/SQL issues with TO_VECTOR. Returning mock documents.", "args": null, "levelname": "WARNING", "levelno": 30, "pathname": "/Users/tdyar/ws/rag-templates/hyde/pipeline.py", "filename": "pipeline.py", "module": "pipeline", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 56, "funcName": "retrieve_documents", "created": 1747847363.2179651, "msecs": 217.0, "relativeCreated": 20541.585206985474, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "hyde.pipeline", "msg": "HyDE: Generated hypothetical document (though not used for DB retrieval in mock): 'Stub LLM response for prompt: 'Write a short, concise passage that directly answe...'...'", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/hyde/pipeline.py", "filename": "pipeline.py", "module": "pipeline", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 60, "funcName": "retrieve_documents", "created": 1747847363.2180328, "msecs": 218.0, "relativeCreated": 20541.65291786194, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "hyde.pipeline", "msg": "HyDE: Returned 3 mock documents.", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/hyde/pipeline.py", "filename": "pipeline.py", "module": "pipeline", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 72, "funcName": "retrieve_documents", "created": 1747847363.218074, "msecs": 218.0, "relativeCreated": 20541.694164276123, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "tests.test_e2e_rag_persistent", "msg": "RAG result verification passed for query: How does COVID-19 affect the respiratory system?...", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 231, "funcName": "verify_rag_result", "created": 1747847363.218174, "msecs": 218.0, "relativeCreated": 20541.794061660767, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "tests.test_e2e_rag_persistent", "msg": "test_hyde_with_real_data passed", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 287, "funcName": "test_hyde_with_real_data", "created": 1747847363.21821, "msecs": 218.0, "relativeCreated": 20541.83006286621, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}]}, "teardown": {"duration": 5.462497938424349e-05, "outcome": "passed"}}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_crag_with_real_data", "lineno": 288, "outcome": "failed", "keywords": ["test_crag_with_real_data", "test_e2e_rag_persistent.py", "tests", "rag-templates", ""], "setup": {"duration": 0.00016950001008808613, "outcome": "passed", "stderr": "INFO:tests.test_e2e_rag_persistent:Using mock web search function\n", "log": [{"name": "tests.test_e2e_rag_persistent", "msg": "Using mock web search function", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 182, "funcName": "web_search_func", "created": 1747847363.218574, "msecs": 218.0, "relativeCreated": 20542.1941280365, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}]}, "call": {"duration": 0.06378399999812245, "outcome": "failed", "crash": {"path": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "lineno": 200, "message": "AssertionError: Result should contain retrieved documents\nassert 'retrieved_documents' in {'answer': \"Stub LLM response for prompt: 'You are a helpful AI assistant. Answer the questio...'\", 'latency_ms': 63.4687909623608, 'query': \"What treatments are available for Alzheimer's disease?\", 'retrieved_context_chunks': ['Web search result 1 for query about what and treatments. This result contains information related to what.', 'Web search result 2 for query about what and treatments. This result contains information related to what.', 'Web search result 3 for query about what and treatments. This result contains information related to what.']}"}, "traceback": [{"path": "tests/test_e2e_rag_persistent.py", "lineno": 313, "message": ""}, {"path": "tests/test_e2e_rag_persistent.py", "lineno": 200, "message": "AssertionError"}], "stdout": "RetrievalEvaluator Initialized (placeholder)\nCRAGPipeline Initialized\nCRAG: Running pipeline for query: 'What treatments are available for Alzheimer's dise...'\nCRAG: Running retrieve and correct step for query: 'What treatments are available for Alzheimer's dise...'\nCRAG: Performing initial retrieval for query: 'What treatments are available for Alzheimer's dise...'\nCRAG: Error during initial retrieval: [SQLCODE: <-1>:<Invalid SQL statement>]\r\n[Location: <Prepare>]\r\n[%msg: < ) expected, : found ^SELECT TOP :%qpar(1) doc_id , text_content , VECTOR_COSINE ( embedding , TO_VECTOR ( :%qpar(2) , :%qpar>]\nFunction _initial_retrieve executed in 0.0632 seconds\nRetrievalEvaluator: Evaluating documents for query: 'What treatments are available for Alzheimer's dise...'\nRetrievalEvaluator: No documents provided. Status: disoriented.\nCRAG: Retrieval status is 'disoriented'. Attempting web augmentation.\nCRAG: Attempting web augmentation for query: 'What treatments are available for Alzheimer's dise...'\nCRAG: Web search returned 3 results.\nCRAG: Combined initial documents with web results. Total: 3.\nFunction _augment_with_web_search executed in 0.0001 seconds\nCRAG: Decomposing, filtering, and recomposing context for query: 'What treatments are available for Alzheimer's dise...'\nFunction _decompose_recompose_filter executed in 0.0000 seconds\nCRAG: Retrieve and correct step finished. Refined context has 3 chunks.\nFunction retrieve_and_correct executed in 0.0634 seconds\nCRAG: Generating final answer for query: 'What treatments are available for Alzheimer's dise...'\nCRAG: Generated final answer: 'Stub LLM response for prompt: 'You are a helpful AI assistant. Answer the questio...'...'\nFunction generate_answer executed in 0.0000 seconds\nFunction run executed in 0.0635 seconds\n", "stderr": "INFO:tests.test_e2e_rag_persistent:Running test_crag_with_real_data\nINFO:tests.test_e2e_rag_persistent:Mock web search returned 3 results for query: What treatments are available for Alzheimer's dise...\n", "log": [{"name": "tests.test_e2e_rag_persistent", "msg": "Running test_crag_with_real_data", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 293, "funcName": "test_crag_with_real_data", "created": 1747847363.2187462, "msecs": 218.0, "relativeCreated": 20542.36626625061, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "tests.test_e2e_rag_persistent", "msg": "Mock web search returned 3 results for query: What treatments are available for Alzheimer's dise...", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 179, "funcName": "mock_web_search", "created": 1747847363.282086, "msecs": 282.0, "relativeCreated": 20605.705976486206, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}], "longrepr": "real_iris_connection = <intersystems_iris.IRISConnection object at 0x105a29580>\nreal_embedding_func = <function build_hf_embedder.<locals>.embedding_func_hf at 0x10e9a9e40>\nreal_llm_func = <function get_llm_func.<locals>.query_llm at 0x12e03a200>\nweb_search_func = <function web_search_func.<locals>.mock_web_search at 0x12e038400>\nsample_medical_queries = [{'expected_keywords': ['diabetes', 'symptom', 'glucose', 'insulin'], 'min_doc_count': 2, 'query': 'What are the sympt...tment', 'cognitive', 'memory'], 'min_doc_count': 2, 'query': \"What treatments are available for Alzheimer's disease?\"}]\n\n    def test_crag_with_real_data(real_iris_connection, real_embedding_func, real_llm_func, web_search_func, sample_medical_queries):\n        \"\"\"\n        Verifies that CRAG works with real PMC documents.\n        \"\"\"\n        logger.info(\"Running test_crag_with_real_data\")\n    \n        # Initialize the CRAGPipeline\n        pipeline = CRAGPipeline(\n            iris_connector=real_iris_connection,\n            embedding_func=real_embedding_func,\n            llm_func=real_llm_func,\n            web_search_func=web_search_func\n        )\n    \n        # Test with a sample query\n        query_data = sample_medical_queries[2]\n        query = query_data[\"query\"]\n        expected_keywords = query_data[\"expected_keywords\"]\n        min_doc_count = query_data[\"min_doc_count\"]\n    \n        # Run the pipeline\n        result = pipeline.run(query, top_k=5)\n    \n        # Verify the result\n>       verify_rag_result(result, query, expected_keywords, min_doc_count)\n\ntests/test_e2e_rag_persistent.py:313: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nresult = {'answer': \"Stub LLM response for prompt: 'You are a helpful AI assistant. Answer the questio...'\", 'latency_ms': 63.4... what.', 'Web search result 3 for query about what and treatments. This result contains information related to what.']}\nquery = \"What treatments are available for Alzheimer's disease?\"\nexpected_keywords = ['alzheimer', 'treatment', 'cognitive', 'memory']\nmin_doc_count = 2\n\n    def verify_rag_result(result: Dict[str, Any], query: str, expected_keywords: List[str], min_doc_count: int):\n        \"\"\"\n        Verifies that a RAG result meets the expected criteria.\n    \n        Args:\n            result: The result from a RAG pipeline\n            query: The original query\n            expected_keywords: Keywords that should appear in retrieved documents\n            min_doc_count: Minimum number of documents that should be retrieved\n        \"\"\"\n        # Check that the result contains the expected keys\n        assert \"query\" in result, \"Result should contain the original query\"\n        assert \"answer\" in result, \"Result should contain an answer\"\n>       assert \"retrieved_documents\" in result, \"Result should contain retrieved documents\"\nE       AssertionError: Result should contain retrieved documents\nE       assert 'retrieved_documents' in {'answer': \"Stub LLM response for prompt: 'You are a helpful AI assistant. Answer the questio...'\", 'latency_ms': 63.4687909623608, 'query': \"What treatments are available for Alzheimer's disease?\", 'retrieved_context_chunks': ['Web search result 1 for query about what and treatments. This result contains information related to what.', 'Web search result 2 for query about what and treatments. This result contains information related to what.', 'Web search result 3 for query about what and treatments. This result contains information related to what.']}\n\ntests/test_e2e_rag_persistent.py:200: AssertionError"}, "teardown": {"duration": 0.00010541698429733515, "outcome": "passed"}}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_colbert_with_real_data", "lineno": 316, "outcome": "failed", "keywords": ["test_colbert_with_real_data", "test_e2e_rag_persistent.py", "tests", "rag-templates", ""], "setup": {"duration": 0.00027141597820445895, "outcome": "passed", "stdout": "Using pure HuggingFace embedder for model: intfloat/e5-base-v2\nUsing cached HF embedder for model: intfloat/e5-base-v2\n", "stderr": "INFO:tests.test_e2e_rag_persistent:Using simple ColBERT query encoder\n", "log": [{"name": "tests.test_e2e_rag_persistent", "msg": "Using simple ColBERT query encoder", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 158, "funcName": "colbert_query_encoder", "created": 1747847363.287179, "msecs": 287.0, "relativeCreated": 20610.799074172974, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}]}, "call": {"duration": 0.00014091702178120613, "outcome": "failed", "crash": {"path": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "lineno": 324, "message": "TypeError: ColbertRAGPipeline.__init__() got an unexpected keyword argument 'embedding_func'"}, "traceback": [{"path": "tests/test_e2e_rag_persistent.py", "lineno": 324, "message": "TypeError"}], "stderr": "INFO:tests.test_e2e_rag_persistent:Running test_colbert_with_real_data\n", "log": [{"name": "tests.test_e2e_rag_persistent", "msg": "Running test_colbert_with_real_data", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 321, "funcName": "test_colbert_with_real_data", "created": 1747847363.287391, "msecs": 287.0, "relativeCreated": 20611.011028289795, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}], "longrepr": "real_iris_connection = <intersystems_iris.IRISConnection object at 0x105a29580>\nreal_embedding_func = <function build_hf_embedder.<locals>.embedding_func_hf at 0x10e9a9e40>\nreal_llm_func = <function get_llm_func.<locals>.query_llm at 0x12e03a200>\ncolbert_query_encoder = <function colbert_query_encoder.<locals>.simple_colbert_query_encoder at 0x12e03a3e0>\nsample_medical_queries = [{'expected_keywords': ['diabetes', 'symptom', 'glucose', 'insulin'], 'min_doc_count': 2, 'query': 'What are the sympt...tment', 'cognitive', 'memory'], 'min_doc_count': 2, 'query': \"What treatments are available for Alzheimer's disease?\"}]\n\n    def test_colbert_with_real_data(real_iris_connection, real_embedding_func, real_llm_func, colbert_query_encoder, sample_medical_queries):\n        \"\"\"\n        Verifies that ColBERT works with real PMC documents.\n        \"\"\"\n        logger.info(\"Running test_colbert_with_real_data\")\n    \n        # Initialize the ColbertRAGPipeline\n>       pipeline = ColbertRAGPipeline(\n            iris_connector=real_iris_connection,\n            embedding_func=real_embedding_func,\n            llm_func=real_llm_func,\n            colbert_query_encoder_func=colbert_query_encoder,\n            colbert_doc_encoder_func=real_embedding_func  # Use regular embedding func as a placeholder\n        )\nE       TypeError: ColbertRAGPipeline.__init__() got an unexpected keyword argument 'embedding_func'\n\ntests/test_e2e_rag_persistent.py:324: TypeError"}, "teardown": {"duration": 6.18330086581409e-05, "outcome": "passed"}}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_noderag_with_real_data", "lineno": 345, "outcome": "failed", "keywords": ["test_noderag_with_real_data", "test_e2e_rag_persistent.py", "tests", "rag-templates", ""], "setup": {"duration": 0.0002894580247811973, "outcome": "passed"}, "call": {"duration": 0.0003575420123524964, "outcome": "failed", "crash": {"path": "/Users/tdyar/ws/rag-templates/common/utils.py", "lineno": 221, "message": "TypeError: NodeRAGPipeline.run() got an unexpected keyword argument 'top_k'"}, "traceback": [{"path": "tests/test_e2e_rag_persistent.py", "lineno": 368, "message": ""}, {"path": "common/utils.py", "lineno": 221, "message": "TypeError"}], "stderr": "INFO:tests.test_e2e_rag_persistent:Running test_noderag_with_real_data\nINFO:noderag.pipeline:NodeRAGPipeline Initialized\n", "log": [{"name": "tests.test_e2e_rag_persistent", "msg": "Running test_noderag_with_real_data", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 350, "funcName": "test_noderag_with_real_data", "created": 1747847363.290658, "msecs": 290.0, "relativeCreated": 20614.278078079224, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "noderag.pipeline", "msg": "NodeRAGPipeline Initialized", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/noderag/pipeline.py", "filename": "pipeline.py", "module": "pipeline", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 35, "funcName": "__init__", "created": 1747847363.290775, "msecs": 290.0, "relativeCreated": 20614.395141601562, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}], "longrepr": "real_iris_connection = <intersystems_iris.IRISConnection object at 0x105a29580>\nreal_embedding_func = <function build_hf_embedder.<locals>.embedding_func_hf at 0x10e9a9e40>\nreal_llm_func = <function get_llm_func.<locals>.query_llm at 0x12e03a200>\nsample_medical_queries = [{'expected_keywords': ['diabetes', 'symptom', 'glucose', 'insulin'], 'min_doc_count': 2, 'query': 'What are the sympt...tment', 'cognitive', 'memory'], 'min_doc_count': 2, 'query': \"What treatments are available for Alzheimer's disease?\"}]\n\n    def test_noderag_with_real_data(real_iris_connection, real_embedding_func, real_llm_func, sample_medical_queries):\n        \"\"\"\n        Verifies that NodeRAG works with real PMC documents.\n        \"\"\"\n        logger.info(\"Running test_noderag_with_real_data\")\n    \n        # Initialize the NodeRAGPipeline\n        # NodeRAG might need a graph_lib, but we'll use None for now\n        pipeline = NodeRAGPipeline(\n            iris_connector=real_iris_connection,\n            embedding_func=real_embedding_func,\n            llm_func=real_llm_func,\n            graph_lib=None  # Use None as a placeholder\n        )\n    \n        # Test with a sample query\n        query_data = sample_medical_queries[1]\n        query = query_data[\"query\"]\n        expected_keywords = query_data[\"expected_keywords\"]\n        min_doc_count = query_data[\"min_doc_count\"]\n    \n        # Run the pipeline\n>       result = pipeline.run(query, top_k=5)\n\ntests/test_e2e_rag_persistent.py:368: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nargs = (<noderag.pipeline.NodeRAGPipeline object at 0x12ea00fe0>, 'How does COVID-19 affect the respiratory system?')\nkwargs = {'top_k': 5}, start_time = 424842.525071\n\n    def wrapper(*args, **kwargs):\n        start_time = time.perf_counter()\n>       result = func(*args, **kwargs)\nE       TypeError: NodeRAGPipeline.run() got an unexpected keyword argument 'top_k'\n\ncommon/utils.py:221: TypeError"}, "teardown": {"duration": 8.333299774676561e-05, "outcome": "passed"}}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_graphrag_with_real_data", "lineno": 374, "outcome": "failed", "keywords": ["test_graphrag_with_real_data", "test_e2e_rag_persistent.py", "tests", "rag-templates", ""], "setup": {"duration": 6.995798321440816e-05, "outcome": "passed"}, "call": {"duration": 0.00023691699607297778, "outcome": "failed", "crash": {"path": "/Users/tdyar/ws/rag-templates/common/utils.py", "lineno": 221, "message": "TypeError: GraphRAGPipeline.run() got an unexpected keyword argument 'top_k'"}, "traceback": [{"path": "tests/test_e2e_rag_persistent.py", "lineno": 395, "message": ""}, {"path": "common/utils.py", "lineno": 221, "message": "TypeError"}], "stderr": "INFO:tests.test_e2e_rag_persistent:Running test_graphrag_with_real_data\nINFO:graphrag.pipeline:GraphRAGPipeline Initialized\n", "log": [{"name": "tests.test_e2e_rag_persistent", "msg": "Running test_graphrag_with_real_data", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 379, "funcName": "test_graphrag_with_real_data", "created": 1747847363.296041, "msecs": 296.0, "relativeCreated": 20619.66109275818, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}, {"name": "graphrag.pipeline", "msg": "GraphRAGPipeline Initialized", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/graphrag/pipeline.py", "filename": "pipeline.py", "module": "pipeline", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 33, "funcName": "__init__", "created": 1747847363.296134, "msecs": 296.0, "relativeCreated": 20619.75407600403, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}], "longrepr": "real_iris_connection = <intersystems_iris.IRISConnection object at 0x105a29580>\nreal_embedding_func = <function build_hf_embedder.<locals>.embedding_func_hf at 0x10e9a9e40>\nreal_llm_func = <function get_llm_func.<locals>.query_llm at 0x12e03a200>\nsample_medical_queries = [{'expected_keywords': ['diabetes', 'symptom', 'glucose', 'insulin'], 'min_doc_count': 2, 'query': 'What are the sympt...tment', 'cognitive', 'memory'], 'min_doc_count': 2, 'query': \"What treatments are available for Alzheimer's disease?\"}]\n\n    def test_graphrag_with_real_data(real_iris_connection, real_embedding_func, real_llm_func, sample_medical_queries):\n        \"\"\"\n        Verifies that GraphRAG works with real PMC documents.\n        \"\"\"\n        logger.info(\"Running test_graphrag_with_real_data\")\n    \n        # Initialize the GraphRAGPipeline\n        pipeline = GraphRAGPipeline(\n            iris_connector=real_iris_connection,\n            embedding_func=real_embedding_func,\n            llm_func=real_llm_func\n        )\n    \n        # Test with a sample query\n        query_data = sample_medical_queries[2]\n        query = query_data[\"query\"]\n        expected_keywords = query_data[\"expected_keywords\"]\n        min_doc_count = query_data[\"min_doc_count\"]\n    \n        # Run the pipeline\n>       result = pipeline.run(query, top_k=5)\n\ntests/test_e2e_rag_persistent.py:395: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nargs = (<graphrag.pipeline.GraphRAGPipeline object at 0x12ea02c90>, \"What treatments are available for Alzheimer's disease?\")\nkwargs = {'top_k': 5}, start_time = 424842.530359333\n\n    def wrapper(*args, **kwargs):\n        start_time = time.perf_counter()\n>       result = func(*args, **kwargs)\nE       TypeError: GraphRAGPipeline.run() got an unexpected keyword argument 'top_k'\n\ncommon/utils.py:221: TypeError"}, "teardown": {"duration": 0.00012066599447280169, "outcome": "passed"}}, {"nodeid": "tests/test_e2e_rag_persistent.py::test_all_pipelines_with_same_query", "lineno": 401, "outcome": "failed", "keywords": ["test_all_pipelines_with_same_query", "test_e2e_rag_persistent.py", "tests", "rag-templates", ""], "setup": {"duration": 8.383399108424783e-05, "outcome": "passed"}, "call": {"duration": 0.0002584579633548856, "outcome": "failed", "crash": {"path": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "lineno": 439, "message": "TypeError: ColbertRAGPipeline.__init__() got an unexpected keyword argument 'embedding_func'"}, "traceback": [{"path": "tests/test_e2e_rag_persistent.py", "lineno": 439, "message": "TypeError"}], "stdout": "BasicRAGPipeline Initialized\nHyDEPipeline Initialized\nRetrievalEvaluator Initialized (placeholder)\nCRAGPipeline Initialized\n", "stderr": "INFO:tests.test_e2e_rag_persistent:Running test_all_pipelines_with_same_query\n", "log": [{"name": "tests.test_e2e_rag_persistent", "msg": "Running test_all_pipelines_with_same_query", "args": null, "levelname": "INFO", "levelno": 20, "pathname": "/Users/tdyar/ws/rag-templates/tests/test_e2e_rag_persistent.py", "filename": "test_e2e_rag_persistent.py", "module": "test_e2e_rag_persistent", "exc_info": null, "exc_text": null, "stack_info": null, "lineno": 413, "funcName": "test_all_pipelines_with_same_query", "created": 1747847363.301891, "msecs": 301.0, "relativeCreated": 20625.511169433594, "thread": 8572176448, "threadName": "MainThread", "processName": "MainProcess", "process": 4257, "taskName": null, "asctime": "2025-05-21 13:09:23"}], "longrepr": "real_iris_connection = <intersystems_iris.IRISConnection object at 0x105a29580>\nreal_embedding_func = <function build_hf_embedder.<locals>.embedding_func_hf at 0x10e9a9e40>\nreal_llm_func = <function get_llm_func.<locals>.query_llm at 0x12e03a200>\ncolbert_query_encoder = <function colbert_query_encoder.<locals>.simple_colbert_query_encoder at 0x12e03a3e0>\nweb_search_func = <function web_search_func.<locals>.mock_web_search at 0x12e038400>\nsample_medical_queries = [{'expected_keywords': ['diabetes', 'symptom', 'glucose', 'insulin'], 'min_doc_count': 2, 'query': 'What are the sympt...tment', 'cognitive', 'memory'], 'min_doc_count': 2, 'query': \"What treatments are available for Alzheimer's disease?\"}]\n\n    def test_all_pipelines_with_same_query(\n        real_iris_connection,\n        real_embedding_func,\n        real_llm_func,\n        colbert_query_encoder,\n        web_search_func,\n        sample_medical_queries\n    ):\n        \"\"\"\n        Compares results from all pipelines with the same query.\n        \"\"\"\n        logger.info(\"Running test_all_pipelines_with_same_query\")\n    \n        # Use the same query for all pipelines\n        query_data = sample_medical_queries[0]\n        query = query_data[\"query\"]\n        expected_keywords = query_data[\"expected_keywords\"]\n        min_doc_count = query_data[\"min_doc_count\"]\n    \n        # Initialize all pipelines\n        pipelines = {\n            \"BasicRAG\": BasicRAGPipeline(\n                iris_connector=real_iris_connection,\n                embedding_func=real_embedding_func,\n                llm_func=real_llm_func\n            ),\n            \"HyDE\": HyDEPipeline(\n                iris_connector=real_iris_connection,\n                embedding_func=real_embedding_func,\n                llm_func=real_llm_func\n            ),\n            \"CRAG\": CRAGPipeline(\n                iris_connector=real_iris_connection,\n                embedding_func=real_embedding_func,\n                llm_func=real_llm_func,\n                web_search_func=web_search_func\n            ),\n>           \"ColBERT\": ColbertRAGPipeline(\n                iris_connector=real_iris_connection,\n                embedding_func=real_embedding_func,\n                llm_func=real_llm_func,\n                colbert_query_encoder_func=colbert_query_encoder,\n                colbert_doc_encoder_func=real_embedding_func  # Use regular embedding func as a placeholder\n            ),\n            \"NodeRAG\": NodeRAGPipeline(\n                iris_connector=real_iris_connection,\n                embedding_func=real_embedding_func,\n                llm_func=real_llm_func,\n                graph_lib=None  # Use None as a placeholder\n            ),\n            \"GraphRAG\": GraphRAGPipeline(\n                iris_connector=real_iris_connection,\n                embedding_func=real_embedding_func,\n                llm_func=real_llm_func\n            )\n        }\nE       TypeError: ColbertRAGPipeline.__init__() got an unexpected keyword argument 'embedding_func'\n\ntests/test_e2e_rag_persistent.py:439: TypeError"}, "teardown": {"duration": 0.00013087497791275382, "outcome": "passed"}}]}