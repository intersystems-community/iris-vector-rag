version: '3.8' # Specify docker-compose version

services:
  iris-app:
    build:
      context: .
      dockerfile: Dockerfile # Points to the new root Dockerfile
    container_name: iris_rag_app_single # New container name
    ports:
      - "51774:1972"   # IRIS SuperServer port (host:container)
      - "52774:52773"  # IRIS Management Portal (host:container)
    environment:
      # IRIS specific environment variables (used by IRIS entrypoint)
      - IRISUSERNAME=SuperUser
      - IRISPASSWORD=SYS
      - IRISNAMESPACE=USER # Default namespace for IRIS instance

      # Python application specific environment variables
      # Scripts running inside this container will connect to IRIS on localhost:1972
      - PYTHONUNBUFFERED=1
      - IRIS_HOST=localhost # For Python scripts connecting to IRIS in the same container
      - IRIS_PORT=1972
      # IRIS_PYTHON_NAMESPACE, IRIS_PYTHON_USERNAME, IRIS_PYTHON_PASSWORD can be set
      # if Python scripts need different defaults than the IRIS instance ones.
      # For now, Python scripts can default to these or be configured.
    volumes:
      - iris_app_data:/usr/irissys/mgr # Named volume for IRIS data persistence
      # Code is now copied into the image via Dockerfile's COPY . .
      # No need for: - ./common:/irisdev_common
      # No need for: - .:/app (unless for very specific live development overrides not part of image)
    
    # Keep the container running to allow `docker exec`
    stdin_open: true
    tty: true
    # Healthcheck can be added later if needed for IRIS readiness

volumes:
  iris_app_data: {} # Define the named volume for the single service

# Default network will be used if not specified.
# Removing custom network for simplicity unless other services are planned.
# networks:
#   default:
#     name: rag_single_app_network
