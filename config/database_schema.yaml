# RAG Templates Database Schema Configuration
# Centralized definition of all table and column names for consistency

schema:
  name: "RAG"
  description: "Main schema for RAG Templates data"

tables:
  # Main document storage
  source_documents:
    name: "SourceDocuments"
    description: "Primary document storage with embeddings"
    columns:
      id: id
      doc_id: doc_id
      title: title
      abstract: abstract
      text_content: text_content
      authors: authors
      keywords: keywords
      embedding: embedding
      metadata: metadata
      created_at: created_at
    indexes:
      - name: idx_source_docs_id
        columns:
        - doc_id
        type: primary
      - name: idx_hnsw_source_embedding
        columns:
        - embedding
        type: vector
      - name: idx_source_docs_created
        columns:
        - created_at

  # Document chunks for CRAG/NodeRAG
  document_chunks:
    name: "DocumentChunks"    # Current actual table name
    alias: "ChunkedDocuments" # Alternative name
    description: "Document chunks for CRAG and NodeRAG pipelines"
    columns:
      id: id
      chunk_id: chunk_id
      doc_id: doc_id
      chunk_text: chunk_text
      chunk_embedding: chunk_embedding
      chunk_index: chunk_index
      chunk_type: chunk_type
      metadata: metadata
      created_at: created_at
    indexes:
      - name: idx_chunks_doc_id
        columns:
        - doc_id
      - name: idx_chunks_type
        columns:
        - chunk_type
      - name: idx_hnsw_chunk_embedding
        columns:
        - chunk_embedding
        type: vector

  # Entities for GraphRAG
  document_entities:
    name: DocumentEntities
    description: Entities extracted for GraphRAG
    columns:
      id: id
      entity_id: entity_id
      doc_id: document_id
      entity_text: entity_text
      entity_type: entity_type
      position: position
      embedding: embedding
      created_at: created_at
    indexes:
    - name: idx_documententities_document_id
      columns:
      - document_id
    - name: idx_documententities_entity_type
      columns:
      - entity_type
    - name: idx_documententities_created_at
      columns:
      - created_at
    - name: idx_hnsw_documententities_embedding
      columns:
      - embedding
      type: vector

    # Relationships for GraphRAG
    entity_relationships:
      name: EntityRelationships
      description: Relationships between entities for GraphRAG
      columns:
        id: id
        relationship_id: relationship_id
        source_entity_id: source_entity_id
        target_entity_id: target_entity_id
        relationship_type: relationship_type
        description: description
        strength: strength
        source_doc_id: source_doc_id
        created_at: created_at
      indexes:
      - name: idx_relationships_id
        columns:
        - relationship_id
      - name: idx_relationships_source
        columns:
        - source_entity_id
      - name: idx_relationships_target
        columns:
        - target_entity_id
      - name: idx_relationships_type
        columns:
        - relationship_type
      - name: idx_relationships_entities
        columns:
        - source_entity_id
        - target_entity_id
      - name: idx_relationships_created
        columns:
        - created_at
      - name: idx_relationships_type_strength
        columns:
        - relationship_type
        - strength

  # Knowledge graph nodes and edges for NodeRAG
  knowledge_graph_nodes:
    name: KnowledgeGraphNodes
    description: Graph nodes for NodeRAG
    columns:
      id: id
      node_id: node_id
      node_type: node_type
      content: content
      embedding: embedding
      metadata: metadata
      created_at: created_at
    indexes:
    - name: idx_kg_nodes_id
      columns:
      - node_id
    - name: idx_kg_nodes_type
      columns:
      - node_type
    - name: idx_hnsw_kg_node_embedding
      columns:
      - embedding
      type: vector

  knowledge_graph_edges:
    name: KnowledgeGraphEdges
    description: Graph edges for NodeRAG
    columns:
      id: id
      edge_id: edge_id
      source_node_id: source_node_id
      target_node_id: target_node_id
      edge_type: edge_type
      weight: weight
      metadata: metadata
      created_at: created_at
    indexes:
    - name: idx_kg_edges_id
      columns:
      - edge_id
    - name: idx_kg_edges_source
      columns:
      - source_node_id
    - name: idx_kg_edges_target
      columns:
      - target_node_id
    - name: idx_kg_edges_type
      columns:
      - edge_type

  # Token embeddings for ColBERT
  document_token_embeddings:
    name: DocumentTokenEmbeddings
    description: Token-level embeddings for ColBERT pipeline
    columns:
      id: id
      doc_id: doc_id
      token_index: token_index
      token_text: token_text
      token_embedding: token_embedding
      created_at: created_at
    indexes:
    - name: idx_token_embeddings_doc
      columns:
      - doc_id
    - name: idx_token_embeddings_token
      columns:
      - token_index
    - name: idx_hnsw_token_embedding
      columns:
      - token_embedding
      type: vector

# Column name mappings for standardization
column_mappings:
  # Standardize document ID column names
  document_id_variants:
    - "doc_id"
    - "document_id"
    - "pmc_id"
  standard: "doc_id"

  # Standardize content column names
  content_variants:
    - "text_content"
    - "content"
    - "chunk_text"
    - "full_text"
  standard: "text_content"

  # Standardize embedding column names
  embedding_variants:
    - "embedding"
    - "chunk_embedding"
    - "token_embedding"
  standard: "embedding"

# Data types and constraints
data_types:
  doc_id: "VARCHAR(255)"
  text_content: "LONGVARCHAR"
  embedding: "VARCHAR(32000)"  # IRIS vector format
  vector_dimension: 384  # all-MiniLM-L6-v2 model
  colbert_token_dimension: 768  # ColBERT token embeddings
  timestamp: "TIMESTAMP"
  metadata: "VARCHAR(4000)"

# Testing configuration
testing:
  sample_sizes:
    small: 10
    medium: 100
    large: 1000
  test_tables:
    prefix: "TEST_"
    cleanup_after: true